<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–Ø–Ω–¥–µ–∫—Å –ï–¥–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; color: #1a1a1a; }

.header {
  background: #fc3f1d;
  color: white;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-logo { font-size: 24px; }
.header h1 { font-size: 20px; font-weight: 700; }
.header-sub { font-size: 12px; opacity: 0.85; }

.search-bar {
  background: white;
  padding: 12px 16px;
  border-bottom: 1px solid #eee;
}
.search-bar input {
  width: 100%;
  padding: 10px 16px;
  border-radius: 12px;
  border: 1px solid #ddd;
  font-size: 15px;
  background: #f8f8f8;
  outline: none;
}

.tabs {
  display: flex;
  background: white;
  border-bottom: 2px solid #f0f0f0;
  overflow-x: auto;
  scrollbar-width: none;
}
.tabs::-webkit-scrollbar { display: none; }
.tab {
  padding: 12px 20px;
  white-space: nowrap;
  font-size: 14px;
  font-weight: 500;
  color: #888;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
}
.tab.active { color: #fc3f1d; border-bottom-color: #fc3f1d; }

.content { padding: 16px; }

.section-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 12px;
  margin-top: 8px;
}

.restaurants-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.restaurant-card {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: transform 0.1s;
}
.restaurant-card:active { transform: scale(0.98); }

.restaurant-img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  background: #f0f0f0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
}

.restaurant-info { padding: 12px; }
.restaurant-name { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
.restaurant-meta { display: flex; gap: 12px; align-items: center; }
.rating { color: #fc3f1d; font-weight: 600; font-size: 14px; }
.delivery-time { color: #888; font-size: 13px; }
.delivery-fee { color: #888; font-size: 13px; }
.tags { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.tag {
  background: #f5f5f5;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  color: #555;
}

/* –≠–∫—Ä–∞–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ */
.restaurant-screen { display: none; }
.back-btn {
  background: rgba(0,0,0,0.5);
  border: none;
  color: white;
  width: 36px; height: 36px;
  border-radius: 50%;
  font-size: 18px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  position: absolute;
  top: 12px; left: 12px;
}

.menu-header {
  position: relative;
  height: 200px;
  background: #f0f0f0;
  display: flex; align-items: center; justify-content: center;
  font-size: 72px;
}

.menu-info {
  background: white;
  padding: 16px;
  border-bottom: 1px solid #f0f0f0;
}
.menu-info h2 { font-size: 22px; font-weight: 700; }
.menu-info p { color: #888; font-size: 14px; margin-top: 4px; }

.menu-section-title {
  padding: 16px 16px 8px;
  font-size: 16px;
  font-weight: 700;
  color: #333;
}

.menu-items { padding: 0 16px; display: flex; flex-direction: column; gap: 12px; }

.menu-item {
  background: white;
  border-radius: 12px;
  padding: 12px;
  display: flex;
  gap: 12px;
  align-items: center;
}
.menu-item-emoji { font-size: 36px; min-width: 48px; text-align: center; }
.menu-item-info { flex: 1; }
.menu-item-name { font-size: 15px; font-weight: 600; }
.menu-item-desc { font-size: 13px; color: #888; margin-top: 2px; }
.menu-item-price { font-size: 15px; font-weight: 700; color: #1a1a1a; margin-top: 4px; }
.add-btn {
  background: #fc3f1d;
  color: white;
  border: none;
  width: 32px; height: 32px;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}

/* –ö–æ—Ä–∑–∏–Ω–∞ */
.cart-bar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: #fc3f1d;
  color: white;
  padding: 14px 20px;
  display: none;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  z-index: 200;
}
.cart-bar.show { display: flex; }
.cart-bar-left { display: flex; align-items: center; gap: 10px; }
.cart-count {
  background: white;
  color: #fc3f1d;
  width: 24px; height: 24px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 13px;
}

/* –õ–æ–∞–¥–µ—Ä */
.loader-screen {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  min-height: 300px; gap: 16px;
}
.spinner {
  width: 40px; height: 40px;
  border: 4px solid #f0f0f0;
  border-top-color: #fc3f1d;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.error-msg {
  text-align: center; padding: 40px 20px; color: #888;
}
.error-msg .icon { font-size: 48px; margin-bottom: 12px; }
.error-msg p { font-size: 15px; }
.retry-btn {
  margin-top: 16px;
  background: #fc3f1d;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 15px;
  cursor: pointer;
}

.pb { padding-bottom: 80px; }
</style>
</head>
<body>

<!-- –ì–ª–∞–≤–Ω–∞—è: —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ -->
<div id="home-screen">
  <div class="header">
    <div class="header-logo">üçî</div>
    <div>
      <h1>–Ø–Ω–¥–µ–∫—Å –ï–¥–∞</h1>
      <div class="header-sub" id="addr-hint">–û–ø—Ä–µ–¥–µ–ª—è—é –∞–¥—Ä–µ—Å...</div>
    </div>
  </div>

  <div class="search-bar">
    <input type="text" placeholder="üîç  –†–µ—Å—Ç–æ—Ä–∞–Ω –∏–ª–∏ –±–ª—é–¥–æ" id="search-input" oninput="filterRestaurants()">
  </div>

  <div class="tabs">
    <div class="tab active" onclick="setTab(this,'all')">–í—Å–µ</div>
    <div class="tab" onclick="setTab(this,'pizza')">–ü–∏—Ü—Ü–∞</div>
    <div class="tab" onclick="setTab(this,'sushi')">–°—É—à–∏</div>
    <div class="tab" onclick="setTab(this,'burger')">–ë—É—Ä–≥–µ—Ä—ã</div>
    <div class="tab" onclick="setTab(this,'asian')">–ê–∑–∏—è</div>
    <div class="tab" onclick="setTab(this,'healthy')">–ü–ü</div>
  </div>

  <div class="content pb">
    <div class="section-title">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã —Ä—è–¥–æ–º</div>
    <div class="restaurants-grid" id="restaurants-list">
      <div class="loader-screen">
        <div class="spinner"></div>
        <p style="color:#888">–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã...</p>
      </div>
    </div>
  </div>
</div>

<!-- –ú–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ -->
<div id="restaurant-screen" class="restaurant-screen">
  <div class="menu-header" id="rest-header">
    <button class="back-btn" onclick="goBack()">‚Üê</button>
    <span id="rest-emoji">üçΩÔ∏è</span>
  </div>
  <div class="menu-info">
    <h2 id="rest-name"></h2>
    <p id="rest-meta"></p>
  </div>
  <div id="menu-content" class="pb"></div>
</div>

<!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
<div class="cart-bar" id="cart-bar" onclick="showCart()">
  <div class="cart-bar-left">
    <div class="cart-count" id="cart-count">0</div>
    <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
  </div>
  <span id="cart-total">0 ‚ÇΩ</span>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ URL
const params = new URLSearchParams(window.location.search);
const TOKEN = params.get('token') || '';

const cart = {};
let allRestaurants = [];
let currentFilter = 'all';

// –ó–∞–≥–ª—É—à–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ (–ø–æ–∫–∞ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ CORS ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ)
const DEMO_RESTAURANTS = [
  { id: 1, name: "–î–æ–¥–æ –ü–∏—Ü—Ü–∞", emoji: "üçï", rating: 4.8, time: "25‚Äì35 –º–∏–Ω", fee: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ", tags: ["pizza","–ü–∏—Ü—Ü–∞","–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è"], category: "pizza",
    menu: [
      { id: 101, name: "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", desc: "–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –±–∞–∑–∏–ª–∏–∫", price: 549, emoji: "üçï" },
      { id: 102, name: "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", desc: "–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –ø–µ–ø–ø–µ—Ä–æ–Ω–∏", price: 649, emoji: "üçï" },
      { id: 103, name: "4 —Å—ã—Ä–∞", desc: "–ú–æ—Ü–∞—Ä–µ–ª–ª–∞, —á–µ–¥–¥–µ—Ä, –¥–æ—Ä –±–ª—é, –ø–∞—Ä–º–µ–∑–∞–Ω", price: 699, emoji: "üçï" },
      { id: 104, name: "–ö–æ–ª–∞ 0.5", desc: "–û—Å–≤–µ–∂–∞—é—â–∏–π –Ω–∞–ø–∏—Ç–æ–∫", price: 99, emoji: "ü•§" },
    ]
  },
  { id: 2, name: "–°—É—à–∏ –ú–∞—Å—Ç–µ—Ä", emoji: "üç£", rating: 4.6, time: "40‚Äì50 –º–∏–Ω", fee: "99 ‚ÇΩ", tags: ["sushi","–Ø–ø–æ–Ω—Å–∫–∞—è","–†–æ–ª–ª—ã"], category: "sushi",
    menu: [
      { id: 201, name: "–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è", desc: "–õ–æ—Å–æ—Å—å, —Å–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä, –æ–≥—É—Ä–µ—Ü", price: 399, emoji: "üç±" },
      { id: 202, name: "–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è", desc: "–ö—Ä–∞–±, –∞–≤–æ–∫–∞–¥–æ, –∏–∫—Ä–∞ –º–∞—Å–∞–≥–æ", price: 349, emoji: "üç±" },
      { id: 203, name: "–£–Ω–∞–≥–∏ –º–∞–∫–∏", desc: "–£–≥–æ—Ä—å, –æ–≥—É—Ä–µ—Ü, —Å–æ—É—Å —É–Ω–∞–≥–∏", price: 429, emoji: "üç±" },
      { id: 204, name: "–ú–∏—Å–æ —Å—É–ø", desc: "–¢–æ—Ñ—É, –≤–∞–∫–∞–º—ç, –∑–µ–ª—ë–Ω—ã–π –ª—É–∫", price: 149, emoji: "üçú" },
    ]
  },
  { id: 3, name: "Burger Heroes", emoji: "üçî", rating: 4.7, time: "30‚Äì40 –º–∏–Ω", fee: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ", tags: ["burger","–ë—É—Ä–≥–µ—Ä—ã","–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è"], category: "burger",
    menu: [
      { id: 301, name: "Classic Smash", desc: "–ì–æ–≤—è–¥–∏–Ω–∞, —á–µ–¥–¥–µ—Ä, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—Ü—ã", price: 429, emoji: "üçî" },
      { id: 302, name: "BBQ Bacon", desc: "–ì–æ–≤—è–¥–∏–Ω–∞, –±–µ–∫–æ–Ω, BBQ —Å–æ—É—Å, –ª—É–∫ —Ñ—Ä–∏", price: 519, emoji: "üçî" },
      { id: 303, name: "–ö–∞—Ä—Ç–æ—à–∫–∞ —Ñ—Ä–∏", desc: "–•—Ä—É—Å—Ç—è—â–∞—è, —Å —Å–æ–ª—å—é", price: 179, emoji: "üçü" },
      { id: 304, name: "–ú–æ–ª–æ—á–Ω—ã–π —à–µ–π–∫", desc: "–í–∞–Ω–∏–ª—å / –∫–ª—É–±–Ω–∏–∫–∞ / —à–æ–∫–æ–ª–∞–¥", price: 249, emoji: "ü•§" },
    ]
  },
  { id: 4, name: "WOK to Walk", emoji: "ü•¢", rating: 4.5, time: "35‚Äì45 –º–∏–Ω", fee: "149 ‚ÇΩ", tags: ["asian","–ê–∑–∏—è","–¢–∞–π—Å–∫–∞—è"], category: "asian",
    menu: [
      { id: 401, name: "–ü–∞–¥ –¢–∞–π —Å –∫—É—Ä–∏—Ü–µ–π", desc: "–†–∏—Å–æ–≤–∞—è –ª–∞–ø—à–∞, —è–π—Ü–æ, –∞—Ä–∞—Ö–∏—Å, —Ä–æ—Å—Ç–∫–∏", price: 479, emoji: "üçú" },
      { id: 402, name: "–¢–æ–º –Ø–º", desc: "–û—Å—Ç—Ä—ã–π —Å—É–ø —Å –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏", price: 399, emoji: "üç≤" },
      { id: 403, name: "–ñ–∞—Ä–µ–Ω—ã–π —Ä–∏—Å —Å –æ–≤–æ—â–∞–º–∏", desc: "–†–∏—Å, —è–π—Ü–æ, —Å–æ–µ–≤—ã–π —Å–æ—É—Å, –æ–≤–æ—â–∏", price: 349, emoji: "üçö" },
    ]
  },
  { id: 5, name: "GreenBox", emoji: "ü•ó", rating: 4.9, time: "20‚Äì30 –º–∏–Ω", fee: "–ë–µ—Å–ø–ª–∞—Ç–Ω–æ", tags: ["healthy","–ü–ü","–ó–¥–æ—Ä–æ–≤–æ–µ"], category: "healthy",
    menu: [
      { id: 501, name: "–ë–æ—É–ª —Å –ª–æ—Å–æ—Å–µ–º", desc: "–†–∏—Å, –ª–æ—Å–æ—Å—å, –∞–≤–æ–∫–∞–¥–æ, –æ–≥—É—Ä–µ—Ü, –∫—É–Ω–∂—É—Ç", price: 549, emoji: "ü•ó" },
      { id: 502, name: "–¶–µ–∑–∞—Ä—å —Å –∫—É—Ä–∏—Ü–µ–π", desc: "–†–æ–º–∞–Ω–æ, –∫—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ, –ø–∞—Ä–º–µ–∑–∞–Ω, –≥—Ä–µ–Ω–∫–∏", price: 449, emoji: "ü•ó" },
      { id: 503, name: "–°–º—É–∑–∏ –º–∞–Ω–≥–æ-–±–∞–Ω–∞–Ω", desc: "–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Ñ—Ä—É–∫—Ç—ã, –±–µ–∑ —Å–∞—Ö–∞—Ä–∞", price: 279, emoji: "ü•§" },
    ]
  },
];

function init() {
  allRestaurants = DEMO_RESTAURANTS;

  // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  if (TOKEN) {
    tryFetchReal();
  } else {
    renderRestaurants(allRestaurants);
  }

  document.getElementById('addr-hint').textContent = '–ú–æ—Å–∫–≤–∞ ‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞';
}

async function tryFetchReal() {
  try {
    const r = await fetch('https://eda.yandex.ru/api/v2/catalog?region_id=1', {
      headers: { 'Authorization': 'Bearer ' + TOKEN }
    });
    if (r.ok) {
      const data = await r.json();
      console.log('[API]', data);
      // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –ø–∞—Ä—Å–∏–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      // –ü–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ
    }
  } catch(e) {
    console.log('[API CORS]', e.message);
  }
  renderRestaurants(allRestaurants);
}

function renderRestaurants(list) {
  const filtered = currentFilter === 'all'
    ? list
    : list.filter(r => r.category === currentFilter);

  const searchVal = document.getElementById('search-input').value.toLowerCase();
  const final = searchVal
    ? filtered.filter(r => r.name.toLowerCase().includes(searchVal) || r.tags.some(t => t.toLowerCase().includes(searchVal)))
    : filtered;

  const container = document.getElementById('restaurants-list');
  if (!final.length) {
    container.innerHTML = `<div class="error-msg"><div class="icon">üîç</div><p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p></div>`;
    return;
  }

  container.innerHTML = final.map(r => `
    <div class="restaurant-card" onclick="openRestaurant(${r.id})">
      <div class="restaurant-img">${r.emoji}</div>
      <div class="restaurant-info">
        <div class="restaurant-name">${r.name}</div>
        <div class="restaurant-meta">
          <span class="rating">‚òÖ ${r.rating}</span>
          <span class="delivery-time">‚è± ${r.time}</span>
          <span class="delivery-fee">${r.fee}</span>
        </div>
        <div class="tags">${r.tags.slice(1).map(t => `<span class="tag">${t}</span>`).join('')}</div>
      </div>
    </div>
  `).join('');
}

function setTab(el, cat) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  currentFilter = cat;
  renderRestaurants(allRestaurants);
}

function filterRestaurants() {
  renderRestaurants(allRestaurants);
}

function openRestaurant(id) {
  const r = allRestaurants.find(x => x.id === id);
  if (!r) return;

  document.getElementById('home-screen').style.display = 'none';
  document.getElementById('restaurant-screen').style.display = 'block';

  document.getElementById('rest-emoji').textContent = r.emoji;
  document.getElementById('rest-name').textContent = r.name;
  document.getElementById('rest-meta').textContent = `‚òÖ ${r.rating} ‚Ä¢ ${r.time} ‚Ä¢ ${r.fee}`;

  const menuEl = document.getElementById('menu-content');
  menuEl.innerHTML = `
    <div class="menu-section-title">–ú–µ–Ω—é</div>
    <div class="menu-items">
      ${r.menu.map(item => `
        <div class="menu-item">
          <div class="menu-item-emoji">${item.emoji}</div>
          <div class="menu-item-info">
            <div class="menu-item-name">${item.name}</div>
            <div class="menu-item-desc">${item.desc}</div>
            <div class="menu-item-price">${item.price} ‚ÇΩ</div>
          </div>
          <button class="add-btn" onclick="addToCart(${id}, ${item.id}, '${item.name}', ${item.price})">+</button>
        </div>
      `).join('')}
    </div>
  `;
}

function goBack() {
  document.getElementById('restaurant-screen').style.display = 'none';
  document.getElementById('home-screen').style.display = 'block';
}

function addToCart(restId, itemId, name, price) {
  const key = restId + '_' + itemId;
  cart[key] = cart[key] || { name, price, count: 0 };
  cart[key].count++;
  updateCartBar();
  Telegram.WebApp.HapticFeedback.impactOccurred('light');
}

function updateCartBar() {
  const total = Object.values(cart).reduce((s, i) => s + i.price * i.count, 0);
  const count = Object.values(cart).reduce((s, i) => s + i.count, 0);
  const bar = document.getElementById('cart-bar');
  if (count > 0) {
    bar.classList.add('show');
    document.getElementById('cart-count').textContent = count;
    document.getElementById('cart-total').textContent = total + ' ‚ÇΩ';
  } else {
    bar.classList.remove('show');
  }
}

function showCart() {
  const items = Object.values(cart).filter(i => i.count > 0);
  const total = items.reduce((s, i) => s + i.price * i.count, 0);
  const text = items.map(i => `${i.name} x${i.count} = ${i.price * i.count}‚ÇΩ`).join('\n');
  Telegram.WebApp.showPopup({
    title: 'üõí –ö–æ—Ä–∑–∏–Ω–∞',
    message: text + `\n\n–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`,
    buttons: [
      { id: 'order', type: 'default', text: '‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑' },
      { id: 'close', type: 'cancel', text: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–±–æ—Ä' },
    ]
  }, (btn) => {
    if (btn === 'order') {
      Telegram.WebApp.showAlert('üéâ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n–û–∂–∏–¥–∞–π—Ç–µ –¥–æ—Å—Ç–∞–≤–∫–∏.');
    }
  });
}

init();
</script>
</body>
</html>
