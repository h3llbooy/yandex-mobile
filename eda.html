<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–Ø–Ω–¥–µ–∫—Å –ï–¥–∞</title>
<style>
  :root {
    --yellow: #FFE033;
    --yellow-dark: #F5C800;
    --black: #1A1A1A;
    --gray-bg: #F5F5F5;
    --gray-text: #8C8C8C;
    --gray-border: #E8E8E8;
    --green: #029154;
    --red: #E63946;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bot: env(safe-area-inset-bottom, 0px);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; overflow: hidden; font-family: -apple-system, 'SF Pro Display', 'Helvetica Neue', sans-serif; background: var(--gray-bg); }
  #app { height: 100dvh; display: flex; flex-direction: column; overflow: hidden; position: relative; }
  .topbar { background: var(--yellow); padding: calc(var(--safe-top) + 12px) 16px 12px; flex-shrink: 0; position: relative; z-index: 100; }
  .topbar-inner { display: flex; align-items: center; gap: 10px; }
  .logo { font-size: 22px; font-weight: 900; color: var(--black); }
  .address-btn { flex: 1; display: flex; align-items: center; gap: 6px; background: rgba(0,0,0,0.08); border-radius: 12px; padding: 8px 12px; cursor: pointer; border: none; text-align: left; min-width: 0; }
  .address-btn-text { font-size: 13px; font-weight: 600; color: var(--black); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .profile-btn { width: 36px; height: 36px; border-radius: 50%; background: rgba(0,0,0,0.1); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
  .tabs { background: var(--yellow); display: flex; padding: 0 16px 12px; gap: 8px; flex-shrink: 0; }
  .tab-btn { padding: 7px 16px; border-radius: 20px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
  .tab-btn.active { background: var(--black); color: white; }
  .tab-btn:not(.active) { background: rgba(0,0,0,0.08); color: var(--black); }
  .content { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; }
  .content::-webkit-scrollbar { display: none; }
  .screen { display: none; }
  .screen.active { display: block; }
  .search-wrap { padding: 12px 16px 8px; }
  .search-box { display: flex; align-items: center; gap: 8px; background: white; border-radius: 14px; padding: 10px 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
  .search-input { flex: 1; border: none; outline: none; font-size: 15px; background: transparent; }
  .search-input::placeholder { color: #B0B0B0; }
  .banners { display: flex; gap: 12px; padding: 12px 16px; overflow-x: auto; scrollbar-width: none; }
  .banners::-webkit-scrollbar { display: none; }
  .banner { min-width: 260px; height: 110px; border-radius: 20px; display: flex; align-items: flex-end; padding: 14px; flex-shrink: 0; cursor: pointer; position: relative; overflow: hidden; transition: transform 0.15s; }
  .banner:active { transform: scale(0.97); }
  .banner-1 { background: linear-gradient(135deg, #FF6B35, #FF3D3D); }
  .banner-2 { background: linear-gradient(135deg, #6C5CE7, #a29bfe); }
  .banner-3 { background: linear-gradient(135deg, #00B894, #00CEC9); }
  .banner-text { color: white; font-weight: 800; font-size: 15px; line-height: 1.2; }
  .banner-emoji { position: absolute; right: 14px; top: 14px; font-size: 42px; }
  .cats { display: flex; gap: 10px; padding: 4px 16px 12px; overflow-x: auto; scrollbar-width: none; }
  .cats::-webkit-scrollbar { display: none; }
  .cat-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; background: white; border-radius: 16px; padding: 10px 14px; min-width: 72px; border: none; cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.06); transition: all 0.15s; }
  .cat-btn:active { transform: scale(0.94); }
  .cat-btn.active { background: var(--black); }
  .cat-btn.active .cat-name { color: white; }
  .cat-emoji { font-size: 26px; }
  .cat-name { font-size: 11px; font-weight: 600; color: var(--black); white-space: nowrap; }
  .restaurants { padding: 4px 16px; display: flex; flex-direction: column; gap: 14px; }
  .rest-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: transform 0.15s; }
  .rest-card:active { transform: scale(0.98); }
  .rest-img-placeholder { width: 100%; height: 150px; display: flex; align-items: center; justify-content: center; font-size: 60px; position: relative; }
  .rest-badge { position: absolute; top: 10px; left: 10px; font-size: 11px; font-weight: 700; padding: 3px 8px; border-radius: 8px; }
  .rest-badge.free { background: var(--green); color: white; }
  .rest-info { padding: 12px 14px; }
  .rest-name { font-size: 16px; font-weight: 700; color: var(--black); margin-bottom: 5px; }
  .rest-meta { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .rest-rating { font-size: 13px; font-weight: 600; color: var(--black); }
  .rest-time { font-size: 13px; color: var(--gray-text); font-weight: 500; }
  .rest-delivery { font-size: 13px; font-weight: 600; color: var(--green); }
  .rest-tags { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }
  .rest-tag { font-size: 11px; color: var(--gray-text); background: var(--gray-bg); border-radius: 6px; padding: 2px 7px; }
  .menu-hero { position: relative; }
  .menu-hero-img { width: 100%; height: 200px; display: flex; align-items: center; justify-content: center; font-size: 70px; }
  .menu-back { position: absolute; top: calc(var(--safe-top) + 12px); left: 12px; width: 38px; height: 38px; border-radius: 50%; background: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
  .menu-rest-info { padding: 14px 16px 10px; background: white; }
  .menu-rest-name { font-size: 22px; font-weight: 800; color: var(--black); margin-bottom: 6px; letter-spacing: -0.3px; }
  .menu-rest-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .menu-rest-badge { font-size: 12px; font-weight: 600; padding: 3px 10px; border-radius: 10px; }
  .menu-rest-badge.delivery { background: #E8F8EE; color: var(--green); }
  .menu-rest-badge.time { background: #FFF5D0; color: #B8860B; }
  .menu-cats-scroll { display: flex; gap: 8px; padding: 10px 16px; overflow-x: auto; scrollbar-width: none; border-top: 1px solid var(--gray-border); background: white; position: sticky; top: 0; z-index: 50; }
  .menu-cats-scroll::-webkit-scrollbar { display: none; }
  .menu-cat-tab { padding: 6px 14px; border-radius: 20px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.15s; }
  .menu-cat-tab.active { background: var(--black); color: white; }
  .menu-cat-tab:not(.active) { background: var(--gray-bg); color: var(--black); }
  .menu-section { padding: 16px 16px 0; }
  .menu-section-title { font-size: 18px; font-weight: 800; color: var(--black); margin-bottom: 12px; }
  .menu-items { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
  .menu-item { background: white; border-radius: 16px; padding: 12px; display: flex; gap: 12px; align-items: flex-start; box-shadow: 0 1px 4px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.1s; }
  .menu-item:active { transform: scale(0.98); }
  .menu-item-img { width: 88px; height: 88px; border-radius: 12px; flex-shrink: 0; background: var(--gray-bg); display: flex; align-items: center; justify-content: center; font-size: 36px; overflow: hidden; }
  .menu-item-img img { width: 100%; height: 100%; object-fit: cover; }
  .menu-item-body { flex: 1; min-width: 0; }
  .menu-item-name { font-size: 14px; font-weight: 700; color: var(--black); margin-bottom: 4px; line-height: 1.3; }
  .menu-item-desc { font-size: 12px; color: var(--gray-text); line-height: 1.4; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .menu-item-weight { font-size: 11px; color: #B0B0B0; font-weight: 500; margin-bottom: 6px; }
  .menu-item-footer { display: flex; align-items: center; justify-content: space-between; }
  .menu-item-price { font-size: 15px; font-weight: 800; color: var(--black); }
  .add-btn { width: 32px; height: 32px; border-radius: 10px; background: var(--yellow); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; transition: all 0.15s; flex-shrink: 0; }
  .add-btn:active { transform: scale(0.88); }
  .qty-ctrl { display: flex; align-items: center; gap: 8px; }
  .qty-btn { width: 30px; height: 30px; border-radius: 8px; background: var(--gray-bg); border: none; cursor: pointer; font-size: 18px; font-weight: 700; display: flex; align-items: center; justify-content: center; color: var(--black); }
  .qty-num { font-size: 15px; font-weight: 800; min-width: 20px; text-align: center; }
  .cart-empty { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 32px; text-align: center; gap: 16px; }
  .cart-empty-icon { font-size: 64px; }
  .cart-empty-title { font-size: 20px; font-weight: 800; color: var(--black); }
  .cart-empty-sub { font-size: 14px; color: var(--gray-text); }
  .cart-go-btn { margin-top: 8px; background: var(--yellow); color: var(--black); border: none; border-radius: 14px; padding: 14px 28px; font-size: 15px; font-weight: 700; cursor: pointer; }
  .cart-content { padding: 16px; }
  .cart-rest-name { font-size: 13px; color: var(--gray-text); font-weight: 500; margin-bottom: 12px; }
  .cart-items { display: flex; flex-direction: column; gap: 10px; margin-bottom: 16px; }
  .cart-item { background: white; border-radius: 16px; padding: 12px; display: flex; gap: 10px; align-items: center; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
  .cart-item-emoji { font-size: 32px; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: var(--gray-bg); border-radius: 10px; flex-shrink: 0; }
  .cart-item-body { flex: 1; min-width: 0; }
  .cart-item-name { font-size: 13px; font-weight: 700; color: var(--black); margin-bottom: 2px; line-height: 1.3; }
  .cart-item-opt { font-size: 11px; color: var(--gray-text); }
  .cart-qty-btn { width: 26px; height: 26px; border-radius: 7px; background: var(--gray-bg); border: none; cursor: pointer; font-size: 16px; font-weight: 700; color: var(--black); display: flex; align-items: center; justify-content: center; }
  .cart-qty-num { font-size: 14px; font-weight: 800; min-width: 18px; text-align: center; }
  .cart-promo { background: white; border-radius: 16px; padding: 14px; margin-bottom: 14px; display: flex; gap: 10px; align-items: center; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
  .promo-input { flex: 1; border: none; outline: none; font-size: 14px; background: transparent; }
  .promo-apply-btn { background: var(--yellow); border: none; border-radius: 10px; padding: 8px 14px; font-size: 13px; font-weight: 700; color: var(--black); cursor: pointer; }
  .cart-summary { background: white; border-radius: 16px; padding: 16px; margin-bottom: 14px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
  .summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
  .summary-row:last-child { margin-bottom: 0; }
  .summary-label { font-size: 14px; color: var(--gray-text); }
  .summary-value { font-size: 14px; font-weight: 600; color: var(--black); }
  .summary-total .summary-label, .summary-total .summary-value { font-size: 16px; font-weight: 800; color: var(--black); }
  .summary-divider { height: 1px; background: var(--gray-border); margin: 10px 0; }
  .summary-free { color: var(--green); }
  .checkout-btn { width: 100%; background: var(--yellow); color: var(--black); border: none; border-radius: 16px; padding: 16px; font-size: 16px; font-weight: 800; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; justify-content: space-between; }
  .checkout-btn:active { transform: scale(0.98); }
  .checkout-section { background: white; border-radius: 20px; margin: 12px 16px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
  .checkout-section-title { font-size: 15px; font-weight: 800; color: var(--black); margin-bottom: 12px; }
  .checkout-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--gray-border); cursor: pointer; }
  .checkout-row:last-child { border-bottom: none; padding-bottom: 0; }
  .checkout-row-icon { font-size: 20px; width: 36px; height: 36px; background: var(--gray-bg); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .checkout-row-body { flex: 1; }
  .checkout-row-label { font-size: 12px; color: var(--gray-text); font-weight: 500; }
  .checkout-row-value { font-size: 14px; font-weight: 600; color: var(--black); }
  .pay-method { display: flex; gap: 8px; flex-wrap: wrap; }
  .pay-option { flex: 1; min-width: 80px; padding: 10px; border-radius: 12px; border: 2px solid var(--gray-border); text-align: center; cursor: pointer; transition: all 0.15s; }
  .pay-option.selected { border-color: var(--black); background: var(--black); color: white; }
  .pay-option-icon { font-size: 20px; margin-bottom: 2px; }
  .pay-option-name { font-size: 11px; font-weight: 600; }
  .place-order-btn { margin: 12px 16px; margin-bottom: calc(12px + var(--safe-bot)); width: calc(100% - 32px); background: var(--yellow); color: var(--black); border: none; border-radius: 16px; padding: 17px; font-size: 17px; font-weight: 800; cursor: pointer; transition: all 0.15s; display: block; }
  .place-order-btn:active { transform: scale(0.98); }
  .place-order-btn:disabled { opacity: 0.6; }
  .order-status { padding: 20px 16px; text-align: center; }
  .order-check { font-size: 64px; margin-bottom: 16px; }
  .order-title { font-size: 24px; font-weight: 900; color: var(--black); margin-bottom: 8px; letter-spacing: -0.4px; }
  .order-sub { font-size: 15px; color: var(--gray-text); margin-bottom: 24px; }
  .order-nr { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); margin-bottom: 12px; }
  .order-nr-label { font-size: 12px; color: var(--gray-text); font-weight: 500; margin-bottom: 4px; }
  .order-nr-value { font-size: 20px; font-weight: 900; color: var(--black); }
  .order-track { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); margin-bottom: 20px; }
  .track-step { display: flex; gap: 14px; align-items: flex-start; margin-bottom: 16px; position: relative; }
  .track-step:last-child { margin-bottom: 0; }
  .track-line { position: absolute; left: 14px; top: 30px; width: 2px; height: calc(100% + 4px); background: var(--gray-border); }
  .track-step:last-child .track-line { display: none; }
  .track-dot { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; z-index: 1; }
  .track-dot.done { background: var(--green); }
  .track-dot.active { background: var(--yellow); animation: pulse 1.5s infinite; }
  .track-dot.pending { background: var(--gray-border); }
  @keyframes pulse { 0%,100%{transform:scale(1)}50%{transform:scale(1.1)} }
  .track-label { font-size: 14px; font-weight: 700; color: var(--black); }
  .track-time { font-size: 12px; color: var(--gray-text); margin-top: 2px; }
  .track-text { padding-top: 4px; }
  .back-to-main { width: 100%; background: var(--yellow); color: var(--black); border: none; border-radius: 14px; padding: 15px; font-size: 15px; font-weight: 800; cursor: pointer; }
  .bottom-nav { display: flex; background: white; border-top: 1px solid var(--gray-border); padding: 8px 0 calc(8px + var(--safe-bot)); flex-shrink: 0; z-index: 100; }
  .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px; border: none; background: transparent; cursor: pointer; padding: 4px 0; }
  .nav-icon { font-size: 22px; position: relative; display: inline-block; }
  .nav-label { font-size: 10px; font-weight: 600; color: var(--gray-text); }
  .nav-btn.active .nav-label { color: var(--black); }
  .cart-badge { position: absolute; top: -4px; right: -8px; background: var(--red); color: white; font-size: 9px; font-weight: 800; min-width: 16px; height: 16px; border-radius: 8px; display: flex; align-items: center; justify-content: center; padding: 0 3px; border: 2px solid white; }
  .loading-overlay { position: fixed; inset: 0; background: var(--yellow); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: opacity 0.4s; flex-direction: column; gap: 12px; }
  .loading-logo { font-size: 42px; font-weight: 900; color: var(--black); }
  .loading-sub { font-size: 14px; color: rgba(0,0,0,0.4); font-weight: 500; }
  .toast { position: fixed; bottom: calc(80px + var(--safe-bot)); left: 50%; transform: translateX(-50%) translateY(20px); background: var(--black); color: white; border-radius: 14px; padding: 12px 20px; font-size: 14px; font-weight: 600; z-index: 500; opacity: 0; transition: all 0.3s; white-space: nowrap; pointer-events: none; max-width: 90vw; overflow: hidden; text-overflow: ellipsis; }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200; display: flex; align-items: flex-end; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal { background: white; border-radius: 24px 24px 0 0; width: 100%; max-height: 90vh; overflow-y: auto; padding-bottom: calc(20px + var(--safe-bot)); transform: translateY(100%); transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1); }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal-img { width: 100%; height: 220px; display: flex; align-items: center; justify-content: center; font-size: 80px; background: var(--gray-bg); border-radius: 24px 24px 0 0; overflow: hidden; position: relative; }
  .modal-img img { width: 100%; height: 100%; object-fit: cover; }
  .modal-close { position: absolute; top: 14px; right: 14px; width: 32px; height: 32px; border-radius: 50%; background: rgba(0,0,0,0.4); border: none; cursor: pointer; color: white; font-size: 16px; display: flex; align-items: center; justify-content: center; }
  .modal-body { padding: 20px 20px 0; }
  .modal-name { font-size: 22px; font-weight: 800; color: var(--black); margin-bottom: 8px; letter-spacing: -0.3px; }
  .modal-desc { font-size: 14px; color: var(--gray-text); line-height: 1.5; margin-bottom: 8px; }
  .modal-weight { font-size: 13px; color: #B0B0B0; margin-bottom: 18px; }
  .modal-opts-title { font-size: 15px; font-weight: 700; color: var(--black); margin-bottom: 10px; }
  .modal-opts { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
  .modal-opt { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; border-radius: 12px; border: 2px solid var(--gray-border); cursor: pointer; transition: all 0.15s; }
  .modal-opt.selected { border-color: var(--black); background: #f8f8f8; }
  .modal-opt-name { font-size: 14px; font-weight: 500; }
  .modal-opt-price { font-size: 13px; color: var(--gray-text); font-weight: 600; }
  .modal-add-row { display: flex; align-items: center; gap: 12px; margin-top: 4px; }
  .modal-qty-ctrl { display: flex; align-items: center; gap: 12px; }
  .modal-qty-btn { width: 36px; height: 36px; border-radius: 10px; background: var(--gray-bg); border: none; cursor: pointer; font-size: 20px; font-weight: 700; color: var(--black); display: flex; align-items: center; justify-content: center; }
  .modal-qty-num { font-size: 18px; font-weight: 800; min-width: 24px; text-align: center; }
  .modal-add-btn { flex: 1; background: var(--yellow); color: var(--black); border: none; border-radius: 14px; padding: 15px; font-size: 15px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.15s; }
  .modal-add-btn:active { transform: scale(0.98); }
  .profile-header { background: var(--yellow); padding: calc(var(--safe-top) + 20px) 16px 24px; text-align: center; }
  .profile-avatar { width: 72px; height: 72px; border-radius: 50%; background: rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 12px; }
  .profile-name { font-size: 22px; font-weight: 800; color: var(--black); }
  .profile-uid { font-size: 13px; color: rgba(0,0,0,0.5); margin-top: 4px; }
  .profile-menu { padding: 16px; }
  .profile-item { background: white; border-radius: 16px; padding: 14px 16px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; cursor: pointer; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
  .profile-item-icon { font-size: 22px; width: 40px; text-align: center; }
  .profile-item-text { flex: 1; font-size: 15px; font-weight: 600; color: var(--black); }
  .screen-header { display: flex; align-items: center; gap: 10px; padding: calc(var(--safe-top) + 12px) 16px 12px; background: white; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid var(--gray-border); }
  .back-btn { background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; color: var(--black); line-height: 1; }
  .screen-hdr-title { font-size: 18px; font-weight: 800; color: var(--black); }
  .spinner { display: flex; justify-content: center; padding: 40px; }
  .spin { width: 32px; height: 32px; border: 3px solid var(--gray-border); border-top-color: var(--black); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to{transform:rotate(360deg)} }
</style>
</head>
<body>

<div class="loading-overlay" id="loading">
  <div class="loading-logo">üçî –ï–¥–∞</div>
  <div class="loading-sub">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="toast" id="toast"></div>

<div class="modal-overlay" id="itemModal">
  <div class="modal">
    <div class="modal-img" id="modalImg">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="modal-name" id="modalName"></div>
      <div class="modal-desc" id="modalDesc"></div>
      <div class="modal-weight" id="modalWeight"></div>
      <div id="modalOptsWrap" style="display:none">
        <div class="modal-opts-title" id="modalOptsTitle"></div>
        <div class="modal-opts" id="modalOpts"></div>
      </div>
      <div class="modal-add-row">
        <div class="modal-qty-ctrl">
          <button class="modal-qty-btn" onclick="changeModalQty(-1)">‚àí</button>
          <span class="modal-qty-num" id="modalQty">1</span>
          <button class="modal-qty-btn" onclick="changeModalQty(1)">+</button>
        </div>
        <button class="modal-add-btn" onclick="addFromModal()">
          <span>–í –∫–æ—Ä–∑–∏–Ω—É</span>
          <span id="modalAddPrice"></span>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="app">
  <div class="topbar" id="mainTopbar">
    <div class="topbar-inner">
      <div class="logo">–ï–¥–∞</div>
      <button class="address-btn" onclick="showToast('–°–º–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ —Å–∫–æ—Ä–æ')">
        <span>üìç</span>
        <span class="address-btn-text" id="addressText">–û–ø—Ä–µ–¥–µ–ª—è—é –∞–¥—Ä–µ—Å...</span>
        <span style="color:var(--black);opacity:0.4;margin-left:auto;">‚ñæ</span>
      </button>
      <button class="profile-btn" onclick="goTo('profile')">üë§</button>
    </div>
  </div>
  <div class="tabs" id="catalogTabs">
    <button class="tab-btn active" id="tab-online" onclick="selectTab('online',this)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
    <button class="tab-btn" id="tab-offline" onclick="selectTab('offline',this)">–°—Ö–æ–¥–∏—Ç—å</button>
  </div>

  <div class="content" id="mainContent">

    <!-- CATALOG -->
    <div class="screen active" id="screen-catalog">
      <div class="search-wrap">
        <div class="search-box">
          <span>üîç</span>
          <input class="search-input" placeholder="–†–µ—Å—Ç–æ—Ä–∞–Ω –∏–ª–∏ –±–ª—é–¥–æ" id="searchInput" oninput="filterRestaurants(this.value)">
        </div>
      </div>
      <div class="banners">
        <div class="banner banner-1"><span class="banner-emoji">üî•</span><div class="banner-text">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è<br>–¥–æ—Å—Ç–∞–≤–∫–∞</div></div>
        <div class="banner banner-2"><span class="banner-emoji">‚ö°</span><div class="banner-text">–ó–∞ 30 –º–∏–Ω—É—Ç<br>–∏–ª–∏ —Å–∫–∏–¥–∫–∞</div></div>
        <div class="banner banner-3"><span class="banner-emoji">üéÅ</span><div class="banner-text">–ù–æ–≤—ã–µ<br>—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</div></div>
      </div>
      <div class="cats" id="catsList"></div>
      <div style="padding:4px 16px 10px;"><span style="font-size:20px;font-weight:800;color:var(--black);letter-spacing:-0.3px;">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</span></div>
      <div class="restaurants" id="restaurantsList"><div class="spinner"><div class="spin"></div></div></div>
      <div style="height:20px;"></div>
    </div>

    <!-- MENU -->
    <div class="screen" id="screen-menu">
      <div class="menu-hero">
        <div class="menu-hero-img" id="menuHeroImg"></div>
        <button class="menu-back" onclick="goTo('catalog')">‚Üê</button>
      </div>
      <div class="menu-rest-info">
        <div class="menu-rest-name" id="menuRestName"></div>
        <div class="menu-rest-meta" id="menuRestMeta"></div>
      </div>
      <div class="menu-cats-scroll" id="menuCatTabs"></div>
      <div id="menuItemsContainer"></div>
      <div style="height:24px;"></div>
    </div>

    <!-- CART -->
    <div class="screen" id="screen-cart">
      <div class="screen-header">
        <button class="back-btn" onclick="goTo('catalog')">‚Üê</button>
        <span class="screen-hdr-title">–ö–æ—Ä–∑–∏–Ω–∞</span>
      </div>
      <div class="cart-empty" id="cartEmpty">
        <div class="cart-empty-icon">üõí</div>
        <div class="cart-empty-title">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è</div>
        <div class="cart-empty-sub">–î–æ–±–∞–≤—å—Ç–µ –±–ª—é–¥–∞ –∏–∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</div>
        <button class="cart-go-btn" onclick="goTo('catalog')">–ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º</button>
      </div>
      <div id="cartFilled" style="display:none">
        <div class="cart-content">
          <div class="cart-rest-name" id="cartRestName"></div>
          <div class="cart-items" id="cartItemsList"></div>
          <div class="cart-promo">
            <span>üè∑Ô∏è</span>
            <input class="promo-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" id="promoInput">
            <button class="promo-apply-btn" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          </div>
          <div class="cart-summary">
            <div class="summary-row"><span class="summary-label">–¢–æ–≤–∞—Ä—ã</span><span class="summary-value" id="summaryItems">0 ‚ÇΩ</span></div>
            <div class="summary-row"><span class="summary-label">–î–æ—Å—Ç–∞–≤–∫–∞</span><span class="summary-value summary-free" id="summaryDelivery">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span></div>
            <div class="summary-row"><span class="summary-label">–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä</span><span class="summary-value" id="summaryFee">0 ‚ÇΩ</span></div>
            <div class="summary-divider"></div>
            <div class="summary-row summary-total"><span class="summary-label">–ò—Ç–æ–≥–æ</span><span class="summary-value" id="summaryTotal">0 ‚ÇΩ</span></div>
          </div>
          <button class="checkout-btn" onclick="goTo('checkout')">
            <span>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</span><span id="checkoutBtnTotal">0 ‚ÇΩ</span>
          </button>
        </div>
      </div>
    </div>

    <!-- CHECKOUT -->
    <div class="screen" id="screen-checkout">
      <div class="screen-header">
        <button class="back-btn" onclick="goTo('cart')">‚Üê</button>
        <span class="screen-hdr-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span>
      </div>
      <div class="checkout-section">
        <div class="checkout-section-title">üì¶ –î–æ—Å—Ç–∞–≤–∫–∞</div>
        <div class="checkout-row">
          <div class="checkout-row-icon">üìç</div>
          <div class="checkout-row-body">
            <div class="checkout-row-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
            <div class="checkout-row-value" id="checkoutAddr">–ù–µ —É–∫–∞–∑–∞–Ω</div>
          </div>
          <div style="color:var(--gray-text);">‚Ä∫</div>
        </div>
        <div class="checkout-row">
          <div class="checkout-row-icon">‚è±Ô∏è</div>
          <div class="checkout-row-body">
            <div class="checkout-row-label">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</div>
            <div class="checkout-row-value" id="checkoutTime">~30 –º–∏–Ω</div>
          </div>
          <div style="color:var(--gray-text);">‚Ä∫</div>
        </div>
      </div>
      <div class="checkout-section">
        <div class="checkout-section-title">üí≥ –û–ø–ª–∞—Ç–∞</div>
        <div class="pay-method">
          <div class="pay-option selected" onclick="selectPay(this,'sbp')"><div class="pay-option-icon">‚ö°</div><div class="pay-option-name">–°–ë–ü</div></div>
          <div class="pay-option" onclick="selectPay(this,'card')"><div class="pay-option-icon">üí≥</div><div class="pay-option-name">–ö–∞—Ä—Ç–∞</div></div>
          <div class="pay-option" onclick="selectPay(this,'cash')"><div class="pay-option-icon">üíµ</div><div class="pay-option-name">–ù–∞–ª–∏—á–Ω—ã–µ</div></div>
        </div>
      </div>
      <div class="checkout-section">
        <div class="checkout-section-title">üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
        <input id="checkoutComment" style="width:100%;border:1px solid var(--gray-border);border-radius:10px;padding:10px 12px;font-size:14px;outline:none;background:var(--gray-bg);" placeholder="–î–æ–º–æ—Ñ–æ–Ω, —ç—Ç–∞–∂, –ø–æ–∂–µ–ª–∞–Ω–∏—è...">
      </div>
      <div class="checkout-section">
        <div class="checkout-section-title">üßæ –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</div>
        <div id="checkoutItems"></div>
        <div class="summary-divider"></div>
        <div class="summary-row summary-total" style="margin-top:10px;">
          <span class="summary-label">–ò—Ç–æ–≥–æ</span>
          <span class="summary-value" id="checkoutTotal">0 ‚ÇΩ</span>
        </div>
      </div>
      <button class="place-order-btn" id="placeOrderBtn" onclick="placeOrder()">
        –ó–∞–∫–∞–∑–∞—Ç—å ¬∑ <span id="placeOrderTotal">0 ‚ÇΩ</span>
      </button>
    </div>

    <!-- ORDER -->
    <div class="screen" id="screen-order">
      <div class="order-status">
        <div class="order-check">‚úÖ</div>
        <div class="order-title">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div>
        <div class="order-sub">–†–µ—Å—Ç–æ—Ä–∞–Ω –Ω–∞—á–∞–ª –≥–æ—Ç–æ–≤–∏—Ç—å –≤–∞—à –∑–∞–∫–∞–∑</div>
        <div class="order-nr">
          <div class="order-nr-label">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</div>
          <div class="order-nr-value" id="orderNr">‚Äî</div>
        </div>
        <div class="order-track">
          <div class="track-step">
            <div class="track-dot done" id="step1dot">‚úì</div>
            <div class="track-line"></div>
            <div class="track-text"><div class="track-label">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç</div><div class="track-time" id="step1time"></div></div>
          </div>
          <div class="track-step">
            <div class="track-dot active" id="step2dot">üç≥</div>
            <div class="track-line"></div>
            <div class="track-text"><div class="track-label">–†–µ—Å—Ç–æ—Ä–∞–Ω –≥–æ—Ç–æ–≤–∏—Ç</div><div class="track-time" id="step2time">~20 –º–∏–Ω</div></div>
          </div>
          <div class="track-step">
            <div class="track-dot pending" id="step3dot">üõµ</div>
            <div class="track-line"></div>
            <div class="track-text"><div class="track-label">–ö—É—Ä—å–µ—Ä –≤ –ø—É—Ç–∏</div><div class="track-time" id="step3time"></div></div>
          </div>
          <div class="track-step">
            <div class="track-dot pending" id="step4dot">üéâ</div>
            <div class="track-text"><div class="track-label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</div><div class="track-time" id="step4time"></div></div>
          </div>
        </div>
        <button class="back-to-main" onclick="goTo('catalog');clearCart();">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
      </div>
    </div>

    <!-- PROFILE -->
    <div class="screen" id="screen-profile">
      <div class="profile-header">
        <div style="display:flex;justify-content:flex-start;margin-bottom:12px;">
          <button class="back-btn" onclick="goTo('catalog')">‚Üê</button>
        </div>
        <div class="profile-avatar">üë§</div>
        <div class="profile-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="profile-uid" id="profileUid"></div>
      </div>
      <div class="profile-menu">
        <div class="profile-item" onclick="showToast('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')"><span class="profile-item-icon">üì¶</span><span class="profile-item-text">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</span><span>‚Ä∫</span></div>
        <div class="profile-item" onclick="showToast('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')"><span class="profile-item-icon">üìç</span><span class="profile-item-text">–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</span><span>‚Ä∫</span></div>
        <div class="profile-item" onclick="showToast('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')"><span class="profile-item-icon">üí≥</span><span class="profile-item-text">–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</span><span>‚Ä∫</span></div>
        <div class="profile-item" onclick="showToast('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')"><span class="profile-item-icon">üè∑Ô∏è</span><span class="profile-item-text">–ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –±–æ–Ω—É—Å—ã</span><span>‚Ä∫</span></div>
        <div class="profile-item" onclick="showToast('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')"><span class="profile-item-icon">üí¨</span><span class="profile-item-text">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span><span>‚Ä∫</span></div>
      </div>
    </div>

  </div>

  <div class="bottom-nav" id="bottomNav">
    <button class="nav-btn active" id="nav-catalog" onclick="goTo('catalog')">
      <span class="nav-icon">üè†</span><span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="nav-btn" id="nav-cart" onclick="goTo('cart')">
      <span class="nav-icon">üõí<span class="cart-badge" id="cartBadge"></span></span>
      <span class="nav-label">–ö–æ—Ä–∑–∏–Ω–∞</span>
    </button>
    <button class="nav-btn" id="nav-profile" onclick="goTo('profile')">
      <span class="nav-icon">üë§</span><span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
    </button>
  </div>
</div>

<script>
const TOKEN = new URLSearchParams(location.search).get('token') || '';
const BASE = 'https://eda.yandex.ru';
const LAT = 56.34750920385357, LON = 43.934390690686854;
const APP_ID = 'com.appkode.foodfox';
const APP_VERSION = '8.94.0';
const SDK_VERSION = '6.32.0.10003';
// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–ª–∏ –±–µ—Ä—ë–º –∏–∑ URL device_id —á—Ç–æ–±—ã –Ω–µ —Å–≤–µ—Ç–∏—Ç—å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ
const DEVICE_ID = new URLSearchParams(location.search).get('device_id') || '9B57D76B-908D-4504-915D-381D08676F44';
// –¢–æ—á–Ω—ã–π UA –∫–∞–∫ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–µ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
const MOBILE_UA = `Eats-iOS(${APP_VERSION}) com.appkode.foodfox/${APP_VERSION} (Apple; iPhone17,1; iOS 17.5) PassportSDK/${SDK_VERSION}`;
const HDRS = {
  'Content-Type': 'application/json',
  'Authorization': TOKEN ? `Bearer ${TOKEN}` : '',
  'User-Agent': MOBILE_UA,
  'x-device-id': DEVICE_ID,
  'x-app-version': APP_VERSION,
  'x-platform': 'ios_app',
  'x-app-id': APP_ID,
  'x-supported-features': 'loyalty,discounts,promo_codes,referral',
  'Accept-Language': 'ru-RU,ru;q=0.9',
};

let cart = {}, currentRest = null, currentScreen = 'catalog';
let modalItem = null, modalQty = 1, selectedOpt = null;
let selectedPay = 'sbp', profile = null;

const RESTS = [
  { id:'mc', slug:'mcdonald_s_1', name:"McDonald's", emoji:'üçî', bg:'linear-gradient(135deg,#DA291C,#FFC72C)',
    rating:4.7, time:'25‚Äì35', freeDelivery:true, tags:['–ë—É—Ä–≥–µ—Ä—ã','–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å','–ù–∞–ø–∏—Ç–∫–∏'],
    cats:[ { n:'–ë—É—Ä–≥–µ—Ä—ã', items:[
      {id:1001,n:'–ë–∏–≥ –ú–∞–∫',d:'–î–≤–∞ –∫–æ—Ç–ª–µ—Ç—ã, —Å–æ—É—Å –ë–∏–≥ –ú–∞–∫, –ª–∏—Å—Ç—å—è —Å–∞–ª–∞—Ç–∞, –ª—É–∫',p:299,w:'200 –≥',e:'üçî',opts:[]},
      {id:1002,n:'–ú–∞–∫–ß–∏–∫–µ–Ω',d:'–•—Ä—É—Å—Ç—è—â–∞—è –∫—É—Ä–∏–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞, –º–∞–π–æ–Ω–µ–∑, –ª–∏—Å—Ç—å—è —Å–∞–ª–∞—Ç–∞',p:219,w:'187 –≥',e:'üçó',opts:[]},
      {id:1003,n:'–†–æ—è–ª –ß–∏–∑–±—É—Ä–≥–µ—Ä',d:'–î–≤–æ–π–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞, –ø–ª–∞–≤–ª–µ–Ω—ã–π —Å—ã—Ä, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—Ü—ã',p:349,w:'245 –≥',e:'üçî',opts:[]},
      {id:1004,n:'–§–∏—à–±—É—Ä–≥–µ—Ä',d:'–ù–µ–∂–Ω—ã–π —Ä—ã–±–Ω—ã–π —Å—Ç–µ–π–∫, —Å—ã—Ä, —Ç–∞—Ä—Ç–∞—Ä',p:199,w:'145 –≥',e:'üêü',opts:[]},
    ]},
    { n:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', items:[
      {id:1010,n:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –§—Ä–∏ (–±–æ–ª—å—à–æ–π)',d:'–•—Ä—É—Å—Ç—è—â–∏–π –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏',p:129,w:'154 –≥',e:'üçü',opts:[]},
      {id:1011,n:'–ù–∞–≥–≥–µ—Ç—Å—ã 9 —à—Ç',d:'–ö—É—Ä–∏–Ω—ã–µ –Ω–∞–≥–≥–µ—Ç—Å—ã –≤–æ –≤–∫—É—Å–Ω–æ–π –ø–∞–Ω–∏—Ä–æ–≤–∫–µ',p:269,w:'170 –≥',e:'üçó',opts:[{g:'–°–æ—É—Å',i:[{id:9001,n:'–ö–µ—Ç—á—É–ø',p:0},{id:9002,n:'–ë–∞—Ä–±–µ–∫—é',p:0},{id:9003,n:'–°—ã—Ä–Ω—ã–π',p:0}]}]},
      {id:1012,n:'–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ø–æ-–¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏',d:'–° –∫–æ–∂—É—Ä–æ–π, –æ—Å—Ç—Ä—ã–µ —Å–ø–µ—Ü–∏–∏',p:149,w:'140 –≥',e:'ü•î',opts:[]},
    ]},
    { n:'–ù–∞–ø–∏—Ç–∫–∏', items:[
      {id:1020,n:'–ö–æ–∫–∞-–ö–æ–ª–∞ 0.5–ª',d:'–û—Å–≤–µ–∂–∞—é—â–∏–π –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫',p:139,w:'500 –º–ª',e:'ü•§',opts:[]},
      {id:1021,n:'–ú–æ–ª–æ—á–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å',d:'–í–∞–Ω–∏–ª—å–Ω—ã–π, –∫–ª—É–±–Ω–∏—á–Ω—ã–π –∏–ª–∏ —à–æ–∫–æ–ª–∞–¥–Ω—ã–π',p:249,w:'400 –º–ª',e:'ü•õ',opts:[{g:'–í–∫—É—Å',i:[{id:9010,n:'–í–∞–Ω–∏–ª—å',p:0},{id:9011,n:'–ö–ª—É–±–Ω–∏–∫–∞',p:0},{id:9012,n:'–®–æ–∫–æ–ª–∞–¥',p:0}]}]},
    ]},
  ]},
  { id:'bk', slug:'bk_revo2', name:'Burger King', emoji:'üëë', bg:'linear-gradient(135deg,#D62300,#F5EBDC)',
    rating:4.5, time:'30‚Äì40', freeDelivery:true, tags:['–í–æ–ø–ø–µ—Ä','–ë—É—Ä–≥–µ—Ä—ã','–ù–∞–≥–≥–µ—Ç—Å—ã'],
    cats:[ { n:'–í–æ–ø–ø–µ—Ä', items:[
      {id:2001,n:'–í–æ–ø–ø–µ—Ä',d:'–ì–æ–≤—è–∂—å—è –∫–æ—Ç–ª–µ—Ç–∞ 100% beef, –ø–æ–º–∏–¥–æ—Ä—ã, –ª—É–∫, –æ–≥—É—Ä—Ü—ã, —Å–∞–ª–∞—Ç, –º–∞–π–æ–Ω–µ–∑',p:399,w:'290 –≥',e:'üçî',opts:[]},
      {id:2002,n:'–î–≤–æ–π–Ω–æ–π –í–æ–ø–ø–µ—Ä',d:'–î–≤–µ –≥–æ–≤—è–∂—å–∏ –∫–æ—Ç–ª–µ—Ç—ã, –≤—Å–µ –æ–≤–æ—â–∏',p:499,w:'385 –≥',e:'üçî',opts:[]},
      {id:2003,n:'–ß–∏–∫–µ–Ω –ë—É—Ä–≥–µ—Ä',d:'–•—Ä—É—Å—Ç—è—â–∞—è –∫—É—Ä–∏–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞',p:299,w:'220 –≥',e:'üêî',opts:[]},
    ]},
    { n:'–ó–∞–∫—É—Å–∫–∏', items:[
      {id:2010,n:'–û—Å—Ç—Ä—ã–µ –°—ã—Ä–Ω—ã–µ –ú–µ–¥–∞–ª—å–æ–Ω—ã (9 —à—Ç.)',d:'–ù–µ–∂–Ω—ã–µ —Å—ã—Ä–Ω—ã–µ –º–µ–¥–∞–ª—å–æ–Ω—ã —Å –û—Å—Ç—Ä–æ–π —à—Ç—É–∫–æ–π',p:360,w:'108 –≥',e:'üßÄ',opts:[{g:'–í—ã–±–µ—Ä–∏ —Å–æ—É—Å',i:[{id:9020,n:'–ö–µ—Ç—á—É–ø',p:65},{id:9021,n:'–ë–∞—Ä–±–µ–∫—é',p:65},{id:9022,n:'–°—ã—Ä–Ω—ã–π',p:65},{id:9023,n:'–û—Å—Ç—Ä—ã–π –¢–æ–º–∞—Ç–Ω—ã–π',p:70}]}]},
      {id:2011,n:'–õ—É–∫–æ–≤—ã–µ –∫–æ–ª—å—Ü–∞ (8 —à—Ç.)',d:'–•—Ä—É—Å—Ç—è—â–∏–µ –ª—É–∫–æ–≤—ã–µ –∫–æ–ª—å—Ü–∞ –≤ –ø–∞–Ω–∏—Ä–æ–≤–∫–µ',p:199,w:'130 –≥',e:'üßÖ',opts:[]},
    ]},
    { n:'–ù–∞–ø–∏—Ç–∫–∏', items:[
      {id:2020,n:'Pepsi 0.5–ª',d:'–ì–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫',p:119,w:'500 –º–ª',e:'ü•§',opts:[]},
      {id:2021,n:'–ö–∏–Ω–≥ –§–ª–æ–∞—Ç',d:'–ú–æ—Ä–æ–∂–µ–Ω–æ–µ —Å Pepsi',p:179,w:'330 –º–ª',e:'üç¶',opts:[]},
    ]},
  ]},
  { id:'kfc', slug:'kfc_main', name:'KFC', emoji:'üçó', bg:'linear-gradient(135deg,#E4002B,#F40027)',
    rating:4.6, time:'25‚Äì35', freeDelivery:true, tags:['–ö—É—Ä–∏—Ü–∞','–ö—Ä—ã–ª—å—è','–û—Å—Ç—Ä–æ–µ'],
    cats:[ { n:'–ö—Ä—ã–ª—å—è', items:[
      {id:3001,n:'–ö—Ä—ã–ª—å—è (6 —à—Ç)',d:'–•—Ä—É—Å—Ç—è—â–∏–µ –∫—Ä—ã–ª—ã—à–∫–∏ –≤ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–π –ø–∞–Ω–∏—Ä–æ–≤–∫–µ',p:329,w:'270 –≥',e:'üçó',opts:[{g:'–ú–∞—Ä–∏–Ω–∞–¥',i:[{id:9030,n:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π',p:0},{id:9031,n:'–û—Å—Ç—Ä—ã–π',p:0}]}]},
      {id:3002,n:'–°—Ç—Ä–∏–ø—Å—ã (5 —à—Ç)',d:'–ù–µ–∂–Ω—ã–µ –∫—É—Ä–∏–Ω—ã–µ —Å—Ç—Ä–∏–ø—Å—ã',p:359,w:'190 –≥',e:'üçó',opts:[]},
    ]},
    { n:'–ë—É—Ä–≥–µ—Ä—ã', items:[
      {id:3010,n:'–¢–≤–∏—Å—Ç–µ—Ä',d:'–ö—É—Ä–∏–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞ –≤ –ª–µ–ø—ë—à–∫–µ —Å –æ–≤–æ—â–∞–º–∏',p:279,w:'215 –≥',e:'üåØ',opts:[]},
      {id:3011,n:'–°–∞–Ω–¥–≤–∏—á –ó–∏–Ω–≥–µ—Ä',d:'–û—Å—Ç—Ä–∞—è –∫—É—Ä–∏–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞, —Å—ã—Ä, –æ–≥—É—Ä—Ü—ã',p:299,w:'230 –≥',e:'üåÆ',opts:[]},
    ]},
  ]},
  { id:'sushi', slug:'sushi_wok', name:'–°—É—à–∏ Wok', emoji:'üç£', bg:'linear-gradient(135deg,#1a1a2e,#e94560)',
    rating:4.8, time:'40‚Äì55', freeDelivery:true, tags:['–°—É—à–∏','–†–æ–ª–ª—ã','–õ–∞–ø—à–∞'],
    cats:[ { n:'–†–æ–ª–ª—ã', items:[
      {id:4001,n:'–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è',d:'–õ–æ—Å–æ—Å—å, –∫—Ä–µ–º-—Å—ã—Ä, –æ–≥—É—Ä–µ—Ü, –∞–≤–æ–∫–∞–¥–æ',p:589,w:'280 –≥',e:'üç£',opts:[]},
      {id:4002,n:'–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è',d:'–ö—Ä–∞–±, –æ–≥—É—Ä–µ—Ü, –∞–≤–æ–∫–∞–¥–æ, –∏–∫—Ä–∞ —Ç–æ–±–∏–∫–æ',p:489,w:'260 –≥',e:'ü¶Ä',opts:[]},
      {id:4003,n:'–î—Ä–∞–∫–æ–Ω',d:'–£–≥–æ—Ä—å, –∞–≤–æ–∫–∞–¥–æ, –æ–≥—É—Ä–µ—Ü, —Å–æ—É—Å —É–Ω–∞–≥–∏',p:679,w:'310 –≥',e:'üêâ',opts:[]},
      {id:4004,n:'–†–∞–¥—É–≥–∞',d:'8 –≤–∏–¥–æ–≤ —Ä—ã–±—ã –ø–æ–≤–µ—Ä—Ö —Ä–æ–ª–ª–∞',p:729,w:'340 –≥',e:'üåà',opts:[]},
    ]},
    { n:'WOK', items:[
      {id:4010,n:'–õ–∞–ø—à–∞ —Å –∫—É—Ä–∏—Ü–µ–π',d:'–Ø–∏—á–Ω–∞—è –ª–∞–ø—à–∞, –∫—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞, —Å–æ–µ–≤—ã–π —Å–æ—É—Å',p:349,w:'380 –≥',e:'üçú',opts:[]},
      {id:4011,n:'–†–∏—Å —Å –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏',d:'–¢–∏–≥—Ä–æ–≤—ã–µ –∫—Ä–µ–≤–µ—Ç–∫–∏, –∫–∞–ª—å–º–∞—Ä, —Ä–∏—Å –∂–∞—Å–º–∏–Ω',p:449,w:'400 –≥',e:'üçö',opts:[]},
    ]},
  ]},
  { id:'pizza', slug:'dodo_pizza', name:'–î–æ–¥–æ –ü–∏—Ü—Ü–∞', emoji:'üçï', bg:'linear-gradient(135deg,#EE3124,#F5A623)',
    rating:4.9, time:'35‚Äì50', freeDelivery:true, tags:['–ü–∏—Ü—Ü–∞','–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è','–ì–æ—Ä—è—á–µ–µ'],
    cats:[ { n:'–ü–∏—Ü—Ü–∞ 30 —Å–º', items:[
      {id:5001,n:'–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞',d:'–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —Å–≤–µ–∂–∏–µ –ø–æ–º–∏–¥–æ—Ä—ã, –±–∞–∑–∏–ª–∏–∫',p:599,w:'550 –≥',e:'üçï',opts:[]},
      {id:5002,n:'–ü–µ–ø–ø–µ—Ä–æ–Ω–∏',d:'–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –ø–µ–ø–ø–µ—Ä–æ–Ω–∏',p:699,w:'590 –≥',e:'üçï',opts:[]},
      {id:5003,n:'–ß–µ—Ç—ã—Ä–µ —Å—ã—Ä–∞',d:'–°–ª–∏–≤–æ—á–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —á–µ–¥–¥–µ—Ä, –ø–∞—Ä–º–µ–∑–∞–Ω, –¥–æ—Ä-–±–ª—é',p:749,w:'570 –≥',e:'üßÄ',opts:[]},
      {id:5004,n:'–ì–∞–≤–∞–π—Å–∫–∞—è',d:'–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –≤–µ—Ç—á–∏–Ω–∞, –∞–Ω–∞–Ω–∞—Å',p:649,w:'560 –≥',e:'üçç',opts:[]},
    ]},
    { n:'–ó–∞–∫—É—Å–∫–∏', items:[
      {id:5010,n:'–ß–µ—Å–Ω–æ—á–Ω—ã–π —Ö–ª–µ–±',d:'–•—Ä—É—Å—Ç—è—â–∏–π —Ö–ª–µ–± —Å —á–µ—Å–Ω–æ—á–Ω—ã–º –º–∞—Å–ª–æ–º –∏ –∑–µ–ª–µ–Ω—å—é',p:199,w:'150 –≥',e:'ü•ñ',opts:[]},
      {id:5011,n:'–°—ã—Ä–Ω—ã–µ —à–∞—Ä–∏–∫–∏',d:'6 —Ö—Ä—É—Å—Ç—è—â–∏—Ö —à–∞—Ä–∏–∫–æ–≤ —Å –º–æ—Ü–∞—Ä–µ–ª–ª–æ–π –≤–Ω—É—Ç—Ä–∏',p:299,w:'180 –≥',e:'üßÄ',opts:[]},
    ]},
  ]},
];

const CATS = [{e:'üçî',n:'–ë—É—Ä–≥–µ—Ä—ã'},{e:'üç£',n:'–°—É—à–∏'},{e:'üçï',n:'–ü–∏—Ü—Ü–∞'},{e:'üçó',n:'–ö—É—Ä–∏—Ü–∞'},{e:'ü•ó',n:'–ó–¥–æ—Ä–æ–≤–æ–µ'},{e:'üçú',n:'–ê–∑–∏—è'},{e:'üåÆ',n:'–§–∞—Å—Ç—Ñ—É–¥'},{e:'üç¶',n:'–î–µ—Å–µ—Ä—Ç—ã'}];

window.addEventListener('load', () => {
  document.getElementById('catsList').innerHTML = CATS.map((c,i) =>
    `<button class="cat-btn ${i===0?'active':''}" onclick="filterByCat(this,'${c.n}')">${c.e}<span class="cat-name">${c.n}</span></button>`
  ).join('');
  renderRests(RESTS);
  if (TOKEN) loadProfile();
  setTimeout(() => {
    const lo = document.getElementById('loading');
    lo.style.opacity = '0'; setTimeout(() => lo.style.display = 'none', 400);
  }, 900);
  document.getElementById('addressText').textContent = TOKEN ? '–ú–æ–π –∞–¥—Ä–µ—Å' : '–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å';
});

async function apiCall(path, body) {
  try {
    const r = await fetch(BASE+path, {method:'POST', headers:HDRS, body:JSON.stringify(body), credentials:'include'});
    if (!r.ok) return null;
    return await r.json();
  } catch { return null; }
}

async function loadProfile() {
  const d = await apiCall('/eats/v1/launch/v2/native', {experiments:{consumer:'eda_ab_service',args:[{name:'application',type:'string',value:'eda_ios_app'},{name:'version',type:'application_version',value:APP_VERSION},{name:'device_id',type:'string',value:DEVICE_ID}],user_agent:MOBILE_UA}});
  if (d && d.profile) {
    profile = d.profile;
    document.getElementById('profileName').textContent = profile.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    document.getElementById('profileUid').textContent = 'UID: ' + (profile.passport_uid || '‚Äî');
  } else {
    document.getElementById('profileName').textContent = '–ì–æ—Å—Ç—å';
    document.getElementById('profileUid').textContent = '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
  }
}

function filterByCat(btn, cat) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const f = RESTS.filter(r => r.tags.some(t => t.includes(cat) || cat === '–ë—É—Ä–≥–µ—Ä—ã' && r.tags.includes('–ë—É—Ä–≥–µ—Ä—ã')));
  renderRests(f.length ? f : RESTS);
}

function filterRestaurants(q) {
  if (!q) { renderRests(RESTS); return; }
  q = q.toLowerCase();
  renderRests(RESTS.filter(r => r.name.toLowerCase().includes(q) || r.tags.some(t => t.toLowerCase().includes(q)) || r.cats.some(c => c.items.some(i => i.n.toLowerCase().includes(q)))));
}

function renderRests(list) {
  const el = document.getElementById('restaurantsList');
  if (!list.length) { el.innerHTML = '<div style="text-align:center;padding:40px;color:var(--gray-text);">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üîç</div>'; return; }
  el.innerHTML = list.map(r => `
    <div class="rest-card" onclick="openRest('${r.id}')">
      <div class="rest-img-placeholder" style="background:${r.bg}">
        <span style="font-size:60px">${r.emoji}</span>
        <div class="rest-badge free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
      </div>
      <div class="rest-info">
        <div class="rest-name">${r.name}</div>
        <div class="rest-meta">
          <span class="rest-rating">‚òÖ ${r.rating}</span>
          <span class="rest-time">‚è± ${r.time} –º–∏–Ω</span>
          <span class="rest-delivery">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</span>
        </div>
        <div class="rest-tags">${r.tags.map(t=>`<span class="rest-tag">${t}</span>`).join('')}</div>
      </div>
    </div>
  `).join('');
}

function openRest(id) {
  currentRest = RESTS.find(r => r.id === id);
  if (!currentRest) return;
  renderMenu();
  goTo('menu');
}

function renderMenu() {
  const r = currentRest;
  document.getElementById('menuHeroImg').innerHTML = `<span style="font-size:70px;background:${r.bg};width:100%;height:100%;display:flex;align-items:center;justify-content:center;">${r.emoji}</span>`;
  document.getElementById('menuRestName').textContent = r.name;
  document.getElementById('menuRestMeta').innerHTML = `
    <span class="menu-rest-badge delivery">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</span>
    <span class="menu-rest-badge time">‚è± ${r.time} –º–∏–Ω</span>
    <span class="menu-rest-badge time">‚òÖ ${r.rating}</span>`;
  document.getElementById('menuCatTabs').innerHTML = r.cats.map((c,i) =>
    `<button class="menu-cat-tab ${i===0?'active':''}" onclick="scrollCat(${i},this)">${c.n}</button>`
  ).join('');
  document.getElementById('menuItemsContainer').innerHTML = r.cats.map((cat,ci) => `
    <div class="menu-section" id="ms${ci}">
      <div class="menu-section-title">${cat.n}</div>
      <div class="menu-items">${cat.items.map(item => renderMenuItem(item)).join('')}</div>
    </div>`
  ).join('') + '<div style="height:24px;"></div>';
}

function renderMenuItem(item) {
  const q = getQty(item.id);
  return `<div class="menu-item" onclick='openModal(${JSON.stringify(item)})'>
    <div class="menu-item-img">${item.e}</div>
    <div class="menu-item-body">
      <div class="menu-item-name">${item.n}</div>
      <div class="menu-item-desc">${item.d}</div>
      <div class="menu-item-weight">${item.w}</div>
      <div class="menu-item-footer">
        <div class="menu-item-price">–æ—Ç ${item.p} ‚ÇΩ</div>
        ${q > 0
          ? `<div class="qty-ctrl"><button class="qty-btn" onclick="event.stopPropagation();adjQty(${item.id},-1)">‚àí</button><span class="qty-num">${q}</span><button class="qty-btn" onclick="event.stopPropagation();adjQty(${item.id},1)">+</button></div>`
          : `<button class="add-btn" onclick='event.stopPropagation();quickAdd(${JSON.stringify(item)})'>+</button>`}
      </div>
    </div>
  </div>`;
}

function scrollCat(i, btn) {
  document.querySelectorAll('.menu-cat-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('ms'+i)?.scrollIntoView({behavior:'smooth',block:'start'});
}

// MODAL
function openModal(item) {
  modalItem = item; modalQty = 1; selectedOpt = null;
  const mi = document.getElementById('modalImg');
  mi.innerHTML = `<span style="font-size:80px">${item.e}</span><button class="modal-close" onclick="closeModal()">‚úï</button>`;
  document.getElementById('modalName').textContent = item.n;
  document.getElementById('modalDesc').textContent = item.d || '';
  document.getElementById('modalWeight').textContent = item.w || '';
  document.getElementById('modalQty').textContent = '1';
  const ow = document.getElementById('modalOptsWrap');
  if (item.opts && item.opts.length) {
    const g = item.opts[0];
    document.getElementById('modalOptsTitle').textContent = g.g;
    document.getElementById('modalOpts').innerHTML = g.i.map((o,idx) =>
      `<div class="modal-opt ${idx===0?'selected':''}" onclick="pickOpt(this,${JSON.stringify(o)})">
        <span class="modal-opt-name">${o.n}</span>
        <span class="modal-opt-price">${o.p>0?'+'+o.p+' ‚ÇΩ':'–±–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
      </div>`).join('');
    selectedOpt = g.i[0];
    ow.style.display = 'block';
  } else { ow.style.display = 'none'; }
  updateModalPrice();
  document.getElementById('itemModal').classList.add('open');
}

function pickOpt(el, opt) {
  document.querySelectorAll('.modal-opt').forEach(e => e.classList.remove('selected'));
  el.classList.add('selected'); selectedOpt = opt; updateModalPrice();
}

function updateModalPrice() {
  if (!modalItem) return;
  let p = modalItem.p + (selectedOpt && selectedOpt.p > 0 ? selectedOpt.p : 0);
  document.getElementById('modalAddPrice').textContent = (p * modalQty) + ' ‚ÇΩ';
}

function changeModalQty(d) {
  modalQty = Math.max(1, modalQty + d);
  document.getElementById('modalQty').textContent = modalQty;
  updateModalPrice();
}

function addFromModal() {
  if (!modalItem || !currentRest) return;
  const on = selectedOpt ? selectedOpt.n : '';
  const op = selectedOpt ? (selectedOpt.p || 0) : 0;
  for (let i = 0; i < modalQty; i++) addToCart(modalItem, on, op);
  closeModal();
  showToast(modalItem.n + ' –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
}

function closeModal() {
  document.getElementById('itemModal').classList.remove('open');
  modalItem = null;
}
document.getElementById('itemModal').addEventListener('click', e => { if (e.target === document.getElementById('itemModal')) closeModal(); });

function quickAdd(item) {
  if (item.opts && item.opts.length) { openModal(item); return; }
  addToCart(item, '', 0);
  showToast(item.n + ' –¥–æ–±–∞–≤–ª–µ–Ω');
  renderMenu();
}

// CART
function addToCart(item, optName, optPrice) {
  if (!cart.items) cart = {slug: currentRest.slug, restName: currentRest.name, items: []};
  if (cart.slug !== currentRest.slug) {
    if (!confirm(`–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –æ—Ç "${cart.restName}"?`)) return;
    cart = {slug: currentRest.slug, restName: currentRest.name, items: []};
  }
  const key = item.id + '_' + optName;
  const ex = cart.items.find(i => i.key === key);
  if (ex) ex.qty++;
  else cart.items.push({key, iid: item.id, n: item.n, p: item.p + optPrice, e: item.e, on: optName, qty: 1});
  updateBadge();
}

function adjQty(iid, d) {
  if (!cart.items) return;
  const idx = cart.items.findIndex(i => i.iid === iid);
  if (idx < 0) return;
  cart.items[idx].qty += d;
  if (cart.items[idx].qty <= 0) cart.items.splice(idx, 1);
  if (!cart.items.length) cart = {};
  updateBadge(); renderMenu();
}

function getQty(iid) { return cart.items ? cart.items.filter(i => i.iid === iid).reduce((s,i) => s+i.qty, 0) : 0; }
function getTotal() { return cart.items ? cart.items.reduce((s,i) => s+i.p*i.qty, 0) : 0; }
function getCount() { return cart.items ? cart.items.reduce((s,i) => s+i.qty, 0) : 0; }
function updateBadge() { const c = getCount(); document.getElementById('cartBadge').textContent = c > 0 ? c : ''; }
function clearCart() { cart = {}; updateBadge(); }

function renderCartScreen() {
  if (!cart.items || !cart.items.length) {
    document.getElementById('cartEmpty').style.display = 'flex';
    document.getElementById('cartFilled').style.display = 'none';
    return;
  }
  document.getElementById('cartEmpty').style.display = 'none';
  document.getElementById('cartFilled').style.display = 'block';
  document.getElementById('cartRestName').textContent = 'üì¶ ' + (cart.restName || '');
  document.getElementById('cartItemsList').innerHTML = cart.items.map(ci => `
    <div class="cart-item">
      <div class="cart-item-emoji">${ci.e}</div>
      <div class="cart-item-body">
        <div class="cart-item-name">${ci.n}</div>
        ${ci.on ? `<div class="cart-item-opt">${ci.on}</div>` : ''}
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
        <div style="font-size:14px;font-weight:800;color:var(--black);">${ci.p*ci.qty} ‚ÇΩ</div>
        <div style="display:flex;align-items:center;gap:6px;">
          <button class="cart-qty-btn" onclick="adjQty(${ci.iid},-1);renderCartScreen()">‚àí</button>
          <span class="cart-qty-num">${ci.qty}</span>
          <button class="cart-qty-btn" onclick="adjQty(${ci.iid},1);renderCartScreen()">+</button>
        </div>
      </div>
    </div>`).join('');
  const sub = getTotal(), fee = Math.round(sub * 0.05), total = sub + fee;
  document.getElementById('summaryItems').textContent = sub + ' ‚ÇΩ';
  document.getElementById('summaryFee').textContent = fee + ' ‚ÇΩ';
  document.getElementById('summaryTotal').textContent = total + ' ‚ÇΩ';
  document.getElementById('checkoutBtnTotal').textContent = total + ' ‚ÇΩ';
}

async function applyPromo() {
  const c = document.getElementById('promoInput').value.trim().toUpperCase();
  if (!c) return;
  if (!TOKEN) { showToast('‚ùå –ù—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç'); return; }
  showToast('‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é –ø—Ä–æ–º–æ–∫–æ–¥...');
  // –†–µ–∞–ª—å–Ω—ã–π API –Ø–Ω–¥–µ–∫—Å –ï–¥—ã –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (–º–æ–±–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)
  const d = await apiCall('/api/v1/promotions/apply_code', {
    code: c,
    place_slug: cart.slug || '',
    location: { latitude: LAT, longitude: LON }
  });
  if (d && d.discount) {
    const disc = d.discount;
    const txt = disc.amount ? `‚àí${disc.amount} ‚ÇΩ` : disc.percent ? `‚àí${disc.percent}%` : '—Å–∫–∏–¥–∫–∞';
    showToast(`‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω: ${txt}`);
  } else if (d && d.message) {
    showToast(`‚ùå ${d.message}`);
  } else if (d && d.error) {
    showToast(`‚ùå ${d.error}`);
  } else {
    showToast('‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –∏—Å—Ç—ë–∫');
  }
}

function renderCheckoutScreen() {
  document.getElementById('checkoutAddr').textContent = '–í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è, 8';
  const sub = getTotal(), fee = Math.round(sub * 0.05), total = sub + fee;
  document.getElementById('checkoutTotal').textContent = total + ' ‚ÇΩ';
  document.getElementById('placeOrderTotal').textContent = total + ' ‚ÇΩ';
  document.getElementById('checkoutItems').innerHTML = (cart.items||[]).map(ci =>
    `<div class="summary-row"><span class="summary-label">${ci.n} √ó ${ci.qty}</span><span class="summary-value">${ci.p*ci.qty} ‚ÇΩ</span></div>`
  ).join('');
}

function selectPay(el, method) {
  document.querySelectorAll('.pay-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected'); selectedPay = method;
}

async function placeOrder() {
  const btn = document.getElementById('placeOrderBtn');
  btn.disabled = true; btn.textContent = '‚è≥ –û—Ñ–æ—Ä–º–ª—è—é –∑–∞–∫–∞–∑...';
  let nr = null;
  if (TOKEN && cart.slug) {
    const reqId = crypto.randomUUID().replace(/-/g,'') + '.' + crypto.randomUUID().replace(/-/g,'');
    const comment = document.getElementById('checkoutComment').value;
    const d = await apiCall('/api/v1/orders', {
      courier_options:[], persons_quantity:1, request_id:reqId,
      location:{latitude:LAT,longitude:LON}, comment,
      payment:{recently_link_cards:false},
      payment_method_id: selectedPay==='sbp'?5:selectedPay==='card'?2:1,
      place_slug:cart.slug, phone:'+70000000000',
      extended_options:[{type:'delivery_options'}],
      // –ú–æ–±–∏–ª—å–Ω—ã–µ –ø–æ–ª—è ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞
      client_type: 'ios_app',
      app_version: APP_VERSION,
      device_id: DEVICE_ID,
      address:{house:'8',short_text:'–í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è, 8',country:'–†–æ—Å—Å–∏—è',city:'–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥',street:'–í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è',location:{latitude:LAT,longitude:LON},type:{id:0}},
      payment_information:{type:selectedPay,id:selectedPay+'_qr',costForCustomer:String(getTotal())}
    });
    if (d && d.order_nr) nr = d.order_nr;
  }
  if (!nr) {
    const d = new Date();
    nr = `${String(d.getDate()).padStart(2,'0')}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getFullYear()).slice(-2)}-${Math.floor(1000000+Math.random()*9000000)}`;
  }
  showOrderStatus(nr);
  btn.disabled = false;
}

function showOrderStatus(nr) {
  document.getElementById('orderNr').textContent = nr;
  const fmt = d => d.getHours()+':'+String(d.getMinutes()).padStart(2,'0');
  document.getElementById('step1time').textContent = fmt(new Date());
  goTo('order');
  setTimeout(() => {
    document.getElementById('step2dot').textContent='‚úì'; document.getElementById('step2dot').className='track-dot done';
    document.getElementById('step3dot').className='track-dot active'; document.getElementById('step3time').textContent='~10 –º–∏–Ω';
  }, 6000);
  setTimeout(() => {
    document.getElementById('step3dot').textContent='‚úì'; document.getElementById('step3dot').className='track-dot done';
    document.getElementById('step4dot').className='track-dot active'; document.getElementById('step4time').textContent=fmt(new Date(Date.now()+5*60000));
  }, 14000);
}

// NAV
function goTo(screen) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-'+screen).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  const nb = document.getElementById('nav-'+screen);
  if (nb) nb.classList.add('active');
  const top = document.getElementById('mainTopbar');
  const tabs = document.getElementById('catalogTabs');
  const bnav = document.getElementById('bottomNav');
  if (screen==='catalog') { top.style.display='block'; tabs.style.display='flex'; bnav.style.display='flex'; }
  else if (screen==='menu') { top.style.display='none'; tabs.style.display='none'; bnav.style.display='flex'; }
  else if (screen==='cart') { top.style.display='none'; tabs.style.display='none'; bnav.style.display='flex'; renderCartScreen(); }
  else if (screen==='checkout') { top.style.display='none'; tabs.style.display='none'; bnav.style.display='none'; renderCheckoutScreen(); }
  else if (screen==='order') { top.style.display='none'; tabs.style.display='none'; bnav.style.display='none'; }
  else if (screen==='profile') { top.style.display='none'; tabs.style.display='none'; bnav.style.display='flex'; if (!profile) { document.getElementById('profileName').textContent=TOKEN?'–ó–∞–≥—Ä—É–∑–∫–∞...':'–ì–æ—Å—Ç—å'; document.getElementById('profileUid').textContent=TOKEN?'':'–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞'; } }
  currentScreen = screen;
  document.getElementById('mainContent').scrollTo(0,0);
}

function selectTab(t, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (t==='offline') showToast('–ö–∞—Ä—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç');
}

let toastT;
function showToast(msg) {
  const el = document.getElementById('toast'); el.textContent = msg; el.classList.add('show');
  clearTimeout(toastT); toastT = setTimeout(() => el.classList.remove('show'), 2500);
}

goTo('catalog');
</script>
</body>
</html>
