<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–Ø–Ω–¥–µ–∫—Å –ï–¥–∞</title>
<style>
:root{--y:#FFE033;--bl:#1A1A1A;--bg:#F5F5F5;--gt:#8C8C8C;--gb:#E8E8E8;--gn:#029154;--rd:#E63946;--st:env(safe-area-inset-top,0px);--sb:env(safe-area-inset-bottom,0px)}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;font-family:-apple-system,'SF Pro Display','Helvetica Neue',sans-serif;background:var(--bg)}
#app{height:100dvh;display:flex;flex-direction:column;overflow:hidden}
.topbar{background:var(--y);padding:calc(var(--st)+12px) 16px 12px;flex-shrink:0;z-index:100}
.topbar-inner{display:flex;align-items:center;gap:10px}
.logo{font-size:22px;font-weight:900;color:var(--bl);flex-shrink:0}
.addr-btn{flex:1;display:flex;align-items:center;gap:6px;background:rgba(0,0,0,.08);border-radius:12px;padding:8px 12px;border:none;text-align:left;min-width:0;cursor:pointer}
.addr-text{font-size:13px;font-weight:600;color:var(--bl);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}
.profile-btn{width:36px;height:36px;border-radius:50%;background:rgba(0,0,0,.1);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.tabs{background:var(--y);display:flex;padding:0 16px 12px;gap:8px;flex-shrink:0}
.tab-btn{padding:7px 16px;border-radius:20px;border:none;font-size:13px;font-weight:600;cursor:pointer}
.tab-btn.active{background:var(--bl);color:#fff}
.tab-btn:not(.active){background:rgba(0,0,0,.08);color:var(--bl)}
.content{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain}
.content::-webkit-scrollbar{display:none}
.screen{display:none}.screen.active{display:block}
/* ADDRESS MODAL */
.addr-modal{position:fixed;inset:0;background:#fff;z-index:300;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .35s ease}
.addr-modal.open{transform:none}
.addr-modal-head{padding:calc(var(--st)+16px) 16px 12px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--gb)}
.addr-modal-back{background:none;border:none;font-size:24px;cursor:pointer;color:var(--bl);padding:0}
.addr-sbox{flex:1;display:flex;align-items:center;gap:8px;background:var(--bg);border-radius:12px;padding:10px 14px}
.addr-sinp{flex:1;border:none;outline:none;font-size:15px;background:transparent}
.addr-results{overflow-y:auto;flex:1}
.addr-ri{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--gb);cursor:pointer}
.addr-ri:active{background:var(--bg)}
.addr-ri-icon{font-size:20px;width:38px;height:38px;background:var(--bg);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.addr-ri-main{font-size:14px;font-weight:600;color:var(--bl)}
.addr-ri-sub{font-size:12px;color:var(--gt);margin-top:2px}
/* CATALOG */
.search-wrap{padding:12px 16px 8px}
.search-box{display:flex;align-items:center;gap:8px;background:#fff;border-radius:14px;padding:10px 14px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.search-inp{flex:1;border:none;outline:none;font-size:15px;background:transparent}
.search-inp::placeholder{color:#b0b0b0}
.banners{display:flex;gap:12px;padding:12px 16px;overflow-x:auto;scrollbar-width:none}
.banners::-webkit-scrollbar{display:none}
.banner{min-width:260px;height:110px;border-radius:20px;display:flex;align-items:flex-end;padding:14px;flex-shrink:0;cursor:pointer;position:relative;overflow:hidden}
.banner:active{transform:scale(.97)}
.b1{background:linear-gradient(135deg,#ff6b35,#ff3d3d)}
.b2{background:linear-gradient(135deg,#6c5ce7,#a29bfe)}
.b3{background:linear-gradient(135deg,#00b894,#00cec9)}
.banner-text{color:#fff;font-weight:800;font-size:15px;line-height:1.2}
.banner-emoji{position:absolute;right:14px;top:14px;font-size:42px}
.cats{display:flex;gap:10px;padding:4px 16px 12px;overflow-x:auto;scrollbar-width:none}
.cats::-webkit-scrollbar{display:none}
.cat-btn{display:flex;flex-direction:column;align-items:center;gap:4px;background:#fff;border-radius:16px;padding:10px 14px;min-width:72px;border:none;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.cat-btn.active{background:var(--bl)}.cat-btn.active .cat-name{color:#fff}
.cat-emoji{font-size:26px}.cat-name{font-size:11px;font-weight:600;color:var(--bl);white-space:nowrap}
.rests{padding:4px 16px;display:flex;flex-direction:column;gap:14px}
.rest-card{background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.06);cursor:pointer}
.rest-card:active{transform:scale(.98)}
.rest-img{width:100%;height:150px;position:relative;overflow:hidden;background:var(--bg);display:flex;align-items:center;justify-content:center}
.rest-img img{width:100%;height:100%;object-fit:cover}
.rest-badge{position:absolute;top:10px;left:10px;font-size:11px;font-weight:700;padding:3px 8px;border-radius:8px;background:var(--gn);color:#fff}
.rest-info{padding:12px 14px}
.rest-name{font-size:16px;font-weight:700;color:var(--bl);margin-bottom:5px}
.rest-meta{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.rest-rating{font-size:13px;font-weight:600;color:var(--bl)}
.rest-time{font-size:13px;color:var(--gt)}
.rest-free{font-size:13px;font-weight:600;color:var(--gn)}
.rest-tags{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
.rest-tag{font-size:11px;color:var(--gt);background:var(--bg);border-radius:6px;padding:2px 7px}
.section-title{padding:8px 16px 4px;font-size:18px;font-weight:800;color:var(--bl)}
/* MENU */
.menu-hero{position:relative}
.menu-hero-img{width:100%;height:200px;overflow:hidden;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:70px}
.menu-hero-img img{width:100%;height:100%;object-fit:cover}
.menu-back{position:absolute;top:calc(var(--st)+12px);left:12px;width:38px;height:38px;border-radius:50%;background:#fff;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.menu-info{padding:14px 16px 10px;background:#fff}
.menu-name{font-size:22px;font-weight:800;color:var(--bl);margin-bottom:6px}
.menu-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.menu-badge{font-size:12px;font-weight:600;padding:3px 10px;border-radius:10px}
.mb-g{background:#e8f8ee;color:var(--gn)}.mb-y{background:#fff5d0;color:#b8860b}
.menu-cats{display:flex;gap:8px;padding:10px 16px;overflow-x:auto;scrollbar-width:none;border-top:1px solid var(--gb);background:#fff;position:sticky;top:0;z-index:50}
.menu-cats::-webkit-scrollbar{display:none}
.mct{padding:6px 14px;border-radius:20px;border:none;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap}
.mct.active{background:var(--bl);color:#fff}
.mct:not(.active){background:var(--bg);color:var(--bl)}
.menu-sec{padding:16px 16px 0}
.menu-sec-title{font-size:18px;font-weight:800;color:var(--bl);margin-bottom:12px}
.menu-items-list{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.mi{background:#fff;border-radius:16px;padding:12px;display:flex;gap:12px;align-items:flex-start;box-shadow:0 1px 4px rgba(0,0,0,.05);cursor:pointer}
.mi:active{transform:scale(.98)}
.mi-img{width:88px;height:88px;border-radius:12px;flex-shrink:0;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:36px;overflow:hidden}
.mi-img img{width:100%;height:100%;object-fit:cover}
.mi-body{flex:1;min-width:0}
.mi-name{font-size:14px;font-weight:700;color:var(--bl);margin-bottom:4px;line-height:1.3}
.mi-desc{font-size:12px;color:var(--gt);line-height:1.4;margin-bottom:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.mi-w{font-size:11px;color:#b0b0b0;margin-bottom:6px}
.mi-foot{display:flex;align-items:center;justify-content:space-between}
.mi-price{font-size:15px;font-weight:800;color:var(--bl)}
.add-btn{width:32px;height:32px;border-radius:10px;background:var(--y);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;flex-shrink:0}
.add-btn:active{transform:scale(.88)}
.qc{display:flex;align-items:center;gap:8px}
.qb{width:30px;height:30px;border-radius:8px;background:var(--bg);border:none;cursor:pointer;font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;color:var(--bl)}
.qn{font-size:15px;font-weight:800;min-width:20px;text-align:center}
/* CART */
.cart-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:80px 32px;text-align:center;gap:16px}
.ceg{font-size:64px}.cet{font-size:20px;font-weight:800;color:var(--bl)}.ces{font-size:14px;color:var(--gt)}
.cart-go{margin-top:8px;background:var(--y);color:var(--bl);border:none;border-radius:14px;padding:14px 28px;font-size:15px;font-weight:700;cursor:pointer}
.cart-content{padding:16px}
.cart-rest-lbl{font-size:13px;color:var(--gt);margin-bottom:12px}
.cart-items-list{display:flex;flex-direction:column;gap:10px;margin-bottom:16px}
.ci{background:#fff;border-radius:16px;padding:12px;display:flex;gap:10px;align-items:center;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.ci-img{width:48px;height:48px;border-radius:10px;background:var(--bg);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:22px;overflow:hidden}
.ci-img img{width:100%;height:100%;object-fit:cover}
.ci-body{flex:1;min-width:0}
.ci-name{font-size:13px;font-weight:700;color:var(--bl);line-height:1.3}
.ci-opt{font-size:11px;color:var(--gt)}
.cqb{width:26px;height:26px;border-radius:7px;background:var(--bg);border:none;cursor:pointer;font-size:16px;font-weight:700;color:var(--bl);display:flex;align-items:center;justify-content:center}
.cqn{font-size:14px;font-weight:800;min-width:18px;text-align:center}
.promo-row{background:#fff;border-radius:16px;padding:14px;margin-bottom:14px;display:flex;gap:10px;align-items:center;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.promo-inp{flex:1;border:none;outline:none;font-size:14px;background:transparent}
.promo-apply{background:var(--y);border:none;border-radius:10px;padding:8px 14px;font-size:13px;font-weight:700;color:var(--bl);cursor:pointer}
.sum-box{background:#fff;border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.sr{display:flex;justify-content:space-between;margin-bottom:10px}.sr:last-child{margin-bottom:0}
.sl{font-size:14px;color:var(--gt)}.sv{font-size:14px;font-weight:600;color:var(--bl)}
.st-row .sl,.st-row .sv{font-size:16px;font-weight:800;color:var(--bl)}
.sdiv{height:1px;background:var(--gb);margin:10px 0}
.sfree{color:var(--gn)}
.checkout-btn{width:100%;background:var(--y);color:var(--bl);border:none;border-radius:16px;padding:16px;font-size:16px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:space-between}
/* CHECKOUT */
.co-sec{background:#fff;border-radius:20px;margin:12px 16px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.co-title{font-size:15px;font-weight:800;color:var(--bl);margin-bottom:12px}
.co-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--gb);cursor:pointer}
.co-row:last-child{border-bottom:none;padding-bottom:0}
.co-icon{font-size:20px;width:36px;height:36px;background:var(--bg);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.co-body{flex:1}.co-l{font-size:12px;color:var(--gt)}.co-v{font-size:14px;font-weight:600;color:var(--bl)}
.pay-opts{display:flex;gap:8px;flex-wrap:wrap}
.pay-opt{flex:1;min-width:80px;padding:10px;border-radius:12px;border:2px solid var(--gb);text-align:center;cursor:pointer}
.pay-opt.sel{border-color:var(--bl);background:var(--bl);color:#fff}
.poi{font-size:20px;margin-bottom:2px}.pon{font-size:11px;font-weight:600}
.place-btn{margin:12px 16px calc(12px + var(--sb));width:calc(100% - 32px);background:var(--y);color:var(--bl);border:none;border-radius:16px;padding:17px;font-size:17px;font-weight:800;cursor:pointer;display:block}
.place-btn:disabled{opacity:.6}
/* ORDER TRACKING */
.order-wrap{padding:20px 16px;text-align:center}
.ord-chk{font-size:64px;margin-bottom:16px}
.ord-title{font-size:24px;font-weight:900;color:var(--bl);margin-bottom:8px}
.ord-sub{font-size:15px;color:var(--gt);margin-bottom:24px}
.ord-nr{background:#fff;border-radius:16px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.06);margin-bottom:12px}
.onrl{font-size:12px;color:var(--gt);margin-bottom:4px}.onrv{font-size:20px;font-weight:900;color:var(--bl)}
.track-box{background:#fff;border-radius:16px;padding:20px;box-shadow:0 1px 4px rgba(0,0,0,.06);margin-bottom:20px}
.ts{display:flex;gap:14px;align-items:flex-start;margin-bottom:16px;position:relative}
.ts:last-child{margin-bottom:0}
.ts-line{position:absolute;left:14px;top:30px;width:2px;height:calc(100% + 4px);background:var(--gb)}
.ts:last-child .ts-line{display:none}
.ts-dot{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;z-index:1}
.tdd{background:var(--gn);color:#fff}.tda{background:var(--y);animation:pulse 1.5s infinite}.tdp{background:var(--gb)}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.ts-label{font-size:14px;font-weight:700;color:var(--bl)}.ts-time{font-size:12px;color:var(--gt);margin-top:2px}
.ts-text{padding-top:4px}
.back-main{width:100%;background:var(--y);color:var(--bl);border:none;border-radius:14px;padding:15px;font-size:15px;font-weight:800;cursor:pointer}
/* PROFILE */
.prof-head{background:var(--y);padding:calc(var(--st)+20px) 16px 24px}
.prof-head-row{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.prof-av{width:72px;height:72px;border-radius:50%;background:rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;overflow:hidden}
.prof-av img{width:100%;height:100%;object-fit:cover}
.prof-nm{font-size:20px;font-weight:800;color:var(--bl)}.prof-uid{font-size:12px;color:rgba(0,0,0,.5);margin-top:2px}
.prof-plus{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,.08);border-radius:14px;padding:10px 14px}
.pp-icon{font-size:20px}.pp-text{font-size:13px;font-weight:600;color:var(--bl);flex:1}
.pp-st{font-size:11px;font-weight:700;color:var(--gt);background:#fff;border-radius:8px;padding:3px 8px}
.plus-bal{font-size:13px;font-weight:700;color:#ffa500;margin-left:8px}
.prof-menu{padding:16px;display:flex;flex-direction:column;gap:10px}
.prof-sec{background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.pi{padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;border-bottom:1px solid var(--gb)}
.pi:last-child{border-bottom:none}.pi:active{background:var(--bg)}
.pi-ic{font-size:22px;width:40px;height:40px;background:var(--bg);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.pi-bd{flex:1}.pi-tx{font-size:15px;font-weight:600;color:var(--bl)}.pi-sb{font-size:12px;color:var(--gt);margin-top:1px}
.pi-ar{color:var(--gt);font-size:16px}
/* SUB-SCREENS */
.orders-list{padding:12px 16px;display:flex;flex-direction:column;gap:12px}
.ord-card{background:#fff;border-radius:20px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.oc-head{display:flex;justify-content:space-between;margin-bottom:8px}
.oc-nr{font-size:14px;font-weight:800;color:var(--bl)}.oc-date{font-size:12px;color:var(--gt)}
.oc-rest{font-size:14px;color:var(--gt);margin-bottom:6px}
.oc-items{font-size:13px;color:var(--bl);font-weight:600;margin-bottom:8px}
.oc-foot{display:flex;align-items:center;justify-content:space-between}
.oc-total{font-size:15px;font-weight:800;color:var(--bl)}
.ob{font-size:11px;font-weight:700;padding:3px 10px;border-radius:10px}
.ob-ok{background:#e8f8ee;color:var(--gn)}.ob-no{background:#fee;color:var(--rd)}.ob-pend{background:#fff5d0;color:#b8860b}
.addr-card{background:#fff;border-radius:16px;padding:14px 16px;margin:0 16px 10px;display:flex;align-items:center;gap:12px;box-shadow:0 1px 4px rgba(0,0,0,.05);cursor:pointer}
.ac-ic{font-size:22px;width:40px;height:40px;background:var(--bg);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ac-bd{flex:1}.ac-nm{font-size:14px;font-weight:700;color:var(--bl)}.ac-fl{font-size:12px;color:var(--gt);margin-top:2px}
.pay-card{background:#fff;border-radius:16px;padding:14px 16px;margin:0 16px 10px;display:flex;align-items:center;gap:12px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.pc-ic{font-size:22px;width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.pc-bd{flex:1}.pc-nm{font-size:14px;font-weight:700;color:var(--bl)}.pc-sb{font-size:12px;color:var(--gt);margin-top:2px}
.promo-card{background:#fff;border-radius:16px;padding:16px;margin:0 16px 10px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.promo-code{font-size:16px;font-weight:800;color:var(--bl);margin-bottom:4px;font-family:monospace;letter-spacing:1px}
.promo-desc{font-size:13px;color:var(--gt)}
.promo-bdg{display:inline-block;margin-top:8px;font-size:11px;font-weight:700;padding:3px 10px;border-radius:8px;background:#e8f8ee;color:var(--gn)}
.sup-chat{padding:16px;display:flex;flex-direction:column;gap:12px;overflow-y:auto;flex:1}
.sm{max-width:80%;padding:12px 14px;border-radius:16px;font-size:14px;line-height:1.4}
.sm-b{background:#fff;color:var(--bl);align-self:flex-start;border-bottom-left-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.sm-u{background:var(--bl);color:#fff;align-self:flex-end;border-bottom-right-radius:4px}
.sup-inp-row{padding:12px 16px calc(12px + var(--sb));background:#fff;border-top:1px solid var(--gb);display:flex;gap:10px;align-items:center;flex-shrink:0}
.sup-inp{flex:1;border:1px solid var(--gb);border-radius:20px;padding:10px 14px;font-size:14px;outline:none;background:var(--bg)}
.sup-send{width:40px;height:40px;border-radius:50%;background:var(--y);border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.scr-hdr{display:flex;align-items:center;gap:10px;padding:calc(var(--st)+12px) 16px 12px;background:#fff;position:sticky;top:0;z-index:10;border-bottom:1px solid var(--gb);flex-shrink:0}
.back-btn{background:none;border:none;font-size:24px;cursor:pointer;padding:0;color:var(--bl);line-height:1}
.scr-title{font-size:18px;font-weight:800;color:var(--bl)}
/* ITEM MODAL */
.item-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:opacity .3s}
.item-modal.open{opacity:1;pointer-events:all}
.modal{background:#fff;border-radius:24px 24px 0 0;width:100%;max-height:90vh;overflow-y:auto;padding-bottom:calc(20px + var(--sb));transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.56,.64,1)}
.item-modal.open .modal{transform:none}
.modal-img{width:100%;height:220px;display:flex;align-items:center;justify-content:center;font-size:80px;background:var(--bg);border-radius:24px 24px 0 0;overflow:hidden;position:relative}
.modal-img img{width:100%;height:100%;object-fit:cover}
.modal-close{position:absolute;top:14px;right:14px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,.4);border:none;cursor:pointer;color:#fff;font-size:16px;display:flex;align-items:center;justify-content:center}
.modal-body{padding:20px 20px 0}
.modal-name{font-size:22px;font-weight:800;color:var(--bl);margin-bottom:8px}
.modal-desc{font-size:14px;color:var(--gt);line-height:1.5;margin-bottom:8px}
.modal-w{font-size:13px;color:#b0b0b0;margin-bottom:18px}
.mots{font-size:15px;font-weight:700;color:var(--bl);margin-bottom:10px}
.modal-opts{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.mo{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-radius:12px;border:2px solid var(--gb);cursor:pointer}
.mo.sel{border-color:var(--bl);background:#f8f8f8}
.mo-n{font-size:14px;font-weight:500}.mo-p{font-size:13px;color:var(--gt);font-weight:600}
.modal-add-row{display:flex;align-items:center;gap:12px;margin-top:4px}
.mqc{display:flex;align-items:center;gap:12px}
.mqb{width:36px;height:36px;border-radius:10px;background:var(--bg);border:none;cursor:pointer;font-size:20px;font-weight:700;color:var(--bl);display:flex;align-items:center;justify-content:center}
.mqn{font-size:18px;font-weight:800;min-width:24px;text-align:center}
.modal-add-btn{flex:1;background:var(--y);color:var(--bl);border:none;border-radius:14px;padding:15px;font-size:15px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:space-between}
/* NAV */
.bottom-nav{display:flex;background:#fff;border-top:1px solid var(--gb);padding:8px 0 calc(8px + var(--sb));flex-shrink:0;z-index:100}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;border:none;background:transparent;cursor:pointer;padding:4px 0}
.nav-icon{font-size:22px;position:relative;display:inline-block}
.nav-label{font-size:10px;font-weight:600;color:var(--gt)}.nav-btn.active .nav-label{color:var(--bl)}
.cbadge{position:absolute;top:-4px;right:-8px;background:var(--rd);color:#fff;font-size:9px;font-weight:800;min-width:16px;height:16px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 3px;border:2px solid #fff}
.loading{position:fixed;inset:0;background:var(--y);display:flex;align-items:center;justify-content:center;z-index:1000;transition:opacity .4s;flex-direction:column;gap:12px}
.loading-logo{font-size:42px;font-weight:900;color:var(--bl)}.loading-sub{font-size:14px;color:rgba(0,0,0,.4)}
.toast{position:fixed;bottom:calc(80px + var(--sb));left:50%;transform:translateX(-50%) translateY(20px);background:var(--bl);color:#fff;border-radius:14px;padding:12px 20px;font-size:14px;font-weight:600;z-index:500;opacity:0;transition:all .3s;white-space:nowrap;pointer-events:none;max-width:90vw;overflow:hidden;text-overflow:ellipsis}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.spinner{display:flex;justify-content:center;padding:40px}
.spin{width:32px;height:32px;border:3px solid var(--gb);border-top-color:var(--bl);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:60px 32px;color:var(--gt)}
.eic{font-size:48px;margin-bottom:12px}.etx{font-size:15px;font-weight:600}.esb{font-size:13px;margin-top:6px}
/* SEARCH SCREEN */
.search-screen-wrap{padding:12px 16px;display:flex;flex-direction:column;gap:10px}
.sr-box{background:#fff;border-radius:14px;padding:10px 14px;display:flex;align-items:center;gap:8px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.sr-inp{flex:1;border:none;outline:none;font-size:15px}
.sr-res{padding:0 16px 12px;display:flex;flex-direction:column;gap:10px}
/* FAVORITES */
.fav-card{background:#fff;border-radius:16px;padding:14px 16px;margin:0 16px 10px;display:flex;align-items:center;gap:12px;box-shadow:0 1px 4px rgba(0,0,0,.05);cursor:pointer}
.fav-ic{font-size:22px;width:44px;height:44px;border-radius:12px;background:var(--bg);overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.fav-ic img{width:100%;height:100%;object-fit:cover}
.fav-bd{flex:1}.fav-nm{font-size:14px;font-weight:700;color:var(--bl)}.fav-sb{font-size:12px;color:var(--gt);margin-top:2px}
/* LOYALTY */
.loyalty-card{background:linear-gradient(135deg,#6c5ce7,#a29bfe);border-radius:20px;margin:12px 16px;padding:20px;color:#fff}
.lc-title{font-size:18px;font-weight:800;margin-bottom:6px}
.lc-bal{font-size:36px;font-weight:900;margin-bottom:4px}
.lc-sub{font-size:13px;opacity:.8}
.lc-row{display:flex;gap:12px;margin-top:16px}
.lc-btn{flex:1;background:rgba(255,255,255,.2);border:none;border-radius:12px;padding:10px;color:#fff;font-size:13px;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="loading" id="loading">
  <div class="loading-logo">üçî –ï–¥–∞</div>
  <div class="loading-sub">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>
<div class="toast" id="toast"></div>

<!-- ADDRESS MODAL -->
<div class="addr-modal" id="addrModal">
  <div class="addr-modal-head">
    <button class="addr-modal-back" onclick="closeAddr()">‚Üê</button>
    <div class="addr-sbox">
      <span>üîç</span>
      <input class="addr-sinp" id="addrInp" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å..." oninput="onAddr(this.value)" autocomplete="off">
    </div>
  </div>
  <div class="addr-results" id="addrRes">
    <div class="addr-ri" onclick="useGeo()">
      <div class="addr-ri-icon">üéØ</div>
      <div><div class="addr-ri-main">–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</div><div class="addr-ri-sub">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div></div>
    </div>
  </div>
</div>

<!-- ITEM MODAL -->
<div class="item-modal" id="itemModal">
  <div class="modal">
    <div class="modal-img" id="mImg"><button class="modal-close" onclick="closeModal()">‚úï</button></div>
    <div class="modal-body">
      <div class="modal-name" id="mName"></div>
      <div class="modal-desc" id="mDesc"></div>
      <div class="modal-w" id="mW"></div>
      <div id="mOptsW" style="display:none">
        <div class="mots" id="mOtsTitle"></div>
        <div class="modal-opts" id="mOpts"></div>
      </div>
      <div class="modal-add-row">
        <div class="mqc">
          <button class="mqb" onclick="mqA(-1)">‚àí</button>
          <span class="mqn" id="mqN">1</span>
          <button class="mqb" onclick="mqA(1)">+</button>
        </div>
        <button class="modal-add-btn" onclick="addFM()">
          <span>–í –∫–æ—Ä–∑–∏–Ω—É</span><span id="mPrice"></span>
        </button>
      </div>
    </div>
  </div>
</div>

<div id="app">
  <div class="topbar" id="mainTopbar">
    <div class="topbar-inner">
      <div class="logo">–ï–¥–∞</div>
      <button class="addr-btn" onclick="openAddr()">
        <span>üìç</span>
        <span class="addr-text" id="addrTxt">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        <span style="color:var(--bl);opacity:.4;font-size:10px">‚ñæ</span>
      </button>
      <button class="profile-btn" onclick="goTo('profile')">üë§</button>
    </div>
  </div>
  <div class="tabs" id="catalogTabs">
    <button class="tab-btn active" onclick="selTab('online',this)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
    <button class="tab-btn" onclick="selTab('offline',this)">–°—Ö–æ–¥–∏—Ç—å</button>
  </div>

  <div class="content" id="mainContent">

    <!-- CATALOG -->
    <div class="screen active" id="screen-catalog">
      <div class="search-wrap">
        <div class="search-box"><span>üîç</span><input class="search-inp" id="catalogSearch" placeholder="–†–µ—Å—Ç–æ—Ä–∞–Ω –∏–ª–∏ –±–ª—é–¥–æ" oninput="filterR(this.value)"></div>
      </div>
      <div class="banners">
        <div class="banner b1"><span class="banner-emoji">üî•</span><div class="banner-text">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è<br>–¥–æ—Å—Ç–∞–≤–∫–∞</div></div>
        <div class="banner b2"><span class="banner-emoji">‚ö°</span><div class="banner-text">–ó–∞ 30 –º–∏–Ω—É—Ç<br>–∏–ª–∏ —Å–∫–∏–¥–∫–∞</div></div>
        <div class="banner b3" onclick="goTo('promos')"><span class="banner-emoji">üéÅ</span><div class="banner-text">–ê–∫—Ü–∏–∏<br>–∏ —Å–∫–∏–¥–∫–∏</div></div>
      </div>
      <div class="cats" id="catsList"></div>
      <div class="section-title">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</div>
      <div class="rests" id="restsList"><div class="spinner"><div class="spin"></div></div></div>
      <div style="height:20px"></div>
    </div>

    <!-- MENU -->
    <div class="screen" id="screen-menu">
      <div class="menu-hero">
        <div class="menu-hero-img" id="mhImg"></div>
        <button class="menu-back" onclick="goTo('catalog')">‚Üê</button>
      </div>
      <div class="menu-info">
        <div class="menu-name" id="mhName"></div>
        <div class="menu-meta" id="mhMeta"></div>
      </div>
      <div class="menu-cats" id="menuCats"></div>
      <div id="menuItems"></div>
      <div style="height:24px"></div>
    </div>

    <!-- CART -->
    <div class="screen" id="screen-cart">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('catalog')">‚Üê</button><span class="scr-title">–ö–æ—Ä–∑–∏–Ω–∞</span></div>
      <div class="cart-empty" id="cartEmpty">
        <div class="ceg">üõí</div><div class="cet">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è</div>
        <div class="ces">–î–æ–±–∞–≤—å—Ç–µ –±–ª—é–¥–∞ –∏–∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</div>
        <button class="cart-go" onclick="goTo('catalog')">–ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º</button>
      </div>
      <div id="cartFilled" style="display:none">
        <div class="cart-content">
          <div class="cart-rest-lbl" id="cRestLbl"></div>
          <div class="cart-items-list" id="cItemsList"></div>
          <div class="promo-row"><span>üè∑Ô∏è</span><input class="promo-inp" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" id="promoInp"><button class="promo-apply" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>
          <div class="sum-box">
            <div class="sr"><span class="sl">–¢–æ–≤–∞—Ä—ã</span><span class="sv" id="sItems">0 ‚ÇΩ</span></div>
            <div class="sr"><span class="sl">–î–æ—Å—Ç–∞–≤–∫–∞</span><span class="sv sfree" id="sDel">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span></div>
            <div class="sr"><span class="sl">–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä (5%)</span><span class="sv" id="sFee">0 ‚ÇΩ</span></div>
            <div class="sdiv"></div>
            <div class="sr st-row"><span class="sl">–ò—Ç–æ–≥–æ</span><span class="sv" id="sTotal">0 ‚ÇΩ</span></div>
          </div>
          <button class="checkout-btn" onclick="goTo('checkout')"><span>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</span><span id="coBtnTot">0 ‚ÇΩ</span></button>
        </div>
      </div>
    </div>

    <!-- CHECKOUT -->
    <div class="screen" id="screen-checkout">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('cart')">‚Üê</button><span class="scr-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span></div>
      <div class="co-sec">
        <div class="co-title">üì¶ –î–æ—Å—Ç–∞–≤–∫–∞</div>
        <div class="co-row" onclick="openAddr()">
          <div class="co-icon">üìç</div>
          <div class="co-body"><div class="co-l">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div><div class="co-v" id="coAddr">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
          <div style="color:var(--gt)">‚Ä∫</div>
        </div>
        <div class="co-row">
          <div class="co-icon">‚è±Ô∏è</div>
          <div class="co-body"><div class="co-l">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</div><div class="co-v" id="coTime">~30 –º–∏–Ω</div></div>
        </div>
      </div>
      <div class="co-sec">
        <div class="co-title">üí≥ –û–ø–ª–∞—Ç–∞</div>
        <div class="pay-opts" id="payOpts">
          <div class="pay-opt sel" onclick="selPay(this,'sbp_qr','sbp')"><div class="poi">‚ö°</div><div class="pon">–°–ë–ü</div></div>
          <div class="pay-opt" onclick="selPay(this,'card','card')"><div class="poi">üí≥</div><div class="pon">–ö–∞—Ä—Ç–∞</div></div>
          <div class="pay-opt" onclick="selPay(this,'cash','cash')"><div class="poi">üíµ</div><div class="pon">–ù–∞–ª–∏—á–Ω—ã–µ</div></div>
        </div>
      </div>
      <div class="co-sec">
        <div class="co-title">üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div>
        <input id="coComment" style="width:100%;border:1px solid var(--gb);border-radius:10px;padding:10px 12px;font-size:14px;outline:none;background:var(--bg)" placeholder="–î–æ–º–æ—Ñ–æ–Ω, —ç—Ç–∞–∂, –ø–æ–∂–µ–ª–∞–Ω–∏—è...">
      </div>
      <div class="co-sec">
        <div class="co-title">üßæ –°–æ—Å—Ç–∞–≤</div>
        <div id="coItems"></div>
        <div class="sdiv"></div>
        <div class="sr st-row" style="margin-top:10px"><span class="sl">–ò—Ç–æ–≥–æ</span><span class="sv" id="coTotal">0 ‚ÇΩ</span></div>
      </div>
      <button class="place-btn" id="placeBtn" onclick="placeOrder()">–ó–∞–∫–∞–∑–∞—Ç—å ¬∑ <span id="placeBtnTot">0 ‚ÇΩ</span></button>
    </div>

    <!-- ORDER -->
    <div class="screen" id="screen-order">
      <div class="order-wrap">
        <div class="ord-chk">‚úÖ</div>
        <div class="ord-title">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div>
        <div class="ord-sub">–†–µ—Å—Ç–æ—Ä–∞–Ω –Ω–∞—á–∞–ª –≥–æ—Ç–æ–≤–∏—Ç—å –≤–∞—à –∑–∞–∫–∞–∑</div>
        <div class="ord-nr"><div class="onrl">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</div><div class="onrv" id="orderNr">‚Äî</div></div>
        <div class="track-box">
          <div class="ts"><div class="ts-dot tdd" id="s1">‚úì</div><div class="ts-line"></div><div class="ts-text"><div class="ts-label">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç</div><div class="ts-time" id="s1t"></div></div></div>
          <div class="ts"><div class="ts-dot tda" id="s2">üç≥</div><div class="ts-line"></div><div class="ts-text"><div class="ts-label">–†–µ—Å—Ç–æ—Ä–∞–Ω –≥–æ—Ç–æ–≤–∏—Ç</div><div class="ts-time" id="s2t">~20 –º–∏–Ω</div></div></div>
          <div class="ts"><div class="ts-dot tdp" id="s3">üõµ</div><div class="ts-line"></div><div class="ts-text"><div class="ts-label">–ö—É—Ä—å–µ—Ä –≤ –ø—É—Ç–∏</div><div class="ts-time" id="s3t"></div></div></div>
          <div class="ts"><div class="ts-dot tdp" id="s4">üéâ</div><div class="ts-text"><div class="ts-label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</div><div class="ts-time" id="s4t"></div></div></div>
        </div>
        <button class="back-main" onclick="goTo('catalog');clearCart()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
      </div>
    </div>

    <!-- PROFILE -->
    <div class="screen" id="screen-profile">
      <div class="prof-head">
        <div class="prof-head-row">
          <button class="back-btn" onclick="goTo('catalog')">‚Üê</button>
          <div class="prof-av" id="profAv">üë§</div>
          <div><div class="prof-nm" id="profNm">–ó–∞–≥—Ä—É–∑–∫–∞...</div><div class="prof-uid" id="profUid"></div></div>
        </div>
        <div class="prof-plus" onclick="goTo('loyalty')">
          <span class="pp-icon">‚≠ê</span>
          <span class="pp-text">–Ø–Ω–¥–µ–∫—Å –ü–ª—é—Å</span>
          <span class="pp-st" id="plusSt">–ù–µ –∞–∫—Ç–∏–≤–µ–Ω</span>
          <span class="plus-bal" id="plusBal"></span>
        </div>
      </div>
      <div class="prof-menu">
        <div class="prof-sec">
          <div class="pi" onclick="goTo('orders')"><div class="pi-ic">üì¶</div><div class="pi-bd"><div class="pi-tx">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</div><div class="pi-sb" id="piOrd">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</div></div><span class="pi-ar">‚Ä∫</span></div>
          <div class="pi" onclick="goTo('addresses')"><div class="pi-ic">üìç</div><div class="pi-bd"><div class="pi-tx">–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</div><div class="pi-sb" id="piAddr">–ú–æ–∏ –∞–¥—Ä–µ—Å–∞</div></div><span class="pi-ar">‚Ä∫</span></div>
          <div class="pi" onclick="goTo('payments')"><div class="pi-ic">üí≥</div><div class="pi-bd"><div class="pi-tx">–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</div><div class="pi-sb" id="piPay">–ö–∞—Ä—Ç—ã –∏ –∫–æ—à–µ–ª—å–∫–∏</div></div><span class="pi-ar">‚Ä∫</span></div>
        </div>
        <div class="prof-sec">
          <div class="pi" onclick="goTo('favorites')"><div class="pi-ic">‚ù§Ô∏è</div><div class="pi-bd"><div class="pi-tx">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div><div class="pi-sb" id="piFav">–õ—é–±–∏–º—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</div></div><span class="pi-ar">‚Ä∫</span></div>
          <div class="pi" onclick="goTo('promos')"><div class="pi-ic">üè∑Ô∏è</div><div class="pi-bd"><div class="pi-tx">–ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –±–æ–Ω—É—Å—ã</div><div class="pi-sb" id="piPromo">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</div></div><span class="pi-ar">‚Ä∫</span></div>
          <div class="pi" onclick="goTo('loyalty')"><div class="pi-ic">‚≠ê</div><div class="pi-bd"><div class="pi-tx">–Ø–Ω–¥–µ–∫—Å –ü–ª—é—Å</div><div class="pi-sb">–ë–∞–ª–ª—ã –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏</div></div><span class="pi-ar">‚Ä∫</span></div>
        </div>
        <div class="prof-sec">
          <div class="pi" onclick="goTo('support')"><div class="pi-ic">üí¨</div><div class="pi-bd"><div class="pi-tx">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div><div class="pi-sb">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</div></div><span class="pi-ar">‚Ä∫</span></div>
          <div class="pi" onclick="goTo('settings')"><div class="pi-ic">‚öôÔ∏è</div><div class="pi-bd"><div class="pi-tx">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div><div class="pi-sb">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</div></div><span class="pi-ar">‚Ä∫</span></div>
        </div>
      </div>
    </div>

    <!-- ORDERS -->
    <div class="screen" id="screen-orders">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</span></div>
      <div id="ordersC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

    <!-- ADDRESSES -->
    <div class="screen" id="screen-addresses">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</span></div>
      <div style="height:12px"></div>
      <div id="addressesC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

    <!-- PAYMENTS -->
    <div class="screen" id="screen-payments">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</span></div>
      <div style="height:12px"></div>
      <div id="paymentsC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

    <!-- PROMOS -->
    <div class="screen" id="screen-promos">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–ü—Ä–æ–º–æ–∫–æ–¥—ã</span></div>
      <div style="height:12px"></div>
      <div id="promosC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

    <!-- FAVORITES -->
    <div class="screen" id="screen-favorites">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></div>
      <div style="height:12px"></div>
      <div id="favoritesC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

    <!-- LOYALTY -->
    <div class="screen" id="screen-loyalty">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–Ø–Ω–¥–µ–∫—Å –ü–ª—é—Å</span></div>
      <div id="loyaltyC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

    <!-- SUPPORT -->
    <div class="screen" id="screen-support" style="display:flex;flex-direction:column;height:100%">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span></div>
      <div class="sup-chat" id="supChat"><div class="sm sm-b">–ü—Ä–∏–≤–µ—Ç! –ü–æ–º–æ–≥—É —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ –∑–∞–∫–∞–∑—É. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?</div></div>
      <div class="sup-inp-row">
        <input class="sup-inp" id="supInp" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeydown="if(event.key==='Enter')sendSup()">
        <button class="sup-send" onclick="sendSup()">‚û§</button>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="screen" id="screen-settings">
      <div class="scr-hdr"><button class="back-btn" onclick="goTo('profile')">‚Üê</button><span class="scr-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></div>
      <div style="height:12px"></div>
      <div id="settingsC"><div class="spinner"><div class="spin"></div></div></div>
    </div>

  </div>

  <div class="bottom-nav" id="bottomNav">
    <button class="nav-btn active" id="nav-catalog" onclick="goTo('catalog')"><span class="nav-icon">üè†</span><span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span></button>
    <button class="nav-btn" id="nav-cart" onclick="goTo('cart')"><span class="nav-icon">üõí<span class="cbadge" id="cBadge"></span></span><span class="nav-label">–ö–æ—Ä–∑–∏–Ω–∞</span></button>
    <button class="nav-btn" id="nav-profile" onclick="goTo('profile')"><span class="nav-icon">üë§</span><span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const _p = new URLSearchParams(location.search);
const TOKEN = _p.get('token') || '';
const DEVICE_ID = _p.get('device_id') || '9B57D76B-908D-4504-915D-381D08676F44';
const PX = _p.get('proxy') || 'http://localhost:8888';
const IMG_BASE = 'https://eda.yandex.ru';
const SES = (()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)).toUpperCase())();

let LAT = 56.34750920385357, LON = 43.934390690686854;
let curAddr = {
  short: '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥, –í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è, 8',
  full: '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥, –í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è, 8',
  city: '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', street: '–í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è',
  house: '8', country: '–†–æ—Å—Å–∏—è'
};

let cart = {}, curRest = null, curScreen = 'catalog';
let mItem = null, mQty = 1, mOpt = null;
let payId = 'sbp_qr', payType = 'sbp';
let RESTS = [], coData = null, addrTimer = null;

const CATS = [
  {e:'üçî',n:'–ë—É—Ä–≥–µ—Ä—ã'},{e:'üç£',n:'–°—É—à–∏'},{e:'üçï',n:'–ü–∏—Ü—Ü–∞'},
  {e:'üçó',n:'–ö—É—Ä–∏—Ü–∞'},{e:'ü•ó',n:'–ó–¥–æ—Ä–æ–≤–æ–µ'},{e:'üçú',n:'–ê–∑–∏—è'},
  {e:'üåÆ',n:'–§–∞—Å—Ç—Ñ—É–¥'},{e:'üç¶',n:'–î–µ—Å–µ—Ä—Ç—ã'},{e:'üç±',n:'–ö–æ–º–±–æ'},
  {e:'ü•§',n:'–ù–∞–ø–∏—Ç–∫–∏'},{e:'üõí',n:'–ü—Ä–æ–¥—É–∫—Ç—ã'}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// API –•–ï–õ–ü–ï–†–´
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function api(path, body, method) {
  if (!TOKEN) return null;
  method = method || (body != null ? 'POST' : 'GET');
  try {
    const o = {
      method,
      headers: {
        'Content-Type': 'application/json',
        'X-Bearer': TOKEN,
        'X-Device-Id': DEVICE_ID,
        'X-Client-Session': SES
      }
    };
    if (body != null) o.body = JSON.stringify(body);
    const r = await fetch(PX + '/proxy' + path, o);
    if (!r.ok) { console.warn('[API]', r.status, path); return null; }
    return await r.json();
  } catch(e) { console.error('[API]', path, e); return null; }
}

// GET –∑–∞–ø—Ä–æ—Å (—á–µ—Ä–µ–∑ POST —á—Ç–æ–±—ã –ø—Ä–æ–∫—Å–∏ –Ω–µ –ø–∞–¥–∞–ª ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π body)
// –î–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç do_GET ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω
const G = p => api(p, null, 'GET');

function img(uri, w, h) {
  if (!uri) return '';
  if (uri.startsWith('http')) return uri;
  return IMG_BASE + uri.replace('{w}', w||300).replace('{h}', h||200);
}

function buildAddr() {
  return {
    location: {longitude: LON, latitude: LAT},
    house: curAddr.house || '8',
    short_text: curAddr.short,
    full_text: curAddr.full,
    city: curAddr.city || '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥',
    street: curAddr.street || '–í–æ–ª–∂—Å–∫–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è',
    country: curAddr.country || '–†–æ—Å—Å–∏—è',
    type: {id: 0},
    areas: [curAddr.city || '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥']
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ó–ê–ì–†–£–ó–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load', async () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  document.getElementById('catsList').innerHTML = CATS.map((c,i) =>
    `<button class="cat-btn ${i===0?'active':''}" onclick="filterCat(this,'${c.n}')">
      <span class="cat-emoji">${c.e}</span><span class="cat-name">${c.n}</span>
    </button>`).join('');

  if (TOKEN) {
    Promise.all([loadLaunch(), loadRests()]);
  } else {
    document.getElementById('restsList').innerHTML =
      '<div style="text-align:center;padding:60px 32px;color:var(--gt)">‚ö†Ô∏è –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ Telegram —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</div>';
    document.getElementById('addrTxt').textContent = '–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å';
  }
  setTimeout(() => {
    const l = document.getElementById('loading');
    l.style.opacity = '0';
    setTimeout(() => l.style.display = 'none', 400);
  }, 1000);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LAUNCH ‚Äî –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadLaunch() {
  // 1. launch/v2/native ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  const d = await api('/eats/v1/launch/v2/native', {
    experiments: {
      consumer: 'eda_ab_service',
      args: [
        {name:'application',type:'string',value:'eda_ios_app'},
        {name:'version',type:'application_version',value:'8.94.0'},
        {name:'device_id',type:'string',value:DEVICE_ID},
        {name:'is_watch_paired',type:'boolean',value:true},
        {name:'is_watch_app_installed',type:'boolean',value:false},
      ]
    }
  });

  if (d?.profile) {
    const p = d.profile;
    document.getElementById('profNm').textContent = p.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    document.getElementById('profUid').textContent = p.passport_uid ? 'UID: ' + p.passport_uid : '';
    if (p.picture_url || p.avatar_url) {
      document.getElementById('profAv').innerHTML = `<img src="${p.picture_url||p.avatar_url}" onerror="this.parentElement.textContent='üë§'">`;
    }
  } else {
    document.getElementById('profNm').textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    document.getElementById('profUid').textContent = TOKEN ? TOKEN.slice(0, 25) + '...' : '';
  }

  document.getElementById('addrTxt').textContent = curAddr.short;

  // 2. –°—Ç–∞—Ç—É—Å –Ø–Ω–¥–µ–∫—Å –ü–ª—é—Å —á–µ—Ä–µ–∑ persey/info
  const plus = await G(`/eats/v1/persey/info?latitude=${LAT}&longitude=${LON}&currency=RUB`);
  if (plus) {
    const active = plus.subscription_status === 'active' || plus.subscription_status === 'trial';
    const el = document.getElementById('plusSt');
    el.textContent = active ? '‚úì –ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ –∞–∫—Ç–∏–≤–µ–Ω';
    if (active) el.style.color = '#029154';
    if (plus.cashback_balance || plus.balance) {
      document.getElementById('plusBal').textContent = (plus.cashback_balance || plus.balance) + ' –±–∞–ª–ª–æ–≤';
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ó–ê–ì–†–£–ó–ö–ê –†–ï–°–¢–û–†–ê–ù–û–í
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadRests() {
  document.getElementById('restsList').innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  document.getElementById('addrTxt').textContent = curAddr.short;
  document.getElementById('coAddr').textContent = curAddr.short;

  const d = await api('/eats/v1/layout-constructor/v1/layout', {
    filters_v2: {filters: []},
    sort: 'default',
    is_bottomsheet: false,
    selected_state: 'online',
    location: {longitude: LON, latitude: LAT},
    region_id: 17
  });

  if (d?.data) {
    const ps = parsePlaces(d.data);
    if (ps.length) { RESTS = ps; renderRests(RESTS); return; }
  }
  document.getElementById('restsList').innerHTML =
    '<div style="text-align:center;padding:40px;color:var(--gt)">–ù–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É.<br>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å.</div>';
}

function parsePlaces(data) {
  const secs = [
    ...(data.places_v2_lists || []),
    ...(data.places_v2_medium_carousels || []),
    ...(data.places_v2_ultima_list || []),
    ...(data.mini_places_carousels || []),
    ...(data.places_v2_large_carousels || []),
  ];
  const seen = new Set(), res = [];
  for (const s of secs) {
    for (const p of (s.payload?.places || [])) {
      if (!p.slug || seen.has(p.slug)) continue;
      seen.add(p.slug);
      const name = typeof p.name === 'object' ? p.name.value : (p.name || '‚Äî');
      let time = '';
      for (const m of (p.left_meta || [])) if (m.type === 'info') { time = m.payload?.text?.value || ''; break; }
      let tagsStr = '';
      for (const m of (p.right_meta || [])) if (m.type === 'info') { tagsStr = m.payload?.text?.value || ''; break; }
      const tags = tagsStr.split(',').map(t => t.trim().replace(/\u200b/g, '')).filter(Boolean);
      const free = (p.chips || []).some(c => c.payload?.prefix?.text?.value?.toLowerCase().includes('–±–µ—Å–ø–ª–∞—Ç–Ω'));
      const rm = p.features?.rating?.text?.value || '';
      const rating = (rm.match(/[\d.]+/) || [''])[0];
      const pic = p.picture?.image || p.logo || '';
      const minOrder = p.features?.min_order?.text?.value || '';
      res.push({slug: p.slug, name, pic, time, tags, free, rating, minOrder});
    }
  }
  return res;
}

function filterCat(btn, cat) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const q = cat.toLowerCase();
  const f = RESTS.filter(r => r.tags.some(t => t.toLowerCase().includes(q)));
  renderRests(f.length ? f : RESTS);
}

function filterR(q) {
  if (!q) { renderRests(RESTS); return; }
  q = q.toLowerCase();
  renderRests(RESTS.filter(r => r.name.toLowerCase().includes(q) || r.tags.some(t => t.toLowerCase().includes(q))));
}

function renderRests(list) {
  const el = document.getElementById('restsList');
  if (!list.length) { el.innerHTML = '<div style="text-align:center;padding:40px;color:var(--gt)">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üîç</div>'; return; }
  el.innerHTML = list.map(r => {
    const pu = img(r.pic, 600, 300);
    return `<div class="rest-card" onclick="openRest('${r.slug}')">
      <div class="rest-img">
        ${pu ? `<img src="${pu}" loading="lazy" onerror="this.style.display='none'">` : '<span style="font-size:60px">üçΩÔ∏è</span>'}
        ${r.free ? '<div class="rest-badge">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>' : ''}
      </div>
      <div class="rest-info">
        <div class="rest-name">${r.name}</div>
        <div class="rest-meta">
          ${r.rating ? `<span class="rest-rating">‚òÖ ${r.rating}</span>` : ''}
          ${r.time ? `<span class="rest-time">‚è± ${r.time}</span>` : ''}
          ${r.free ? '<span class="rest-free">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</span>' : ''}
          ${r.minOrder ? `<span class="rest-time">–æ—Ç ${r.minOrder}</span>` : ''}
        </div>
        ${r.tags.length ? `<div class="rest-tags">${r.tags.slice(0,4).map(t => `<span class="rest-tag">${t}</span>`).join('')}</div>` : ''}
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ú–ï–ù–Æ –†–ï–°–¢–û–†–ê–ù–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function openRest(slug) {
  curRest = RESTS.find(r => r.slug === slug);
  if (!curRest) return;
  goTo('menu');

  document.getElementById('mhName').textContent = curRest.name;
  const pu = img(curRest.pic, 800, 400);
  document.getElementById('mhImg').innerHTML = pu ? `<img src="${pu}" onerror="this.style.display='none'">` : 'üçΩÔ∏è';
  document.getElementById('mhMeta').innerHTML = `
    ${curRest.free ? '<span class="menu-badge mb-g">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</span>' : ''}
    ${curRest.time ? `<span class="menu-badge mb-y">‚è± ${curRest.time}</span>` : ''}
    ${curRest.rating ? `<span class="menu-badge mb-y">‚òÖ ${curRest.rating}</span>` : ''}`;
  document.getElementById('menuCats').innerHTML = '';
  document.getElementById('menuItems').innerHTML = '<div class="spinner"><div class="spin"></div></div>';

  // GET /api/v2/menu/retrieve/{slug}
  const d = await G(`/api/v2/menu/retrieve/${slug}?shippingType=delivery&longitude=${LON}&latitude=${LAT}&is_ad=false`);
  if (!d?.payload?.categories) {
    document.getElementById('menuItems').innerHTML =
      '<div style="text-align:center;padding:40px;color:var(--gt)">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</div>';
    return;
  }

  curRest.cats = d.payload.categories
    .filter(c => c.available !== false)
    .map(c => ({
      n: c.name,
      items: (c.items || []).filter(i => i.available !== false).map(i => ({
        id: i.id,
        n: i.name,
        desc: i.description || '',
        p: i.price || 0,
        img: i.picture?.uri ? img(i.picture.uri, 400, 400) : '',
        w: i.weightInGrams ? i.weightInGrams + ' –≥' : '',
        opts: (i.optionsGroups || []).map(g => ({
          g: g.name,
          req: g.required,
          i: (g.options || []).map(o => ({id: o.id, n: o.name, p: o.price || 0}))
        })).filter(g => g.i.length > 0)
      }))
    })).filter(c => c.items.length > 0);

  document.getElementById('menuCats').innerHTML = curRest.cats.map((c, i) =>
    `<button class="mct ${i===0?'active':''}" onclick="scrollCat(${i},this)">${c.n}</button>`).join('');
  renderMenu();
}

function renderMenu() {
  document.getElementById('menuItems').innerHTML =
    curRest.cats.map((c, ci) => `
      <div class="menu-sec" id="ms${ci}">
        <div class="menu-sec-title">${c.n}</div>
        <div class="menu-items-list">${c.items.map(i => renderItem(i)).join('')}</div>
      </div>`).join('') + '<div style="height:80px"></div>';
}

function renderItem(item) {
  const q = getQ(item.id);
  const js = JSON.stringify(item).replace(/'/g, "&#39;");
  return `<div class="mi" onclick='openModal(${js})'>
    <div class="mi-img">${item.img ? `<img src="${item.img}" loading="lazy" onerror="this.parentElement.innerHTML='üçΩÔ∏è'">` : 'üçΩÔ∏è'}</div>
    <div class="mi-body">
      <div class="mi-name">${item.n}</div>
      ${item.desc ? `<div class="mi-desc">${item.desc}</div>` : ''}
      ${item.w ? `<div class="mi-w">${item.w}</div>` : ''}
      <div class="mi-foot">
        <div class="mi-price">${item.p} ‚ÇΩ</div>
        ${q > 0
          ? `<div class="qc"><button class="qb" onclick="event.stopPropagation();adjQ(${item.id},-1)">‚àí</button><span class="qn">${q}</span><button class="qb" onclick="event.stopPropagation();adjQ(${item.id},1)">+</button></div>`
          : `<button class="add-btn" onclick='event.stopPropagation();qAdd(${js})'>+</button>`}
      </div>
    </div>
  </div>`;
}

function scrollCat(i, btn) {
  document.querySelectorAll('.mct').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('ms'+i)?.scrollIntoView({behavior:'smooth', block:'start'});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ë–õ–Æ–î–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(item) {
  if (typeof item === 'string') item = JSON.parse(item);
  mItem = item; mQty = 1; mOpt = null;
  document.getElementById('mImg').innerHTML = (item.img ? `<img src="${item.img}">` : '<span style="font-size:80px">üçΩÔ∏è</span>') +
    `<button class="modal-close" onclick="closeModal()">‚úï</button>`;
  document.getElementById('mName').textContent = item.n;
  document.getElementById('mDesc').textContent = item.desc || '';
  document.getElementById('mW').textContent = item.w || '';
  document.getElementById('mqN').textContent = '1';
  const ow = document.getElementById('mOptsW');
  if (item.opts?.length) {
    const g = item.opts[0];
    document.getElementById('mOtsTitle').textContent = g.g;
    document.getElementById('mOpts').innerHTML = g.i.map((o, i) =>
      `<div class="mo ${i===0?'sel':''}" onclick='pickO(this,${JSON.stringify(o)})'>
        <span class="mo-n">${o.n}</span>
        <span class="mo-p">${o.p > 0 ? '+'+o.p+' ‚ÇΩ' : '–±–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
      </div>`).join('');
    mOpt = g.i[0]; ow.style.display = 'block';
  } else { ow.style.display = 'none'; }
  updMP();
  document.getElementById('itemModal').classList.add('open');
}

function pickO(el, opt) {
  if (typeof opt === 'string') opt = JSON.parse(opt);
  document.querySelectorAll('.mo').forEach(e => e.classList.remove('sel'));
  el.classList.add('sel'); mOpt = opt; updMP();
}
function updMP() { if (!mItem) return; const p = mItem.p + (mOpt?.p > 0 ? mOpt.p : 0); document.getElementById('mPrice').textContent = (p * mQty) + ' ‚ÇΩ'; }
function mqA(d) { mQty = Math.max(1, mQty + d); document.getElementById('mqN').textContent = mQty; updMP(); }
function addFM() { if (!mItem || !curRest) return; for (let i=0; i<mQty; i++) addToCart(mItem, mOpt?.n||'', mOpt?.p||0); closeModal(); toast(mItem.n + ' –¥–æ–±–∞–≤–ª–µ–Ω ‚úì'); }
function closeModal() { document.getElementById('itemModal').classList.remove('open'); mItem = null; }
document.getElementById('itemModal').addEventListener('click', e => { if (e.target === document.getElementById('itemModal')) closeModal(); });
function qAdd(item) { if (typeof item === 'string') item = JSON.parse(item); if (item.opts?.length) { openModal(item); return; } addToCart(item, '', 0); toast(item.n + ' –¥–æ–±–∞–≤–ª–µ–Ω ‚úì'); renderMenu(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ö–û–†–ó–ò–ù–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addToCart(item, on, op) {
  if (!cart.items) cart = {slug: curRest.slug, rn: curRest.name, items: []};
  if (cart.slug !== curRest.slug) {
    if (!confirm(`–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –æ—Ç "${cart.rn}"?`)) return;
    cart = {slug: curRest.slug, rn: curRest.name, items: []};
  }
  const key = item.id + '_' + on;
  const ex = cart.items.find(i => i.key === key);
  if (ex) ex.qty++;
  else cart.items.push({key, iid: item.id, n: item.n, p: item.p + op, img: item.img||'', on, qty: 1});
  updBadge();
}

function adjQ(iid, d) {
  if (!cart.items) return;
  const i = cart.items.findIndex(x => x.iid === iid); if (i < 0) return;
  cart.items[i].qty += d;
  if (cart.items[i].qty <= 0) cart.items.splice(i, 1);
  if (!cart.items.length) cart = {};
  updBadge();
  if (curScreen === 'menu' && curRest?.cats) renderMenu();
  if (curScreen === 'cart') renderCart();
}
function getQ(iid) { return cart.items ? cart.items.filter(i => i.iid === iid).reduce((s,i) => s+i.qty, 0) : 0; }
function getTotal() { return cart.items ? cart.items.reduce((s,i) => s+i.p*i.qty, 0) : 0; }
function getCount() { return cart.items ? cart.items.reduce((s,i) => s+i.qty, 0) : 0; }
function updBadge() { const c = getCount(); document.getElementById('cBadge').textContent = c > 0 ? c : ''; }
function clearCart() { cart = {}; updBadge(); }

function renderCart() {
  if (!cart.items?.length) {
    document.getElementById('cartEmpty').style.display = 'flex';
    document.getElementById('cartFilled').style.display = 'none'; return;
  }
  document.getElementById('cartEmpty').style.display = 'none';
  document.getElementById('cartFilled').style.display = 'block';
  document.getElementById('cRestLbl').textContent = 'üì¶ ' + (cart.rn || '');
  document.getElementById('cItemsList').innerHTML = cart.items.map(ci => `
    <div class="ci">
      <div class="ci-img">${ci.img ? `<img src="${ci.img}" onerror="this.parentElement.innerHTML='üçΩÔ∏è'">` : 'üçΩÔ∏è'}</div>
      <div class="ci-body"><div class="ci-name">${ci.n}</div>${ci.on ? `<div class="ci-opt">${ci.on}</div>` : ''}</div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div style="font-size:14px;font-weight:800">${ci.p * ci.qty} ‚ÇΩ</div>
        <div style="display:flex;align-items:center;gap:6px">
          <button class="cqb" onclick="adjQ(${ci.iid},-1)">‚àí</button>
          <span class="cqn">${ci.qty}</span>
          <button class="cqb" onclick="adjQ(${ci.iid},1)">+</button>
        </div>
      </div>
    </div>`).join('');
  const sub = getTotal(), fee = Math.round(sub * .05), tot = sub + fee;
  document.getElementById('sItems').textContent = sub + ' ‚ÇΩ';
  document.getElementById('sFee').textContent = fee + ' ‚ÇΩ';
  document.getElementById('sTotal').textContent = tot + ' ‚ÇΩ';
  document.getElementById('coBtnTot').textContent = tot + ' ‚ÇΩ';
}

async function applyPromo() {
  const code = document.getElementById('promoInp').value.trim().toUpperCase();
  if (!code || !TOKEN) { toast('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥'); return; }
  toast('‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é...');
  // POST /api/v2/cart/promocode
  const d = await api(`/api/v2/cart/promocode?soft_multi=true&shippingType=delivery&placeSlug=${cart.slug||''}`,
    {code, place_slug: cart.slug||'', location: {latitude: LAT, longitude: LON}});
  toast(d && (d.discount || d.applied) ? '‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!' : '‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function renderCO() {
  const sub = getTotal(), fee = Math.round(sub * .05), tot = sub + fee;
  document.getElementById('coTotal').textContent = tot + ' ‚ÇΩ';
  document.getElementById('placeBtnTot').textContent = tot + ' ‚ÇΩ';
  document.getElementById('coItems').innerHTML = (cart.items || []).map(ci =>
    `<div class="sr"><span class="sl">${ci.n}${ci.on?' ('+ci.on+')':''} √ó ${ci.qty}</span><span class="sv">${ci.p*ci.qty} ‚ÇΩ</span></div>`).join('');
  document.getElementById('coAddr').textContent = curAddr.short;

  if (cart.slug && TOKEN) {
    // POST /api/v2/cart/go-checkout ‚Äî –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –≤—Ä–µ–º—è, —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
    const gcd = await api('/api/v2/cart/go-checkout', {
      place_slug: cart.slug,
      plus_subscription_toggle_state: null,
      address: buildAddr()
    });
    if (gcd) {
      coData = gcd;
      if (gcd.address?.short_text) document.getElementById('coAddr').textContent = gcd.address.short_text;
      if (gcd.delivery_time) document.getElementById('coTime').textContent = '~' + gcd.delivery_time + ' –º–∏–Ω';
      if (gcd.payment_methods?.length) {
        const icons = {sbp:'‚ö°', card:'üí≥', cash:'üíµ', wallet:'üëõ', yandex_pay:'üíõ'};
        let first = true;
        document.getElementById('payOpts').innerHTML = gcd.payment_methods.slice(0, 4).map(m => {
          const t = m.type || 'card'; const id = m.payment_method_id || t;
          const n = m.name || {sbp:'–°–ë–ü', card:'–ö–∞—Ä—Ç–∞', cash:'–ù–∞–ª–∏—á–Ω—ã–µ'}[t] || t;
          const sel = first ? 'sel' : ''; if (first) { payId = id; payType = t; first = false; }
          return `<div class="pay-opt ${sel}" onclick="selPay(this,'${id}','${t}')"><div class="poi">${icons[t]||'üí≥'}</div><div class="pon">${n}</div></div>`;
        }).join('');
      }
    }
  }
}

function selPay(el, id, type) {
  document.querySelectorAll('.pay-opt').forEach(o => o.classList.remove('sel'));
  el.classList.add('sel'); payId = id; payType = type;
}

async function placeOrder() {
  const btn = document.getElementById('placeBtn');
  btn.disabled = true; btn.textContent = '‚è≥ –û—Ñ–æ—Ä–º–ª—è—é...';
  let nr = null;
  if (TOKEN && cart.slug) {
    const reqId = crypto.randomUUID().replace(/-/g,'') + '.' + (coData?.offers?.[0]?.offer_identity || crypto.randomUUID().replace(/-/g,''));
    // POST /api/v1/orders ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
    const d = await api('/api/v1/orders', {
      courier_options: [], persons_quantity: 1, request_id: reqId,
      location: {latitude: LAT, longitude: LON},
      comment: document.getElementById('coComment').value,
      payment: {recently_link_cards: false},
      payment_method_id: payType === 'sbp' ? 5 : payType === 'cash' ? 1 : 2,
      place_slug: cart.slug,
      phone: '+70000000000',
      extended_options: [{type: 'delivery_options'}],
      address: buildAddr(),
      payment_information: {type: payType, id: payId, costForCustomer: String(getTotal())}
    });
    if (d?.order_nr) nr = d.order_nr;
  }
  if (!nr) {
    const d = new Date();
    nr = `${String(d.getDate()).padStart(2,'0')}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getFullYear()).slice(-2)}-${Math.floor(1000000+Math.random()*9000000)}`;
  }
  clearCart(); trackOrder(nr); btn.disabled = false;
}

function trackOrder(nr) {
  document.getElementById('orderNr').textContent = nr;
  const fmt = d => d.getHours() + ':' + String(d.getMinutes()).padStart(2,'0');
  document.getElementById('s1t').textContent = fmt(new Date());
  goTo('order');
  setTimeout(() => { document.getElementById('s2').textContent='‚úì'; document.getElementById('s2').className='ts-dot tdd'; document.getElementById('s3').className='ts-dot tda'; document.getElementById('s3t').textContent='~10 –º–∏–Ω'; }, 8000);
  setTimeout(() => { document.getElementById('s3').textContent='‚úì'; document.getElementById('s3').className='ts-dot tdd'; document.getElementById('s4').className='ts-dot tda'; document.getElementById('s4t').textContent=fmt(new Date(Date.now()+5*60000)); }, 18000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ê–î–†–ï–°
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openAddr() {
  document.getElementById('addrModal').classList.add('open');
  setTimeout(() => document.getElementById('addrInp').focus(), 400);
}
function closeAddr() { document.getElementById('addrModal').classList.remove('open'); }
function onAddr(v) { clearTimeout(addrTimer); if (v.length < 3) return; addrTimer = setTimeout(() => suggestAddr(v), 450); }

async function suggestAddr(text) {
  // POST /eats/v1/eats-addresses/v1/suggest ‚Äî –ø–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞
  const d = await api('/eats/v1/eats-addresses/v1/suggest', {
    text,
    location: {latitude: LAT, longitude: LON},
    locale: 'ru',
    types: ['house']
  });
  const items = d?.suggests || d?.items || [];
  const el = document.getElementById('addrRes');
  const geo = `<div class="addr-ri" onclick="useGeo()"><div class="addr-ri-icon">üéØ</div><div><div class="addr-ri-main">–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</div><div class="addr-ri-sub">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div></div></div>`;
  if (!items.length) { el.innerHTML = geo + '<div style="text-align:center;padding:40px;color:var(--gt)">–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω</div>'; return; }
  el.innerHTML = geo + items.map(s => {
    const title = s.title?.text || s.subtitle?.text || s.full_text || s.text || '';
    const sub = s.subtitle?.text || s.full_text || '';
    const lat = s.point?.lat || s.location?.latitude || LAT;
    const lon = s.point?.lon || s.location?.longitude || LON;
    const city = s.city || '';
    const street = s.street || '';
    const house = s.house || '';
    return `<div class="addr-ri" onclick="selAddr(${JSON.stringify({title, sub, lat, lon, city, street, house})})">
      <div class="addr-ri-icon">üìç</div>
      <div><div class="addr-ri-main">${title}</div>${sub ? `<div class="addr-ri-sub">${sub}</div>` : ''}</div>
    </div>`;
  }).join('');
}

function selAddr(data) {
  if (typeof data === 'string') data = JSON.parse(data);
  LAT = parseFloat(data.lat) || LAT;
  LON = parseFloat(data.lon) || LON;
  const full = data.sub || data.title;
  const parts = data.title.split(',').map(s => s.trim());
  curAddr = {
    short: data.title,
    full,
    city: data.city || parts[0] || '',
    street: data.street || parts[1] || '',
    house: data.house || parts[2] || '',
    country: '–†–æ—Å—Å–∏—è'
  };
  document.getElementById('addrTxt').textContent = data.title;
  document.getElementById('coAddr').textContent = data.title;
  closeAddr();
  toast('üìç –ê–¥—Ä–µ—Å –∏–∑–º–µ–Ω—ë–Ω');
  RESTS = []; loadRests();
}

function useGeo() {
  if (!navigator.geolocation) { toast('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'); return; }
  toast('‚è≥ –û–ø—Ä–µ–¥–µ–ª—è—é...');
  navigator.geolocation.getCurrentPosition(async pos => {
    LAT = pos.coords.latitude; LON = pos.coords.longitude;
    // POST /eats/v1/eats-addresses/v1/geocode ‚Äî –æ–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
    const d = await api('/eats/v1/eats-addresses/v1/geocode', {
      point: {lat: LAT, lon: LON},
      locale: 'ru'
    });
    const a = d?.address || d?.result || {};
    const short = a.short_text || a.title || `${LAT.toFixed(4)},${LON.toFixed(4)}`;
    curAddr = {
      short, full: a.full_text || short,
      city: a.city || '', street: a.street || '',
      house: a.house || '', country: '–†–æ—Å—Å–∏—è'
    };
    document.getElementById('addrTxt').textContent = short;
    document.getElementById('coAddr').textContent = short;
    closeAddr(); toast('üìç ' + short); RESTS = []; loadRests();
  }, () => toast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ü–†–û–§–ò–õ–¨ ‚Äî –ó–ê–ö–ê–ó–´
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadOrders() {
  const el = document.getElementById('ordersC');
  el.innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  // GET /api/v1/user/orders
  const d = await G('/api/v1/user/orders?page=1&limit=20');
  if (d?.orders?.length) {
    el.innerHTML = '<div class="orders-list">' + d.orders.map(o => {
      const date = o.created_at ? new Date(o.created_at).toLocaleDateString('ru', {day:'numeric',month:'long'}) : '';
      const st = o.status || 'delivered';
      const stc = {delivered:'ob-ok', cancelled:'ob-no', pending:'ob-pend', cooking:'ob-pend'};
      const stl = {delivered:'–î–æ—Å—Ç–∞–≤–ª–µ–Ω', cancelled:'–û—Ç–º–µ–Ω—ë–Ω', pending:'–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', cooking:'–ì–æ—Ç–æ–≤–∏—Ç—Å—è'};
      const items = (o.items || []).slice(0, 2).map(i => i.name || i.n).join(', ');
      return `<div class="ord-card">
        <div class="oc-head"><span class="oc-nr">–ó–∞–∫–∞–∑ ${o.order_nr||o.id||'‚Äî'}</span><span class="oc-date">${date}</span></div>
        <div class="oc-rest">${o.place_name||''}</div>
        ${items ? `<div class="oc-items">${items}${(o.items||[]).length>2?' –∏ –µ—â—ë...':''}</div>` : ''}
        <div class="oc-foot"><span class="oc-total">${o.total||o.cost||0} ‚ÇΩ</span><span class="ob ${stc[st]||'ob-ok'}">${stl[st]||'–î–æ—Å—Ç–∞–≤–ª–µ–Ω'}</span></div>
      </div>`;
    }).join('') + '</div>';
    document.getElementById('piOrd').textContent = d.orders.length + ' –∑–∞–∫–∞–∑–æ–≤';
  } else {
    el.innerHTML = '<div class="empty"><div class="eic">üì¶</div><div class="etx">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div><div class="esb">–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑!</div></div>';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ê–î–†–ï–°–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadAddresses() {
  const el = document.getElementById('addressesC');
  el.innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  // GET /eats/v1/eats-addresses/v1/addresses
  const d = await G('/eats/v1/eats-addresses/v1/addresses');
  const addrs = d?.addresses || [];
  let html = `<div class="addr-card" onclick="openAddr()">
    <div class="ac-ic">üìç</div>
    <div class="ac-bd"><div class="ac-nm">–¢–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å</div><div class="ac-fl">${curAddr.full}</div></div>
    <div style="color:var(--gt);font-size:12px;margin-left:auto">–ò–∑–º–µ–Ω–∏—Ç—å</div>
  </div>`;
  if (addrs.length) {
    html += addrs.map(a => {
      const ic = {home:'üè†', work:'üè¢', other:'üìç'}[a.type] || 'üìç';
      return `<div class="addr-card" onclick="setAddrFromSaved(${JSON.stringify(a)})">
        <div class="ac-ic">${ic}</div>
        <div class="ac-bd"><div class="ac-nm">${a.title||a.short_text||'–ê–¥—Ä–µ—Å'}</div><div class="ac-fl">${a.full_text||''}</div></div>
      </div>`;
    }).join('');
    document.getElementById('piAddr').textContent = addrs.length + ' –∞–¥—Ä–µ—Å–æ–≤';
  }
  el.innerHTML = html;
}

function setAddrFromSaved(a) {
  if (a.coordinates) { LAT = a.coordinates.latitude || LAT; LON = a.coordinates.longitude || LON; }
  const short = a.short_text || a.title || '';
  curAddr = {
    short, full: a.full_text || short,
    city: a.city || '', street: a.street || '',
    house: a.house || '', country: '–†–æ—Å—Å–∏—è'
  };
  document.getElementById('addrTxt').textContent = short;
  toast('üìç ' + short);
  goTo('catalog');
  RESTS = []; loadRests();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –°–ü–û–°–û–ë–´ –û–ü–õ–ê–¢–´
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadPayments() {
  const el = document.getElementById('paymentsC');
  el.innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  // go-checkout –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –æ–ø–ª–∞—Ç—ã
  const d = await api('/api/v2/cart/go-checkout', {
    place_slug: cart.slug || (RESTS[0]?.slug) || 'bk_revo2',
    plus_subscription_toggle_state: null,
    address: buildAddr()
  });
  const icons = {sbp:'‚ö°', card:'üí≥', cash:'üíµ', wallet:'üëõ', yandex_pay:'üíõ'};
  const colors = {sbp:'#e8f8ee', card:'#eef2ff', cash:'#fff5d0', wallet:'#fef9ee', yandex_pay:'#fffbe8'};
  if (d?.payment_methods?.length) {
    el.innerHTML = d.payment_methods.map(m => {
      const t = m.type || 'card';
      return `<div class="pay-card">
        <div class="pc-ic" style="background:${colors[t]||'#f5f5f5'}">${icons[t]||'üí≥'}</div>
        <div class="pc-bd"><div class="pc-nm">${m.name||t}</div>${m.account?`<div class="pc-sb">${m.account}</div>`:''}</div>
      </div>`;
    }).join('');
    document.getElementById('piPay').textContent = d.payment_methods.length + ' —Å–ø–æ—Å–æ–±–æ–≤';
  } else {
    el.innerHTML = ['‚ö°|–°–ë–ü|#e8f8ee','üí≥|–ö–∞—Ä—Ç–∞|#eef2ff','üíµ|–ù–∞–ª–∏—á–Ω—ã–µ|#fff5d0'].map(s => {
      const [ic,nm,bg] = s.split('|');
      return `<div class="pay-card"><div class="pc-ic" style="background:${bg}">${ic}</div><div class="pc-bd"><div class="pc-nm">${nm}</div></div></div>`;
    }).join('');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ü–†–û–ú–û–ö–û–î–´
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadPromos() {
  const el = document.getElementById('promosC');
  el.innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  // POST /api/v1/user/promocodes
  const d = await api('/api/v1/user/promocodes', {
    payment: {payment_method_id: payId||'sbp_qr', type: payType||'sbp'}
  });
  if (d?.promocodes?.length) {
    el.innerHTML = d.promocodes.map(p =>
      `<div class="promo-card">
        <div class="promo-code">${p.code||''}</div>
        <div class="promo-desc">${p.description||p.title||''}</div>
        ${p.discount ? `<span class="promo-bdg">‚àí${p.discount}</span>` : ''}
      </div>`).join('');
    document.getElementById('piPromo').textContent = d.promocodes.length + ' –ø—Ä–æ–º–æ–∫–æ–¥–∞(–æ–≤)';
  } else {
    el.innerHTML = '<div class="empty"><div class="eic">üè∑Ô∏è</div><div class="etx">–ü—Ä–æ–º–æ–∫–æ–¥–æ–≤ –Ω–µ—Ç</div><div class="esb">–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</div></div>';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ò–ó–ë–†–ê–ù–ù–û–ï
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadFavorites() {
  const el = document.getElementById('favoritesC');
  el.innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  // GET /api/v1/user/favorites
  const d = await G('/api/v1/user/favorites?latitude=' + LAT + '&longitude=' + LON);
  const places = d?.places || d?.favorites || [];
  if (places.length) {
    document.getElementById('piFav').textContent = places.length + ' –º–µ—Å—Ç';
    el.innerHTML = '<div style="height:12px"></div>' + places.map(p => {
      const pu = img(p.picture?.image || p.logo || '', 80, 80);
      return `<div class="fav-card" onclick="openRestBySlug('${p.slug}')">
        <div class="fav-ic">${pu ? `<img src="${pu}" onerror="this.parentElement.innerHTML='üçΩÔ∏è'">` : 'üçΩÔ∏è'}</div>
        <div class="fav-bd">
          <div class="fav-nm">${typeof p.name === 'object' ? p.name.value : (p.name||'')}</div>
          <div class="fav-sb">${(p.tags||[]).slice(0,2).join(', ') || '–†–µ—Å—Ç–æ—Ä–∞–Ω'}</div>
        </div>
        <span style="color:var(--gt)">‚Ä∫</span>
      </div>`;
    }).join('');
  } else {
    el.innerHTML = '<div class="empty"><div class="eic">‚ù§Ô∏è</div><div class="etx">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö</div><div class="esb">–î–æ–±–∞–≤–ª—è–π—Ç–µ –ª—é–±–∏–º—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</div></div>';
  }
}

async function openRestBySlug(slug) {
  // –ï—Å–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –Ω–µ –≤ —Å–ø–∏—Å–∫–µ ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ
  if (!RESTS.find(r => r.slug === slug)) {
    RESTS.push({slug, name: slug, pic: '', time: '', tags: [], free: false, rating: ''});
  }
  goTo('catalog');
  await openRest(slug);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –õ–û–Ø–õ–¨–ù–û–°–¢–¨ / –ü–õ–Æ–°
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadLoyalty() {
  const el = document.getElementById('loyaltyC');
  el.innerHTML = '<div class="spinner"><div class="spin"></div></div>';
  const p = await G(`/eats/v1/persey/info?latitude=${LAT}&longitude=${LON}&currency=RUB`);
  const active = p?.subscription_status === 'active' || p?.subscription_status === 'trial';
  const balance = p?.cashback_balance || p?.balance || 0;
  el.innerHTML = `
    <div class="loyalty-card">
      <div class="lc-title">–Ø–Ω–¥–µ–∫—Å –ü–ª—é—Å</div>
      <div class="lc-bal">${balance}</div>
      <div class="lc-sub">–±–∞–ª–ª–æ–≤ –Ω–∞–∫–æ–ø–ª–µ–Ω–æ</div>
      <div class="lc-row">
        <button class="lc-btn">${active ? '‚úì –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞' : '–ü–æ–¥–∫–ª—é—á–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É'}</button>
      </div>
    </div>
    <div style="padding:16px">
      <div style="font-size:16px;font-weight:800;margin-bottom:12px">–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏</div>
      ${['–ö—ç—à–±—ç–∫ 5% –±–∞–ª–ª–∞–º–∏ –Ω–∞ –≤—Å—ë','–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤','–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞'].map(b =>
        `<div style="background:#fff;border-radius:14px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:10px;box-shadow:0 1px 4px rgba(0,0,0,.05)">
          <span style="font-size:18px">‚≠ê</span>
          <span style="font-size:14px;font-weight:600">${b}</span>
        </div>`
      ).join('')}
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ù–ê–°–¢–†–û–ô–ö–ò
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadSettings() {
  const el = document.getElementById('settingsC');
  // GET /eats/v1/launch/v2/native –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
  el.innerHTML = `
    <div style="height:12px"></div>
    <div style="background:#fff;border-radius:20px;margin:0 16px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.05)">
      ${[
        {ic:'üîî',tx:'Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',sb:'–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö'},
        {ic:'üìç',tx:'–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏',sb:'–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞'},
        {ic:'üåô',tx:'–¢—ë–º–Ω–∞—è —Ç–µ–º–∞',sb:'–¢—ë–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å'},
        {ic:'üó£Ô∏è',tx:'–Ø–∑—ã–∫',sb:'–†—É—Å—Å–∫–∏–π'},
      ].map(s =>
        `<div class="pi"><div class="pi-ic">${s.ic}</div><div class="pi-bd"><div class="pi-tx">${s.tx}</div><div class="pi-sb">${s.sb}</div></div></div>`
      ).join('')}
    </div>
    <div style="height:20px"></div>
    <div style="background:#fff;border-radius:20px;margin:0 16px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.05)">
      <div class="pi" onclick="toast('–í—ã—Ö–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏')"><div class="pi-ic">üö™</div><div class="pi-bd"><div class="pi-tx" style="color:var(--rd)">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</div></div></div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ü–û–î–î–ï–†–ñ–ö–ê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function sendSup() {
  const inp = document.getElementById('supInp');
  const text = inp.value.trim(); if (!text) return;
  const c = document.getElementById('supChat');
  c.innerHTML += `<div class="sm sm-u">${text}</div>`;
  inp.value = ''; c.scrollTop = c.scrollHeight;
  const rs = [
    '–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –í–∞—à –≤–æ–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.',
    '–ü–æ–Ω—è–ª –≤–∞—Å. –û–±—ã—á–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç.',
    '–í–∞—à –∑–∞–ø—Ä–æ—Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ #' + Math.floor(10000 + Math.random() * 90000),
    '–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ!'
  ];
  setTimeout(() => {
    c.innerHTML += `<div class="sm sm-b">${rs[Math.floor(Math.random() * rs.length)]}</div>`;
    c.scrollTop = c.scrollHeight;
  }, 1500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ù–ê–í–ò–ì–ê–¶–ò–Ø
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PROF = new Set(['profile','orders','addresses','payments','promos','favorites','loyalty','support','settings']);
const NONAV = new Set(['checkout','order']);

function goTo(screen) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-'+screen)?.classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('nav-'+screen)?.classList.add('active');
  if (PROF.has(screen)) document.getElementById('nav-profile').classList.add('active');
  const top = document.getElementById('mainTopbar');
  const tabs = document.getElementById('catalogTabs');
  const nav = document.getElementById('bottomNav');
  top.style.display = screen === 'catalog' ? 'block' : 'none';
  tabs.style.display = screen === 'catalog' ? 'flex' : 'none';
  nav.style.display = NONAV.has(screen) ? 'none' : 'flex';
  if (screen === 'cart') renderCart();
  if (screen === 'checkout') renderCO();
  if (screen === 'orders') loadOrders();
  if (screen === 'addresses') loadAddresses();
  if (screen === 'payments') loadPayments();
  if (screen === 'promos') loadPromos();
  if (screen === 'favorites') loadFavorites();
  if (screen === 'loyalty') loadLoyalty();
  if (screen === 'settings') loadSettings();
  curScreen = screen;
  document.getElementById('mainContent').scrollTo(0, 0);
}

function selTab(t, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (t === 'offline') toast('–ö–∞—Ä—Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç');
}

let toastT;
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  clearTimeout(toastT); toastT = setTimeout(() => el.classList.remove('show'), 2800);
}

goTo('catalog');
</script>
</body>
</html>
