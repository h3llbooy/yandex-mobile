<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ•Ğ´Ğ°</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
  --red: #FC3F1D;
  --red-d: #E8331A;
  --bg: #F5F4F2;
  --white: #fff;
  --text: #21201F;
  --sec: #9E9B98;
  --border: #E0DEDA;
  --green: #1E8B24;
  --blue: #0F7DE8;
  --r: 16px;
  --rs: 10px;
  --bh: 52px;
  --safe-b: env(safe-area-inset-bottom, 0px);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overscroll-behavior:none}
body{font-family:-apple-system,'SF Pro Text','Helvetica Neue',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}

/* â”€â”€ SCREENS â”€â”€ */
.scr{display:none;min-height:100vh;animation:fadeIn .2s ease}
.scr.on{display:block}
@keyframes fadeIn{from{opacity:.6;transform:translateY(4px)}to{opacity:1;transform:none}}

/* â”€â”€ HEADER â”€â”€ */
.hdr{position:sticky;top:0;z-index:100;background:var(--white);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;padding:11px 16px;min-height:52px}
.hdr-title{font-size:17px;font-weight:600;flex:1}
.hdr-sub{font-size:12px;color:var(--sec)}
.back{width:36px;height:36px;border-radius:50%;background:var(--bg);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bnav{position:fixed;bottom:0;left:0;right:0;z-index:200;background:var(--white);border-top:1px solid var(--border);display:flex;padding-bottom:var(--safe-b)}
.bn{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:10px 0;border:none;background:none;cursor:pointer;color:var(--sec);font-size:10px;font-weight:500;transition:color .15s}
.bn.on{color:var(--red)}
.bn svg{transition:transform .15s}
.bn.on svg{transform:scale(1.1)}

/* â”€â”€ CONTENT PAD (under bottom nav) â”€â”€ */
.page{padding-bottom:calc(62px + var(--safe-b))}

/* â”€â”€ LOADER â”€â”€ */
.loader{display:flex;flex-direction:column;align-items:center;gap:12px;padding:60px 20px}
.spin{width:34px;height:34px;border:3px solid var(--border);border-top-color:var(--red);border-radius:50%;animation:sp .7s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.loader-t{font-size:14px;color:var(--sec)}

/* â”€â”€ ERROR â”€â”€ */
.err-box{margin:16px;padding:14px;border-radius:var(--r);background:#FFF3F0;border:1px solid #FFCDC5;font-size:14px;color:#C0392B;line-height:1.5}

/* â”€â”€ SEARCH â”€â”€ */
.search-wrap{padding:10px 16px;background:var(--white);border-bottom:1px solid var(--border)}
.search{width:100%;height:40px;padding:0 12px 0 38px;border:none;border-radius:var(--rs);background:var(--bg);font-size:15px;outline:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='none'%3E%3Ccircle cx='7' cy='7' r='5.5' stroke='%239E9B98' stroke-width='1.5'/%3E%3Cpath d='m13 13-2.5-2.5' stroke='%239E9B98' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:12px center}

/* â”€â”€ ADDR BAR â”€â”€ */
.addr-bar{background:var(--white);padding:11px 16px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);cursor:pointer}
.addr-bar .av{flex:1;min-width:0}
.addr-bar .al{font-size:11px;color:var(--sec)}
.addr-bar .at{font-size:15px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* â”€â”€ SECTION TITLE â”€â”€ */
.sec-t{padding:18px 16px 10px;font-size:20px;font-weight:700}
.sec-t2{font-size:16px;font-weight:600;padding:16px 16px 8px}

/* â”€â”€ RESTAURANT CARDS â”€â”€ */
.r-list{padding:0 16px 16px;display:flex;flex-direction:column;gap:12px}
.r-card{background:var(--white);border-radius:var(--r);overflow:hidden;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.07);transition:transform .12s,box-shadow .12s}
.r-card:active{transform:scale(.98);box-shadow:0 1px 2px rgba(0,0,0,.05)}
.r-img{width:100%;height:156px;object-fit:cover;background:var(--bg)}
.r-img-ph{width:100%;height:156px;background:linear-gradient(135deg,#f0ede8,#e0dbd3);display:flex;align-items:center;justify-content:center;font-size:50px}
.r-body{padding:12px 14px 14px}
.r-name{font-size:16px;font-weight:600;margin-bottom:4px}
.r-meta{display:flex;align-items:center;gap:7px;font-size:13px;color:var(--sec)}
.dot{width:3px;height:3px;border-radius:50%;background:var(--sec)}
.r-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:7px}
.tag{padding:3px 8px;border-radius:6px;background:var(--bg);font-size:12px;color:var(--sec)}
.tag.g{background:#EDFBEE;color:var(--green)}
.tag.r{background:#FFF0ED;color:var(--red)}

/* â”€â”€ RESTAURANT HERO â”€â”€ */
.menu-hero{width:100%;height:190px;object-fit:cover;background:linear-gradient(135deg,#f0ede8,#e0dbd3);display:flex;align-items:center;justify-content:center;font-size:60px}
.menu-info{background:var(--white);padding:14px 16px}
.menu-info h1{font-size:21px;font-weight:700}
.menu-info .mm{font-size:13px;color:var(--sec);margin-top:4px;display:flex;gap:10px}

/* â”€â”€ CATEGORIES â”€â”€ */
.cats{display:flex;gap:8px;padding:11px 16px;overflow-x:auto;scrollbar-width:none;background:var(--white);border-bottom:1px solid var(--border);position:sticky;top:52px;z-index:50}
.cats::-webkit-scrollbar{display:none}
.cat{padding:7px 14px;border-radius:20px;border:none;background:var(--bg);font-size:14px;font-weight:500;cursor:pointer;white-space:nowrap;color:var(--sec);transition:background .15s,color .15s}
.cat.on{background:var(--text);color:#fff}

/* â”€â”€ MENU ITEMS â”€â”€ */
.menu-sec{padding:0 16px}
.menu-sec-t{font-size:18px;font-weight:700;padding:18px 0 10px}
.m-items{display:flex;flex-direction:column;gap:1px;margin-bottom:16px}
.m-item{background:var(--white);display:flex;align-items:center;gap:11px;padding:13px}
.m-item:first-child{border-radius:var(--r) var(--r) 0 0}
.m-item:last-child{border-radius:0 0 var(--r) var(--r)}
.m-item:only-child{border-radius:var(--r)}
.m-item:active{background:var(--bg)}
.m-img{width:78px;height:78px;border-radius:11px;object-fit:cover;background:var(--bg);flex-shrink:0}
.m-img-ph{width:78px;height:78px;border-radius:11px;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:30px;flex-shrink:0}
.m-info{flex:1;min-width:0}
.m-name{font-size:15px;font-weight:500;margin-bottom:3px}
.m-desc{font-size:13px;color:var(--sec);line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:5px}
.m-price{font-size:15px;font-weight:600}
.add-btn{width:36px;height:36px;border-radius:50%;background:var(--red);color:#fff;border:none;font-size:22px;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:transform .1s,background .1s}
.add-btn:active{transform:scale(.88);background:var(--red-d)}
.qty{display:flex;align-items:center;gap:7px;flex-shrink:0}
.qb{width:30px;height:30px;border-radius:50%;background:var(--bg);border:none;cursor:pointer;font-size:17px;font-weight:700;display:flex;align-items:center;justify-content:center;color:var(--text)}
.qn{font-size:15px;font-weight:600;min-width:18px;text-align:center}

/* â”€â”€ CART FAB â”€â”€ */
.cart-fab{position:fixed;bottom:calc(62px + var(--safe-b) + 12px);left:16px;right:16px;z-index:150}
.cart-fab-btn{width:100%;height:var(--bh);background:var(--red);color:#fff;border:none;border-radius:var(--r);font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:space-between;padding:0 20px;box-shadow:0 4px 20px rgba(252,63,29,.4);transition:background .15s,transform .1s}
.cart-fab-btn:active{background:var(--red-d);transform:scale(.98)}
.cfb-c{background:rgba(255,255,255,.25);border-radius:8px;padding:4px 10px;font-size:14px}

/* â”€â”€ CART â”€â”€ */
.cart-list{padding:10px 16px;display:flex;flex-direction:column;gap:1px}
.ci{background:var(--white);display:flex;align-items:center;gap:11px;padding:13px}
.ci:first-child{border-radius:var(--r) var(--r) 0 0}
.ci:last-child{border-radius:0 0 var(--r) var(--r)}
.ci:only-child{border-radius:var(--r)}
.ci-img{width:54px;height:54px;border-radius:9px;object-fit:cover;background:var(--bg);flex-shrink:0}
.ci-name{flex:1;font-size:15px}
.ci-p{font-size:13px;color:var(--sec);margin-top:2px}

/* â”€â”€ CARD â”€â”€ */
.card{background:var(--white);border-radius:var(--r);overflow:hidden;margin:0 16px 12px}
.card-row{display:flex;align-items:center;justify-content:space-between;padding:13px 16px;border-bottom:1px solid var(--border)}
.card-row:last-child{border-bottom:none}
.card-row-lbl{font-size:15px}
.card-row-val{font-size:15px;font-weight:500}
.card-row-val.g{color:var(--green)}
.card-row-val.total{font-size:17px;font-weight:700}
.card-row-val.s{color:var(--sec)}
.card-btn{display:flex;align-items:center;justify-content:space-between;padding:13px 16px;border-bottom:1px solid var(--border);cursor:pointer;background:none;border-top:none;border-left:none;border-right:none;width:100%;text-align:left}
.card-btn:last-child{border-bottom:none}
.card-btn:active{background:var(--bg)}
.cb-l{font-size:15px;color:var(--text)}
.cb-v{font-size:14px;color:var(--sec);display:flex;align-items:center;gap:5px}

/* â”€â”€ PROMO â”€â”€ */
.promo-wrap{display:flex;gap:9px;padding:10px 16px 0}
.promo-in{flex:1;height:44px;padding:0 13px;border:1.5px solid var(--border);border-radius:var(--rs);font-size:15px;outline:none;background:var(--white);transition:border-color .2s}
.promo-in:focus{border-color:var(--red)}
.promo-btn{height:44px;padding:0 16px;background:var(--text);color:#fff;border:none;border-radius:var(--rs);font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap}
.promo-btn:active{background:#3a3a3a}
.promo-msg{padding:7px 16px 0;font-size:13px}
.promo-msg.ok{color:var(--green)}
.promo-msg.er{color:var(--red)}

/* â”€â”€ PAY METHODS â”€â”€ */
.pay-m{background:var(--white);display:flex;align-items:center;gap:13px;padding:13px 16px;cursor:pointer;transition:background .1s;border-bottom:1px solid var(--border)}
.pay-m:last-child{border-bottom:none}
.pay-m:first-child{border-radius:var(--r) var(--r) 0 0}
.pay-m:last-child{border-radius:0 0 var(--r) var(--r)}
.pay-m:only-child{border-radius:var(--r)}
.pay-m:active{background:var(--bg)}
.pay-ico{width:42px;height:30px;border-radius:5px;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0}
.pay-nm{flex:1;font-size:15px}
.pay-chk{width:22px;height:22px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s,border-color .15s}
.pay-m.sel .pay-chk{background:var(--red);border-color:var(--red)}

/* â”€â”€ PERSONS â”€â”€ */
.pers{display:flex;align-items:center;gap:11px}
.pb{width:32px;height:32px;border-radius:50%;background:var(--bg);border:none;cursor:pointer;font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;color:var(--text)}
.pb:active{background:var(--border)}
.pn{font-size:16px;font-weight:600;min-width:22px;text-align:center}

/* â”€â”€ COMMENT â”€â”€ */
.cmt-ta{width:100%;min-height:72px;padding:10px 12px;border:1.5px solid var(--border);border-radius:var(--rs);font-size:15px;resize:none;outline:none;background:var(--white);font-family:inherit;line-height:1.5;transition:border-color .2s}
.cmt-ta:focus{border-color:var(--red)}
.chips{display:flex;gap:7px;flex-wrap:wrap;padding:6px 0 0}
.chip{padding:5px 12px;border-radius:20px;border:1.5px solid var(--border);background:var(--white);font-size:13px;cursor:pointer;font-weight:500;transition:all .15s}
.chip.on{background:var(--text);color:#fff;border-color:var(--text)}

/* â”€â”€ ADDRESS â”€â”€ */
.addr-in{width:100%;height:44px;padding:0 12px 0 36px;border:1.5px solid var(--border);border-radius:var(--rs);font-size:15px;outline:none;background:var(--bg);transition:border-color .2s;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='20' fill='none'%3E%3Cpath d='M8 0C4.7 0 2 2.7 2 6c0 4.5 6 11 6 11S14 10.5 14 6C14 2.7 11.3 0 8 0zm0 8.5A2.5 2.5 0 1 1 8 3.5a2.5 2.5 0 0 1 0 5z' fill='%23FC3F1D'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:10px center}
.addr-in:focus{border-color:var(--red);background-color:var(--white)}
.sug-list{background:var(--white)}
.sug{padding:13px 16px;border-bottom:1px solid var(--border);cursor:pointer;display:flex;align-items:flex-start;gap:11px}
.sug:last-child{border-bottom:none}
.sug:active{background:var(--bg)}
.sug-t{font-size:15px;font-weight:500}
.sug-s{font-size:13px;color:var(--sec);margin-top:2px}
.map-wrap{height:240px;background:#e8e4dc;position:relative}
#ymap{width:100%;height:100%}
.addr-flds{padding:14px 16px;display:flex;flex-direction:column;gap:9px}
.fld{display:flex;flex-direction:column;gap:3px}
.fld label{font-size:11px;color:var(--sec);font-weight:500;text-transform:uppercase;letter-spacing:.3px}
.fld input{height:42px;padding:0 11px;border:1.5px solid var(--border);border-radius:var(--rs);font-size:15px;outline:none;background:var(--white);transition:border-color .2s}
.fld input:focus{border-color:var(--red)}
.fld-row{display:flex;gap:9px}
.fld-row .fld{flex:1}

/* â”€â”€ STATUS â”€â”€ */
.status-wrap{display:flex;flex-direction:column;align-items:center;padding:36px 20px;gap:0}
.s-icon{width:80px;height:80px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:38px;margin-bottom:18px}
.s-icon.pulse{animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
.s-title{font-size:22px;font-weight:700;text-align:center;margin-bottom:8px}
.s-desc{font-size:15px;color:var(--sec);text-align:center;line-height:1.5;margin-bottom:6px}
.s-oid{font-size:13px;color:var(--sec)}
.sbp-card{width:100%;background:var(--white);border-radius:var(--r);padding:18px;margin-top:20px;text-align:center}
.sbp-title{font-size:16px;font-weight:600;margin-bottom:4px}
.sbp-desc{font-size:13px;color:var(--sec);line-height:1.5;margin-bottom:14px}
.sbp-btn{width:100%;height:48px;background:var(--blue);color:#fff;border:none;border-radius:var(--r);font-size:16px;font-weight:600;cursor:pointer;transition:background .15s}
.sbp-btn:active{background:#0c5fc4}

/* â”€â”€ PROFILE â”€â”€ */
.profile-head{background:var(--white);padding:20px 16px;display:flex;align-items:center;gap:14px;border-bottom:1px solid var(--border)}
.avatar{width:62px;height:62px;border-radius:50%;background:linear-gradient(135deg,var(--red),#ff6b4a);display:flex;align-items:center;justify-content:center;font-size:26px;color:#fff;font-weight:700;flex-shrink:0}
.prf-name{font-size:19px;font-weight:700}
.prf-uid{font-size:13px;color:var(--sec);margin-top:2px}
.prf-status{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
.prf-badge{padding:3px 10px;border-radius:12px;font-size:12px;font-weight:600}
.prf-badge.g{background:#EDFBEE;color:var(--green)}
.prf-badge.r{background:#FFF0ED;color:var(--red)}
.prf-badge.b{background:#EFF6FF;color:var(--blue)}
.menu-list{margin:12px 16px;background:var(--white);border-radius:var(--r);overflow:hidden}
.ml-item{display:flex;align-items:center;gap:13px;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .1s}
.ml-item:last-child{border-bottom:none}
.ml-item:active{background:var(--bg)}
.ml-ico{width:38px;height:38px;border-radius:10px;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.ml-txt{flex:1;font-size:15px;font-weight:500}
.ml-arr{color:var(--sec)}

/* â”€â”€ ORDERS HISTORY â”€â”€ */
.ord-list{padding:10px 16px;display:flex;flex-direction:column;gap:10px}
.ord-card{background:var(--white);border-radius:var(--r);overflow:hidden;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.ord-card:active{transform:scale(.99)}
.ord-head{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
.ord-rest{font-size:15px;font-weight:600}
.ord-date{font-size:13px;color:var(--sec)}
.ord-body{padding:12px 16px}
.ord-items{font-size:14px;color:var(--sec);margin-bottom:6px;line-height:1.4}
.ord-footer{display:flex;align-items:center;justify-content:space-between}
.ord-price{font-size:16px;font-weight:700}
.ord-status{font-size:13px;padding:3px 10px;border-radius:10px;font-weight:500}
.ord-status.done{background:#EDFBEE;color:var(--green)}
.ord-status.wait{background:#FFF0ED;color:var(--red)}
.ord-status.del{background:#EFF6FF;color:var(--blue)}
.ord-repeat{width:100%;height:42px;background:var(--bg);color:var(--text);border:none;border-radius:var(--rs);font-size:14px;font-weight:600;cursor:pointer;margin-top:10px;transition:background .15s}
.ord-repeat:active{background:var(--border)}

/* â”€â”€ BOTTOM BUTTON â”€â”€ */
.bot-wrap{padding:12px 16px calc(12px + var(--safe-b))}
.btn{width:100%;height:var(--bh);background:var(--red);color:#fff;border:none;border-radius:var(--r);font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:background .15s,transform .1s}
.btn:active{background:var(--red-d);transform:scale(.98)}
.btn:disabled{background:var(--border);color:var(--sec);transform:none;cursor:default}
.btn.sec{background:var(--bg);color:var(--text)}
.btn.sec:active{background:var(--border)}

/* â”€â”€ GAP â”€â”€ */
.gap{height:14px}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:calc(70px + var(--safe-b));left:50%;transform:translateX(-50%);background:rgba(33,32,31,.92);color:#fff;padding:10px 20px;border-radius:22px;font-size:14px;z-index:9999;pointer-events:none;opacity:0;transition:opacity .3s;white-space:nowrap;max-width:calc(100vw - 40px);text-align:center}
.toast.on{opacity:1}

/* â”€â”€ EMPTY â”€â”€ */
.empty{text-align:center;padding:50px 20px;color:var(--sec);font-size:15px}
.empty-ico{font-size:48px;margin-bottom:12px}
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â• SCREEN: CATALOG â•â•â•â•â•â•â• -->
<div class="scr on" id="s-catalog">
  <div class="hdr" style="justify-content:space-between">
    <div>
      <div class="hdr-title">Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ•Ğ´Ğ°</div>
    </div>
    <div id="hdr-name" style="font-size:14px;color:var(--sec)"></div>
  </div>
  <div class="addr-bar" onclick="nav('address','catalog')">
    <svg width="16" height="20" fill="none"><path d="M8 0C4.7 0 2 2.7 2 6c0 4.5 6 11 6 11S14 10.5 14 6C14 2.7 11.3 0 8 0zm0 8.5A2.5 2.5 0 1 1 8 3.5a2.5 2.5 0 0 1 0 5z" fill="#FC3F1D"/></svg>
    <div class="av"><div class="al">Ğ”Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ Ğ°Ğ´Ñ€ĞµÑÑƒ</div><div class="at" id="addr-top">Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸</div></div>
    <svg width="7" height="12" fill="none"><path d="M1 1l5 5-5 5" stroke="#9E9B98" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </div>
  <div class="search-wrap">
    <input class="search" id="search" type="text" placeholder="Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‹ Ğ¸ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ñ‹" oninput="filterR(this.value)">
  </div>
  <div class="sec-t">Ğ ÑĞ´Ğ¾Ğ¼ Ñ Ğ²Ğ°Ğ¼Ğ¸</div>
  <div class="r-list page" id="r-list">
    <div class="loader"><div class="spin"></div><div class="loader-t">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ñ€ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‹...</div></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: MENU â•â•â•â•â•â•â• -->
<div class="scr" id="s-menu">
  <div class="hdr">
    <button class="back" onclick="nav('catalog')">
      <svg width="9" height="16" fill="none"><path d="M8 1L1 8l7 7" stroke="#21201F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <div class="hdr-title" id="menu-hdr-name">ĞœĞµĞ½Ñ</div>
  </div>
  <div id="menu-hero" class="menu-hero">ğŸ”</div>
  <div class="menu-info">
    <h1 id="menu-name">Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½</h1>
    <div class="mm">
      <span id="menu-rating">â­ 4.8</span>
      <span id="menu-time">30 Ğ¼Ğ¸Ğ½</span>
      <span id="menu-deliv" class="tag g" style="padding:0">Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾</span>
    </div>
  </div>
  <div class="cats" id="menu-cats"></div>
  <div class="page" id="menu-content">
    <div class="loader"><div class="spin"></div><div class="loader-t">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¼ĞµĞ½Ñ...</div></div>
  </div>
  <div class="cart-fab" id="cart-fab" style="display:none">
    <button class="cart-fab-btn" onclick="nav('cart')">
      <span id="fab-cnt" class="cfb-c">0</span>
      <span>ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°</span>
      <span id="fab-price">0 â‚½</span>
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: CART â•â•â•â•â•â•â• -->
<div class="scr" id="s-cart">
  <div class="hdr">
    <button class="back" id="cart-back"></button>
    <div><div class="hdr-title">ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°</div></div>
  </div>
  <div class="addr-bar" onclick="nav('address','cart')">
    <svg width="16" height="18" fill="none"><path d="M8 0C5.2 0 3 2.2 3 5c0 3.7 5 9 5 9s5-5.3 5-9c0-2.8-2.2-5-5-5zm0 6.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" fill="#9E9B98"/></svg>
    <div class="av"><div class="al">ĞĞ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸</div><div class="at" id="addr-cart">Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ</div></div>
    <svg width="7" height="12" fill="none"><path d="M1 1l5 5-5 5" stroke="#9E9B98" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </div>

  <div class="cart-list page" id="cart-list"></div>

  <!-- Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ -->
  <div id="promo-section">
    <div class="card">
      <button class="card-btn" onclick="togglePromo()">
        <span class="cb-l">ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´</span>
        <span class="cb-v" id="promo-display">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ <svg width="7" height="12" fill="none"><path d="M1 1l5 5-5 5" stroke="#9E9B98" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
      </button>
    </div>
    <div id="promo-block" style="display:none;padding-bottom:4px">
      <div class="promo-wrap">
        <input class="promo-in" id="promo-in" type="text" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´">
        <button class="promo-btn" onclick="applyPromo()">ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>
      </div>
      <div class="promo-msg" id="promo-msg"></div>
    </div>
  </div>

  <div class="gap"></div>

  <!-- Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ° -->
  <div class="sec-t2">Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹</div>
  <div id="pay-methods" style="margin:0 16px 12px">
    <div class="pay-m sel" data-m="sbp" data-mid="5" onclick="selPay(this)">
      <div class="pay-ico">ğŸ¦</div>
      <div class="pay-nm">Ğ¡Ğ‘ĞŸ</div>
      <div class="pay-chk"><svg width="10" height="8" fill="none"><path d="M1 4l3 3L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
    </div>
    <div class="pay-m" data-m="cash" data-mid="1" onclick="selPay(this)">
      <div class="pay-ico">ğŸ’µ</div>
      <div class="pay-nm">ĞĞ°Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¼Ğ¸ ĞºÑƒÑ€ÑŒĞµÑ€Ñƒ</div>
      <div class="pay-chk"></div>
    </div>
  </div>

  <div class="gap"></div>

  <!-- Ğ¿Ñ€Ğ¸Ğ±Ğ¾Ñ€Ñ‹ + ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚ -->
  <div class="card" style="margin:0 16px 12px">
    <div class="card-row">
      <span class="card-row-lbl">ĞŸÑ€Ğ¸Ğ±Ğ¾Ñ€Ñ‹</span>
      <div class="pers">
        <button class="pb" onclick="cPers(-1)">âˆ’</button>
        <span class="pn" id="pers-n">2</span>
        <button class="pb" onclick="cPers(1)">+</button>
      </div>
    </div>
    <div style="padding:12px 16px">
      <div style="font-size:13px;color:var(--sec);margin-bottom:7px">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹</div>
      <textarea class="cmt-ta" id="cmt" placeholder="ĞŸĞ¾Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ Ğº Ğ·Ğ°ĞºĞ°Ğ·Ñƒ..."></textarea>
      <div class="chips">
        <div class="chip" onclick="addCmt('ĞŸĞ¾Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑĞ¾ÑƒÑĞ°')">ĞŸĞ¾Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑĞ¾ÑƒÑĞ°</div>
        <div class="chip" onclick="addCmt('Ğ‘ĞµĞ· Ğ»ÑƒĞºĞ°')">Ğ‘ĞµĞ· Ğ»ÑƒĞºĞ°</div>
        <div class="chip" onclick="addCmt('ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚Ğµ Ğ² Ğ´Ğ²ĞµÑ€ÑŒ')">ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚ÑŒ Ğ² Ğ´Ğ²ĞµÑ€ÑŒ</div>
        <div class="chip" onclick="addCmt('ĞĞµ Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚ÑŒ')">ĞĞµ Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚ÑŒ</div>
      </div>
    </div>
  </div>

  <!-- Ğ¸Ñ‚Ğ¾Ğ³Ğ¾ -->
  <div class="card" style="margin:0 16px 12px">
    <div class="card-row">
      <span class="card-row-lbl">Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹</span>
      <span class="card-row-val" id="sum-items">0 â‚½</span>
    </div>
    <div class="card-row">
      <span class="card-row-lbl">Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°</span>
      <span class="card-row-val g" id="sum-deliv">Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾</span>
    </div>
    <div class="card-row" id="disc-row" style="display:none">
      <span class="card-row-lbl">ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´</span>
      <span class="card-row-val g" id="sum-disc">âˆ’0 â‚½</span>
    </div>
    <div class="card-row" style="border-bottom:none">
      <span class="card-row-lbl" style="font-size:17px;font-weight:700">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾</span>
      <span class="card-row-val total" id="sum-total">0 â‚½</span>
    </div>
  </div>

  <div class="bot-wrap">
    <button class="btn" id="order-btn" onclick="placeOrder()">ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: ADDRESS â•â•â•â•â•â•â• -->
<div class="scr" id="s-address">
  <div class="hdr">
    <button class="back" id="addr-back"></button>
    <div><div class="hdr-title">ĞĞ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸</div></div>
  </div>
  <div style="padding:10px 16px;background:var(--white);border-bottom:1px solid var(--border)">
    <input class="addr-in" id="addr-in" type="text" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ..." oninput="onAddrInput(this.value)" autocomplete="off">
  </div>
  <div id="sug-list" class="sug-list"></div>
  <div class="map-wrap"><div id="ymap"></div></div>
  <div class="addr-flds">
    <div class="fld-row">
      <div class="fld"><label>ĞŸĞ¾Ğ´ÑŠĞµĞ·Ğ´</label><input id="f-entr" type="text" placeholder="1"></div>
      <div class="fld"><label>Ğ­Ñ‚Ğ°Ğ¶</label><input id="f-floor" type="text" placeholder="3"></div>
      <div class="fld"><label>ĞšĞ²Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°</label><input id="f-flat" type="text" placeholder="77"></div>
    </div>
    <div class="fld"><label>Ğ”Ğ¾Ğ¼Ğ¾Ñ„Ğ¾Ğ½</label><input id="f-door" type="text" placeholder="1234#"></div>
    <div class="fld"><label>ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºÑƒÑ€ÑŒĞµÑ€Ñƒ</label><input id="f-acmt" type="text" placeholder="Ğ”Ğ¾Ğ¼Ğ¾Ñ„Ğ¾Ğ½ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚Ğµ"></div>
  </div>
  <div class="bot-wrap">
    <button class="btn" onclick="confirmAddr()">ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: STATUS â•â•â•â•â•â•â• -->
<div class="scr" id="s-status">
  <div class="hdr">
    <button class="back" onclick="nav('catalog')">
      <svg width="9" height="16" fill="none"><path d="M8 1L1 8l7 7" stroke="#21201F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <div><div class="hdr-title">Ğ—Ğ°ĞºĞ°Ğ·</div></div>
  </div>
  <div class="status-wrap page">
    <div class="s-icon" id="s-ico">â³</div>
    <div class="s-title" id="s-title">ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼</div>
    <div class="s-desc" id="s-desc">Ğ–Ğ´Ñ‘Ğ¼ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ñ€ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ğ°</div>
    <div class="s-oid" id="s-oid"></div>
    <div class="sbp-card" id="sbp-card" style="display:none">
      <div class="sbp-title">ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¡Ğ‘ĞŸ</div>
      <div class="sbp-desc" id="sbp-desc">ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ½ĞºĞ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹</div>
      <button class="sbp-btn" onclick="openSBP()">ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ² Ğ±Ğ°Ğ½Ğº â†’</button>
    </div>
    <div style="width:100%;margin-top:20px;display:flex;flex-direction:column;gap:10px">
      <button class="btn sec" onclick="nav('orders')">Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ²</button>
      <button class="btn sec" onclick="nav('catalog')">ĞĞ° Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: ORDERS â•â•â•â•â•â•â• -->
<div class="scr" id="s-orders">
  <div class="hdr">
    <button class="back" id="orders-back"></button>
    <div><div class="hdr-title">ĞœĞ¾Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹</div></div>
  </div>
  <div class="page" id="orders-content">
    <div class="loader"><div class="spin"></div><div class="loader-t">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹...</div></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: PROFILE â•â•â•â•â•â•â• -->
<div class="scr" id="s-profile">
  <div class="hdr">
    <div class="hdr-title">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</div>
  </div>
  <div class="profile-head">
    <div class="avatar" id="prf-ava">?</div>
    <div>
      <div class="prf-name" id="prf-name">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼...</div>
      <div class="prf-uid" id="prf-uid"></div>
      <div class="prf-status" id="prf-badges"></div>
    </div>
  </div>
  <div class="menu-list">
    <div class="ml-item" onclick="nav('orders')">
      <div class="ml-ico">ğŸ“¦</div>
      <div class="ml-txt">ĞœĞ¾Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹</div>
      <svg class="ml-arr" width="7" height="12" fill="none"><path d="M1 1l5 5-5 5" stroke="#9E9B98" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </div>
    <div class="ml-item" onclick="nav('addresses')">
      <div class="ml-ico">ğŸ“</div>
      <div class="ml-txt">ĞœĞ¾Ğ¸ Ğ°Ğ´Ñ€ĞµÑĞ°</div>
      <svg class="ml-arr" width="7" height="12" fill="none"><path d="M1 1l5 5-5 5" stroke="#9E9B98" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </div>
    <div class="ml-item" onclick="showLoyalty()">
      <div class="ml-ico">â­</div>
      <div class="ml-txt">Ğ¯Ğ½Ğ´ĞµĞºÑ ĞŸĞ»ÑÑ</div>
      <span id="plus-badge" style="font-size:13px;color:var(--sec)"></span>
    </div>
    <div class="ml-item" onclick="showBankInfo()">
      <div class="ml-ico">ğŸ’³</div>
      <div class="ml-txt">Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ‘Ğ°Ğ½Ğº</div>
      <span id="bank-badge" style="font-size:13px;color:var(--sec)"></span>
    </div>
  </div>
  <div style="margin:4px 16px">
    <button class="btn sec" onclick="showToast('Ğ¢Ğ¾ĞºĞµĞ½ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² Ğ±ÑƒÑ„ĞµÑ€');copyToken()">ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â• -->
<nav class="bnav" id="bnav">
  <button class="bn on" id="bn-catalog" onclick="nav('catalog')">
    <svg width="22" height="22" fill="none" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.8"/><rect x="14" y="3" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.8"/><rect x="3" y="14" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.8"/><rect x="14" y="14" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.8"/></svg>
    Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‹
  </button>
  <button class="bn" id="bn-cart" onclick="nav('cart')">
    <svg width="22" height="22" fill="none" viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/><path d="M3 6h18" stroke="currentColor" stroke-width="1.8"/><path d="M16 10a4 4 0 01-8 0" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
    ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°
    <span id="bn-cart-cnt" style="display:none;background:var(--red);color:#fff;border-radius:10px;padding:1px 6px;font-size:10px;font-weight:700"></span>
  </button>
  <button class="bn" id="bn-orders" onclick="nav('orders')">
    <svg width="22" height="22" fill="none" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 7H4a2 2 0 00-2 2v11a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2h-1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><rect x="7" y="3" width="10" height="6" rx="1" stroke="currentColor" stroke-width="1.8"/></svg>
    Ğ—Ğ°ĞºĞ°Ğ·Ñ‹
  </button>
  <button class="bn" id="bn-profile" onclick="nav('profile')">
    <svg width="22" height="22" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="1.8"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
    ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
  </button>
</nav>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const tg = window.Telegram?.WebApp;
if (tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#FFFFFF'); }

const P   = new URLSearchParams(location.search);
const CHAT_ID   = P.get('chat_id') || '';
const TOKEN     = P.get('token')   || '';
const DEVICE_ID = P.get('device_id') || '';
const AM_UUID   = P.get('appmetrica_uuid') || '';
const PROXY     = (P.get('proxy') || '').replace(/\/$/, '');
const BANK_TOKEN = P.get('bank_token') || '';
const PLUS_TOKEN = P.get('plus_token') || '';

const $ = id => document.getElementById(id);

const S = {
  screen: 'catalog',
  prevScreen: 'catalog',
  cart: [],
  restaurant: null,
  address: null,
  payMethod: 'sbp',
  payMethodId: 5,
  persons: 2,
  promo: '',
  promoDisc: 0,
  promoOk: false,
  orderId: null,
  sbpUrl: null,
  pollTimer: null,
  lat: null,
  lon: null,
  ymapReady: false,
  ymapInited: false,
  ymapObj: null,
  ymapPin: null,
  cartVersion: 0,
  idem: '',
  profile: null,
};

// â”€â”€â”€ back buttons init â”€â”€â”€
$('cart-back').onclick  = () => nav('menu');
$('addr-back').onclick  = () => nav(S.prevScreen === 'address' ? 'catalog' : S.prevScreen);
$('orders-back').onclick= () => nav(S.prevScreen === 'orders' ? 'catalog' : S.prevScreen);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmtR(rub) {
  if (rub === null || rub === undefined) return 'â€”';
  return parseFloat(rub).toLocaleString('ru-RU', {maximumFractionDigits:2}) + ' â‚½';
}
function fmtK(kop) { return fmtR(kop / 100); }
function uid4() {
  return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
}
function showToast(msg, d=2500) {
  const t = $('toast'); t.textContent = msg; t.classList.add('on');
  setTimeout(() => t.classList.remove('on'), d);
}
function copyToken() {
  navigator.clipboard?.writeText(TOKEN).catch(()=>{});
}
function setBtn(id, loading, txt) {
  const b = $(id); if (!b) return;
  b.disabled = loading; b.textContent = loading ? '...' : txt;
}
function emoji(cats=[]) {
  const s = cats.join(' ').toLowerCase();
  if (s.includes('Ğ¿Ğ¸Ñ†Ñ†')||s.includes('pizza')) return 'ğŸ•';
  if (s.includes('Ğ±ÑƒÑ€Ğ³ĞµÑ€')||s.includes('burger')) return 'ğŸ”';
  if (s.includes('ÑÑƒÑˆĞ¸')||s.includes('Ñ€Ğ¾Ğ»')) return 'ğŸ£';
  if (s.includes('ÑˆĞ°ÑƒÑ€Ğ¼')) return 'ğŸŒ¯';
  if (s.includes('Ğ¿Ğ°ÑÑ‚')||s.includes('Ğ¸Ñ‚Ğ°Ğ»ÑŒÑĞ½')) return 'ğŸ';
  if (s.includes('ĞºĞ¸Ñ‚Ğ°Ğ¹')||s.includes('Ğ»Ğ°Ğ¿Ñˆ')) return 'ğŸœ';
  if (s.includes('Ğ´ĞµÑĞµÑ€Ñ‚')||s.includes('Ñ‚Ğ¾Ñ€Ñ‚')) return 'ğŸ°';
  if (s.includes('ĞºĞ¾Ñ„Ğµ')||s.includes('Ğ½Ğ°Ğ¿Ğ¸Ñ‚')) return 'â˜•';
  return 'ğŸ½ï¸';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function hdrs(extra={}) {
  const h = {
    'X-Bearer': TOKEN,
    'X-Device-Id': DEVICE_ID,
    'X-Appmetrica-Uuid': AM_UUID,
    'X-Chat-Id': CHAT_ID,
  };
  if (S.lat && S.lon) h['X-User-Coords'] = `${S.lat},${S.lon}`;
  return {...h, ...extra};
}

async function api(path, opts={}) {
  const url = PROXY + '/proxy/' + path.replace(/^\//, '');
  const res = await fetch(url, {
    method: opts.method || 'GET',
    headers: hdrs(opts.headers || {}),
    body: opts.body ? JSON.stringify(opts.body) : undefined,
  });
  return res.json().catch(() => ({}));
}

async function post(path, body={}, extra={}) {
  return api(path, {method:'POST', headers:{'Content-Type':'application/json',...extra}, body});
}

async function suggest(text) {
  const r = await fetch(PROXY + '/proxy-suggest', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({text, lat: S.lat||55.7558, lon: S.lon||37.6176})
  });
  return r.json().catch(()=>({}));
}

async function geocode(text) {
  const r = await fetch(PROXY + '/proxy-geocode', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({text})
  });
  return r.json().catch(()=>({}));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const NAVSCREENS = ['catalog','menu','cart','address','status','orders','profile','addresses'];
const BN_MAP = {catalog:'catalog',menu:'catalog',cart:'cart',orders:'orders',profile:'profile',status:'catalog',address:null,addresses:'profile'};

function nav(screen, from) {
  if (from) S.prevScreen = from;
  else S.prevScreen = S.screen;
  S.screen = screen;

  NAVSCREENS.forEach(s => $('s-'+s)?.classList.remove('on'));
  $('s-'+screen)?.classList.add('on');
  window.scrollTo(0,0);

  // bottom nav
  document.querySelectorAll('.bn').forEach(b => b.classList.remove('on'));
  const bnId = BN_MAP[screen];
  if (bnId) $('bn-'+bnId)?.classList.add('on');
  $('bnav').style.display = screen === 'address' ? 'none' : 'flex';

  if (screen === 'catalog') loadCatalog();
  if (screen === 'cart')    renderCart();
  if (screen === 'profile') loadProfile();
  if (screen === 'orders')  loadOrders();
  if (screen === 'address') initAddr();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GEO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initGeo() {
  if (tg?.LocationManager?.isInited) {
    tg.LocationManager.getLocation(l => { if(l){S.lat=l.latitude;S.lon=l.longitude;} });
  } else if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      p => { S.lat=p.coords.latitude; S.lon=p.coords.longitude; },
      () => {}
    );
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CATALOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _rAll = [];
let _rLoaded = false;

async function loadCatalog() {
  if (_rLoaded && _rAll.length) { renderR(_rAll); return; }
  $('r-list').innerHTML = '<div class="loader"><div class="spin"></div><div class="loader-t">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ñ€ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‹...</div></div>';
  try {
    const lat = S.lat||55.7558, lon = S.lon||37.6176;
    const d = await api(`eats/v1/layout-constructor/v1/layout?latitude=${lat}&longitude=${lon}&region_id=1`);
    let list = [];
    for (const blk of (d?.payload?.blocks||d?.blocks||[])) {
      for (const it of (blk?.payload?.places||blk?.places||blk?.items||[])) {
        const p = it?.place||it;
        if (p?.slug||p?.place_slug) list.push(p);
      }
    }
    if (!list.length) list = d?.places||d?.payload?.places||[];
    if (!list.length) {
      $('r-list').innerHTML = `<div class="err-box">Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹. <a onclick="nav('address','catalog')" style="color:var(--red);cursor:pointer">Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ</a></div>`;
      return;
    }
    _rAll = list; _rLoaded = true;
    renderR(list);
  } catch(e) {
    $('r-list').innerHTML = `<div class="err-box">ĞÑˆĞ¸Ğ±ĞºĞ°: ${e.message}</div>`;
  }
}

function renderR(list) {
  if (!list.length) { $('r-list').innerHTML='<div class="empty"><div class="empty-ico">ğŸ”</div>ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾</div>'; return; }
  $('r-list').innerHTML = list.map(r => {
    const name = r.name||r.title||'â€”';
    const slug = r.slug||r.place_slug||r.id||'';
    const rating = r.rating?.value||r.rating||'';
    const mn = r.delivery?.min_time||r.min_time||'';
    const mx = r.delivery?.max_time||r.max_time||'';
    const free = !r.delivery?.price||r.delivery?.price===0;
    const dp = r.delivery?.price ? fmtK(r.delivery.price) : 'Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾';
    const img = r.logo_url||r.image_url||r.logo||'';
    const cats = (r.categories||r.tags||[]).slice(0,3).map(c=>c.name||c).filter(Boolean);
    const imgH = img
      ? `<img class="r-img" src="${img}" loading="lazy" onerror="this.parentNode.innerHTML='<div class=\\'r-img-ph\\'>${emoji(cats)}</div>'">`
      : `<div class="r-img-ph">${emoji(cats)}</div>`;
    return `<div class="r-card" onclick="openR('${slug}','${encodeURIComponent(name)}')">
      ${imgH}
      <div class="r-body">
        <div class="r-name">${name}</div>
        <div class="r-meta">
          ${rating?`<span>â­ ${rating}</span><div class="dot"></div>`:''}
          ${mn?`<span>${mn}â€“${mx} Ğ¼Ğ¸Ğ½</span><div class="dot"></div>`:''}
          <span class="${free?'tag g':'tag'}" style="padding:2px 7px">${dp}</span>
        </div>
        ${cats.length?`<div class="r-tags">${cats.map(c=>`<span class="tag">${c}</span>`).join('')}</div>`:''}
      </div>
    </div>`;
  }).join('');
}

function filterR(q) {
  if (!q) { renderR(_rAll); return; }
  const f = q.toLowerCase();
  renderR(_rAll.filter(r => (r.name||r.title||'').toLowerCase().includes(f) ||
    (r.categories||r.tags||[]).map(c=>(c.name||c).toLowerCase()).join(' ').includes(f)));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MENU
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openR(slug, name) {
  S.restaurant = { slug, name: decodeURIComponent(name) };
  $('menu-hdr-name').textContent = decodeURIComponent(name);
  $('menu-name').textContent = decodeURIComponent(name);
  $('menu-content').innerHTML = '<div class="loader"><div class="spin"></div><div class="loader-t">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¼ĞµĞ½Ñ...</div></div>';
  $('menu-cats').innerHTML = '';
  $('cart-fab').style.display = 'none';
  nav('menu');
  try {
    const lat=S.lat||55.7558, lon=S.lon||37.6176;
    const d = await api(`eats/v1/menu/v2/menu?placeSlug=${slug}&latitude=${lat}&longitude=${lon}`);
    const cats = d?.payload?.categories||d?.categories||d?.menu||[];
    if (!cats.length) { $('menu-content').innerHTML='<div class="err-box">ĞœĞµĞ½Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾</div>'; return; }

    const pl = d?.payload?.place||d?.place||{};
    if (pl.rating?.value) $('menu-rating').textContent = `â­ ${pl.rating.value}`;
    if (pl.delivery?.min_time) $('menu-time').textContent = `${pl.delivery.min_time}â€“${pl.delivery.max_time} Ğ¼Ğ¸Ğ½`;
    $('menu-deliv').textContent = pl.delivery?.price ? fmtK(pl.delivery.price) : 'Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾';

    const hero = $('menu-hero');
    const heroImg = pl.logo_url||pl.cover_url||'';
    if (heroImg) { hero.style.backgroundImage=`url(${heroImg})`;hero.style.backgroundSize='cover';hero.style.backgroundPosition='center';hero.textContent=''; }

    $('menu-cats').innerHTML = cats.map((c,i)=>`<button class="cat ${i===0?'on':''}" onclick="scrollCat('cat${i}',this)">${c.name||c.category||''}</button>`).join('');
    $('menu-content').innerHTML = cats.map((c,i)=>{
      const items = c.items||c.products||[];
      return `<div class="menu-sec" id="cat${i}">
        <div class="menu-sec-t">${c.name||c.category||''}</div>
        <div class="m-items">${items.map(it=>menuItem(it)).join('')}</div>
      </div>`;
    }).join('');
    updateFab();
  } catch(e) { $('menu-content').innerHTML=`<div class="err-box">ĞÑˆĞ¸Ğ±ĞºĞ°: ${e.message}</div>`; }
}

function menuItem(it) {
  const id   = it.id||it.item_id||'';
  const name = it.name||it.title||'â€”';
  const desc = it.description||it.description_text||'';
  const price= it.price||it.price_info?.price||0;
  const priceR = price > 200 ? price/100 : price; // Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° Ğ² ĞºĞ¾Ğ¿ĞµĞ¹ĞºĞ°Ñ…, Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° Ğ² Ñ€ÑƒĞ±Ğ»ÑÑ…
  const img  = it.picture_url||it.picture?.uri||it.image_url||'';
  const inC  = S.cart.find(c=>c.item.id===id);
  const imgH = img
    ? `<img class="m-img" src="${img}" loading="lazy" onerror="this.style.display='none'">`
    : `<div class="m-img-ph">ğŸ½ï¸</div>`;
  const ctrl = inC
    ? `<div class="qty" id="qc-${id}"><button class="qb" onclick="cQ('${id}',-1,event)">âˆ’</button><span class="qn">${inC.qty}</span><button class="qb" onclick="cQ('${id}',1,event)">+</button></div>`
    : `<button class="add-btn" id="qc-${id}" onclick="addItem(${JSON.stringify(JSON.stringify({id,name,desc,price,img}))},event)">+</button>`;
  return `<div class="m-item">${imgH}<div class="m-info"><div class="m-name">${name}</div>${desc?`<div class="m-desc">${desc}</div>`:''}<div class="m-price">${fmtR(priceR)}</div></div>${ctrl}</div>`;
}

function scrollCat(id, btn) {
  document.querySelectorAll('.cat').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  $(`${id}`)?.scrollIntoView({behavior:'smooth',block:'start'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CART LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addItem(strData, e) {
  e.stopPropagation();
  const it = JSON.parse(strData);
  const ex = S.cart.find(c=>c.item.id===it.id);
  if (ex) ex.qty++;
  else S.cart.push({item:it, qty:1});
  refreshQC(it.id);
  updateFab();
  showToast((it.name||'Ğ¢Ğ¾Ğ²Ğ°Ñ€') + ' Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½');
}

function cQ(id, d, e) {
  e.stopPropagation();
  const i = S.cart.findIndex(c=>c.item.id===id);
  if (i<0) return;
  S.cart[i].qty += d;
  if (S.cart[i].qty<=0) S.cart.splice(i,1);
  refreshQC(id);
  updateFab();
}

function refreshQC(id) {
  const el = $(`qc-${id}`);
  if (!el) return;
  const inC = S.cart.find(c=>c.item.id===id);
  if (inC) {
    el.outerHTML = `<div class="qty" id="qc-${id}"><button class="qb" onclick="cQ('${id}',-1,event)">âˆ’</button><span class="qn">${inC.qty}</span><button class="qb" onclick="cQ('${id}',1,event)">+</button></div>`;
  } else {
    el.outerHTML = `<button class="add-btn" id="qc-${id}" onclick="addItem(${JSON.stringify(JSON.stringify({id}))},event)">+</button>`;
  }
}

function updateFab() {
  const cnt   = S.cart.reduce((s,c)=>s+c.qty, 0);
  const total = cartTotal().items;
  const fab = $('cart-fab');
  if (cnt > 0) {
    fab.style.display='block';
    $('fab-cnt').textContent = cnt;
    $('fab-price').textContent = fmtR(total);
  } else {
    fab.style.display='none';
  }
  // badge on bnav
  const bnCnt = $('bn-cart-cnt');
  if (cnt > 0) { bnCnt.style.display='inline'; bnCnt.textContent=cnt; }
  else bnCnt.style.display='none';
}

function cartTotal() {
  const items = S.cart.reduce((s,c) => {
    const p = c.item.price||0;
    const r = p > 200 ? p/100 : p;
    return s + r * c.qty;
  }, 0);
  return {items, discount: S.promoDisc, total: Math.max(0, items - S.promoDisc)};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CART RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCart() {
  const el = $('cart-list');
  if (!S.cart.length) {
    el.innerHTML = '<div class="empty"><div class="empty-ico">ğŸ›’</div>ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°</div>';
  } else {
    el.innerHTML = S.cart.map((c,i) => {
      const it = c.item;
      const p  = it.price||0; const r = p>200?p/100:p;
      const img= it.img||it.picture_url||it.image_url||'';
      const imgH = img
        ? `<img class="ci-img" src="${img}" onerror="this.style.display='none'">`
        : `<div class="ci-img" style="display:flex;align-items:center;justify-content:center;font-size:22px">ğŸ½ï¸</div>`;
      return `<div class="ci">${imgH}
        <div style="flex:1;min-width:0">
          <div class="ci-name">${it.name||'â€”'}</div>
          <div class="ci-p">${fmtR(r*c.qty)}</div>
        </div>
        <div class="qty">
          <button class="qb" onclick="cCart(${i},-1)">âˆ’</button>
          <span class="qn">${c.qty}</span>
          <button class="qb" onclick="cCart(${i},1)">+</button>
        </div>
      </div>`;
    }).join('');
  }

  const t = cartTotal();
  $('sum-items').textContent = fmtR(t.items);
  $('sum-total').textContent = fmtR(t.total);
  $('disc-row').style.display = t.discount>0 ? 'flex':'none';
  if (t.discount>0) $('sum-disc').textContent = 'âˆ’' + fmtR(t.discount);

  const aT = S.address?.short_text||S.address?.full_text||'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ';
  $('addr-cart').textContent = aT;
  $('addr-top').textContent  = aT;
}

function cCart(i, d) {
  S.cart[i].qty += d;
  if (S.cart[i].qty<=0) S.cart.splice(i,1);
  renderCart(); updateFab();
  if (!S.cart.length) nav('menu');
}

function cPers(d) { S.persons = Math.max(0,(S.persons||2)+d); $('pers-n').textContent=S.persons; }
function addCmt(t) { const ta=$('cmt'); ta.value=ta.value?ta.value+', '+t:t; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROMO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togglePromo() {
  const b = $('promo-block');
  b.style.display = b.style.display==='none' ? 'block':'none';
}

async function applyPromo() {
  const code = $('promo-in').value.trim();
  if (!code) return;
  const msg = $('promo-msg');
  msg.textContent='ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼...'; msg.className='promo-msg';
  try {
    const r = await post('api/v2/apply-promocode', {
      promocode: code,
      place_slug: S.restaurant?.slug||'',
      cart: buildCart()
    }, {'Content-Type':'application/json','X-Idempotency-Token': uid4()});

    const disc = r.discount_amount||r.discount||0;
    if (disc) {
      S.promo = code; S.promoDisc = disc>500?disc/100:disc; S.promoOk=true;
      msg.textContent=`âœ“ Ğ¡ĞºĞ¸Ğ´ĞºĞ° ${fmtR(S.promoDisc)}`; msg.className='promo-msg ok';
      $('promo-display').innerHTML=`<span style="color:var(--red)">${code}</span> âœ“`;
      renderCart();
    } else {
      msg.textContent='âœ— '+(r.message||r.err||'ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½'); msg.className='promo-msg er';
    }
  } catch(e) { msg.textContent='âœ— '+e.message; msg.className='promo-msg er'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selPay(el) {
  document.querySelectorAll('.pay-m').forEach(m=>{m.classList.remove('sel');m.querySelector('.pay-chk').innerHTML='';});
  el.classList.add('sel');
  el.querySelector('.pay-chk').innerHTML='<svg width="10" height="8" fill="none"><path d="M1 4l3 3L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
  S.payMethod   = el.dataset.m;
  S.payMethodId = parseInt(el.dataset.mid);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLACE ORDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildCart() {
  return S.cart.map(c=>({id:c.item.id||'',quantity:c.qty,price:c.item.price||0}));
}

async function placeOrder() {
  if (!S.address) { showToast('Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸'); nav('address','cart'); return; }
  if (!S.cart.length) { showToast('ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°'); return; }
  setBtn('order-btn', true, 'ĞÑ„Ğ¾Ñ€Ğ¼Ğ»ÑĞµĞ¼...');
  S.idem = uid4();
  const t   = cartTotal();
  const a   = S.address;

  const body = {
    courier_options:  [],
    persons_quantity: S.persons,
    location: { latitude: a.lat||S.lat||55.7558, longitude: a.lon||S.lon||37.6176 },
    comment: $('cmt')?.value||'',
    payment: { recently_link_cards: false },
    payment_method_id: S.payMethodId,
    place_slug: S.restaurant?.slug||'',
    phone: tg?.initDataUnsafe?.user?.phone_number||'',
    extended_options: [{type:'delivery_options'}],
    address: {
      office:     $('f-flat')?.value||'',
      floor:      $('f-floor')?.value||'',
      entrance:   $('f-entr')?.value||'',
      doorcode:   $('f-door')?.value||'',
      city:       a.city||'',
      street:     a.street||'',
      house:      a.house||'',
      short_text: a.short_text||a.full_text||'',
      full_text:  a.full_text||a.short_text||'',
      title:      a.short_text||a.full_text||'',
      comment:    $('f-acmt')?.value||'',
      country:    'Ğ Ğ¾ÑÑĞ¸Ñ',
      areas:      a.areas||[],
      type:       {id:0},
      location:   {latitude:a.lat||55.7558, longitude:a.lon||37.6176},
      ...(a.uri?{uri:a.uri,log:JSON.stringify({uri:a.uri})}:{})
    },
    payment_information: {
      type: S.payMethod==='sbp'?'sbp':'cash',
      id:   S.payMethod==='sbp'?'sbp_qr':'cash',
      costForCustomer: t.total.toFixed(2)
    },
    without_callback: true,
    first_order: false,
    currency: 'RUB',
    country_code: 'RU',
    ...(S.promoOk?{promo_code:S.promo}:{}),
    cart: buildCart()
  };

  try {
    const r = await post('api/v2/place-order', body, {'X-Idempotency-Token': S.idem});
    if (r?.status==='error'||r?.domain) {
      showToast(r?.err||r?.message||'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°ĞºĞ°Ğ·Ğ°');
      setBtn('order-btn',false,'ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·'); return;
    }
    S.orderId = r?.order?.order?.order_id||r?.order_id||r?.id||'';
    nav('status');
    handleOrder(r);
  } catch(e) {
    showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: '+e.message);
    setBtn('order-btn',false,'ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·');
  }
}

function handleOrder(r) {
  const oid = S.orderId;
  $('s-oid').textContent = oid ? `Ğ—Ğ°ĞºĞ°Ğ· â„–${oid}` : '';
  const pay = r?.order?.payment||r?.payment;
  const tr  = r?.transparentPayment;
  if (pay?.status==='sbp_required'||tr) {
    const url = pay?.payload?.url||tr?.screen?.actions?.[0]?.url||'';
    S.sbpUrl = url;
    $('s-ico').textContent='ğŸ’³'; $('s-ico').classList.add('pulse');
    $('s-title').textContent='ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ';
    $('s-desc').textContent=tr?.screen?.text?.text||'ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶ Ğ² Ğ²Ğ°ÑˆĞµĞ¼ Ğ±Ğ°Ğ½ĞºĞµ';
    $('sbp-card').style.display='block';
    if (oid) startPoll(oid);
  } else {
    $('s-ico').textContent='âœ…'; $('s-ico').classList.remove('pulse');
    $('s-title').textContent='Ğ—Ğ°ĞºĞ°Ğ· Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚!';
    $('s-desc').textContent='Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½ ÑƒĞ¶Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ Ğ²Ğ°Ñˆ Ğ·Ğ°ĞºĞ°Ğ·';
    S.cart=[]; updateFab();
  }
}

function openSBP() {
  if (!S.sbpUrl) return;
  tg ? tg.openLink(S.sbpUrl) : window.open(S.sbpUrl,'_blank');
}

function startPoll(oid) {
  if (S.pollTimer) clearInterval(S.pollTimer);
  S.pollTimer = setInterval(()=>pollOrder(oid), 3000);
  setTimeout(()=>clearInterval(S.pollTimer), 600000);
}

async function pollOrder(oid) {
  try {
    const r = await api(`api/v2/orders/${oid}/info`);
    const ps = r?.order?.payment?.status||r?.payment_status||'';
    const os = r?.order?.order?.status||r?.order_status||'';
    if (ps==='paid'||os==='confirmed'||os==='cooking'||os==='delivering') {
      clearInterval(S.pollTimer);
      $('s-ico').textContent='âœ…'; $('s-ico').classList.remove('pulse');
      $('s-title').textContent='ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ°!';
      $('s-desc').textContent='Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½ Ğ¿Ñ€Ğ¸Ğ½ÑĞ» Ğ·Ğ°ĞºĞ°Ğ·';
      $('sbp-card').style.display='none';
      S.cart=[]; updateFab();
    } else if (ps==='failed'||os==='cancelled') {
      clearInterval(S.pollTimer);
      $('s-ico').textContent='âŒ'; $('s-ico').classList.remove('pulse');
      $('s-title').textContent='ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ°';
      $('s-desc').textContent='ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ±';
    }
  } catch(e){}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ORDERS HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadOrders() {
  $('orders-content').innerHTML = '<div class="loader"><div class="spin"></div><div class="loader-t">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹...</div></div>';
  try {
    const d = await api('api/v2/orders/history?page=1&page_size=20');
    const orders = d?.orders||d?.data||d?.history||[];
    if (!orders.length) {
      $('orders-content').innerHTML = '<div class="empty"><div class="empty-ico">ğŸ“¦</div>Ğ—Ğ°ĞºĞ°Ğ·Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚</div>';
      return;
    }
    $('orders-content').innerHTML = `<div class="ord-list page">${orders.map(o=>renderOrder(o)).join('')}</div>`;
  } catch(e) {
    $('orders-content').innerHTML = `<div class="err-box">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ${e.message}</div>`;
  }
}

function renderOrder(o) {
  const oid   = o.order_id||o.id||'';
  const rest  = o.place_name||o.restaurant_name||o.place?.name||'Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½';
  const date  = o.created_at ? new Date(o.created_at).toLocaleString('ru-RU',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'}) : '';
  const items = (o.items||o.products||[]).slice(0,3).map(i=>i.name||i.title||'').filter(Boolean).join(', ');
  const total = o.total_cost||o.total||o.cost||0;
  const totalR= total>5000?total/100:total;
  const status= o.status||o.order_status||'';
  const statMap = {
    delivered:['done','Ğ”Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½'],
    completed:['done','Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½'],
    cancelled:['wait','ĞÑ‚Ğ¼ĞµĞ½Ñ‘Ğ½'],
    delivering:['del','Ğ’ĞµĞ·ÑƒÑ‚'],
    cooking:['del','Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑÑ'],
    confirmed:['del','ĞŸÑ€Ğ¸Ğ½ÑÑ‚'],
  };
  const [cls, label] = statMap[status]||['wait', status||'Ğ’ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ'];
  return `<div class="ord-card">
    <div class="ord-head">
      <div>
        <div class="ord-rest">${rest}</div>
        <div class="ord-date">${date}${oid?' Â· â„–'+oid:''}</div>
      </div>
      <span class="ord-status ${cls}">${label}</span>
    </div>
    <div class="ord-body">
      ${items?`<div class="ord-items">${items}${(o.items||[]).length>3?` Ğ¸ ĞµÑ‰Ñ‘ ${(o.items||[]).length-3}`:''}...</div>`:''}
      <div class="ord-footer">
        <span class="ord-price">${fmtR(totalR)}</span>
      </div>
      <button class="ord-repeat" onclick="repeatOrder(${JSON.stringify(JSON.stringify(o))})">ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·</button>
    </div>
  </div>`;
}

async function repeatOrder(strData) {
  const o = JSON.parse(strData);
  const slug = o.place_slug||o.place?.slug||'';
  if (!slug) { showToast('ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ Ñ€ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½Ğµ'); return; }
  const items = o.items||o.products||[];
  if (!items.length) { showToast('ĞĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ°'); return; }
  S.restaurant = {slug, name: o.place_name||o.place?.name||'Ğ ĞµÑÑ‚Ğ¾Ñ€Ğ°Ğ½'};
  S.cart = items.map(it=>({ item:{id:it.id||it.item_id||'',name:it.name||it.title||'',price:it.price||0}, qty:it.quantity||it.qty||1 }));
  updateFab();
  nav('cart');
  showToast('Ğ—Ğ°ĞºĞ°Ğ· Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadProfile() {
  // Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· URL
  const tgUser = tg?.initDataUnsafe?.user;
  let name = tgUser?.first_name || '';
  let uid  = '';

  try {
    const d = await api('eats/v1/launch/v2/native', {method:'POST', headers:{'Content-Type':'application/json'}, body:{experiments:{}}});
    const p = d?.profile||{};
    name = p.name||p.display_name||p.first_name||name;
    uid  = String(p.passport_uid||p.uid||'');
    S.profile = p;
  } catch(e){}

  if (!name) { try { const d2=await api('api/v2/user/info'); name=d2.name||d2.display_name||name; uid=String(d2.passport_uid||d2.uid||uid); } catch(e){} }

  const initials = name ? name[0].toUpperCase() : '?';
  $('prf-ava').textContent   = initials;
  $('prf-name').textContent  = name||'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ';
  $('prf-uid').textContent   = uid ? `UID: ${uid}` : '';

  const badges = [];
  if (PLUS_TOKEN) badges.push('<span class="prf-badge b">â­ ĞŸĞ»ÑÑ</span>');
  if (BANK_TOKEN) badges.push('<span class="prf-badge g">ğŸ’³ Ğ‘Ğ°Ğ½Ğº</span>');
  $('prf-badges').innerHTML = badges.join('');
  $('plus-badge').textContent = PLUS_TOKEN ? 'âœ…' : 'â€”';
  $('bank-badge').textContent = BANK_TOKEN ? 'âœ…' : 'â€”';
  $('hdr-name').textContent = name ? name.split(' ')[0] : '';
}

function showLoyalty() {
  showToast(PLUS_TOKEN ? 'Ğ¯Ğ½Ğ´ĞµĞºÑ ĞŸĞ»ÑÑ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½ âœ…' : 'Ğ¯Ğ½Ğ´ĞµĞºÑ ĞŸĞ»ÑÑ Ğ½Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½');
}
function showBankInfo() {
  showToast(BANK_TOKEN ? 'Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ‘Ğ°Ğ½Ğº Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½ âœ…' : 'Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ‘Ğ°Ğ½Ğº Ğ½Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADDRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _sugTimer=null, _ymInited=false;

function initAddr() {
  if (S.address) {
    $('addr-in').value        = S.address.short_text||S.address.full_text||'';
    $('f-entr').value         = S.address.entrance||'';
    $('f-floor').value        = S.address.floor||'';
    $('f-flat').value         = S.address.flat||'';
    $('f-door').value         = S.address.doorcode||'';
    $('f-acmt').value         = S.address.comment||'';
  }
  if (!_ymInited) { _ymInited=true; loadYmap(); }
  else if (S.ymapObj && S.address) setPin(S.address.lat, S.address.lon);
}

function loadYmap() {
  const s = document.createElement('script');
  s.src = 'https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=84a7e8e1-6a86-4b9d-b6db-b7c0dcb9c8e1';
  s.onload = () => ymaps.ready(() => {
    const lat=S.address?.lat||S.lat||55.7558, lon=S.address?.lon||S.lon||37.6176;
    S.ymapObj = new ymaps.Map('ymap',{center:[lat,lon],zoom:16,controls:['zoomControl']});
    S.ymapPin = new ymaps.Placemark([lat,lon],{},{preset:'islands#redDotIcon'});
    S.ymapObj.geoObjects.add(S.ymapPin);
    S.ymapReady = true;
    S.ymapObj.events.add('click', e => {
      const [la,lo]=e.get('coords'); setPin(la,lo); revGeo(la,lo);
    });
  });
  document.head.appendChild(s);
}

function setPin(lat, lon) {
  if (!S.ymapObj) return;
  S.ymapPin.geometry.setCoordinates([lat,lon]);
  S.ymapObj.setCenter([lat,lon],16,{duration:300});
}

async function revGeo(lat, lon) {
  try {
    const r = await geocode(`${lon},${lat}`);
    const go = r?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject;
    if (!go) return;
    const txt = go.metaDataProperty?.GeocoderMetaData?.text||'';
    $('addr-in').value = txt;
    parseGeoObj(go, txt);
  } catch(e){}
}

function parseGeoObj(go, fullText) {
  const addr = go.metaDataProperty?.GeocoderMetaData?.Address||{};
  const comps = addr.Components||[];
  const get = kind => comps.find(c=>c.kind===kind)?.name||'';
  const short = [get('street'),get('house')].filter(Boolean).join(', ');
  let lat=S.address?.lat||55.7558, lon=S.address?.lon||37.6176;
  const pos = go.Point?.pos;
  if (pos) { const p=pos.split(' '); lon=parseFloat(p[0]); lat=parseFloat(p[1]); }
  S.address = { ...S.address, full_text:fullText, short_text:short||fullText, city:get('locality')||get('province'), street:get('street'), house:get('house'), lat, lon, areas:[get('province')||get('country')].filter(Boolean), uri:go.uri||'' };
}

function onAddrInput(val) {
  clearTimeout(_sugTimer);
  if (!val||val.length<2) { $('sug-list').innerHTML=''; return; }
  _sugTimer = setTimeout(()=>fetchSug(val), 320);
}

async function fetchSug(text) {
  try {
    const d = await suggest(text);
    const items = d?.results||d?.suggest||d?.items||[];
    if (!items.length) { $('sug-list').innerHTML=''; return; }
    $('sug-list').innerHTML = items.map(it => {
      const t=it?.title?.text||it?.name||'', s=it?.subtitle?.text||it?.description||'';
      return `<div class="sug" onclick="selSug(${JSON.stringify(JSON.stringify({t,s,uri:it?.uri||''}))})">
        <svg style="flex-shrink:0;margin-top:2px" width="16" height="20" fill="none"><path d="M8 0C4.7 0 2 2.7 2 6c0 4.5 6 11 6 11S14 10.5 14 6C14 2.7 11.3 0 8 0zm0 8.5A2.5 2.5 0 1 1 8 3.5a2.5 2.5 0 0 1 0 5z" fill="#9E9B98"/></svg>
        <div><div class="sug-t">${t}</div>${s?`<div class="sug-s">${s}</div>`:''}</div>
      </div>`;
    }).join('');
  } catch(e){}
}

async function selSug(strData) {
  const {t,s,uri} = JSON.parse(strData);
  const full = [t,s].filter(Boolean).join(', ');
  $('addr-in').value = t;
  $('sug-list').innerHTML = '';
  try {
    const r = await geocode(full);
    const go = r?.response?.GeoObjectCollection?.featureMember?.[0]?.GeoObject;
    if (go) {
      parseGeoObj(go, full);
      if (S.ymapReady && S.address) setPin(S.address.lat, S.address.lon);
    } else {
      S.address = {...S.address, full_text:full, short_text:t, uri};
    }
  } catch(e) { S.address={...S.address, full_text:full, short_text:t, uri}; }
}

function confirmAddr() {
  if (!S.address) { showToast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ'); return; }
  S.address.entrance = $('f-entr').value;
  S.address.floor    = $('f-floor').value;
  S.address.flat     = $('f-flat').value;
  S.address.doorcode = $('f-door').value;
  S.address.comment  = $('f-acmt').value;
  const disp = S.address.short_text||S.address.full_text||'';
  $('addr-top').textContent   = disp;
  $('addr-cart').textContent  = disp;
  showToast('ĞĞ´Ñ€ĞµÑ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½ âœ“');
  nav(S.prevScreen==='address'?'catalog':S.prevScreen);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LAUNCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
initGeo();

if (!TOKEN && !PROXY) {
  $('r-list').innerHTML = '<div class="err-box">ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Telegram-Ğ±Ğ¾Ñ‚Ğ°</div>';
} else {
  loadCatalog();
  loadProfile(); // Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ² Ñ„Ğ¾Ğ½Ğµ
}
</script>
</body>
</html>
