const tg = window.Telegram.WebApp;
const PROXY_URL = "https://stylographic-affably-luana.ngrok-free.dev"; // ТВОЙ NGROK

async function callYandex(path, method = "GET", data = null) {
    const cid = new URLSearchParams(window.location.search).get('cid');
    
    // Получаем координаты
    let coords = "latitude=55.75,longitude=37.61";
    try {
        const loc = await new Promise((res) => tg.getLocation(res));
        if (loc) coords = `latitude=${loc.latitude},longitude=${loc.longitude}`;
    } catch(e) { console.log("Гео не доступно"); }

    const response = await fetch(PROXY_URL, {
        method: method,
        headers: {
            'x-cid': cid,
            'x-path': path,
            'x-coords': coords,
            'Content-Type': 'application/json'
        },
        body: data ? JSON.stringify(data) : null
    });

    return await response.json();
}

// ПРИМЕР: Загрузка меню при старте
async function init() {
    tg.ready();
    const catalog = await callYandex("/eats/v1/checkout/v1/multi-carts", "POST", {
        location: {latitude: 55.75, longitude: 37.61},
        shipping_type: "delivery"
    });
    console.log("Данные Яндекса:", catalog);
}
init();
